{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport { isString, hasOwnProperty, error, truthy, constant, extend, isArray, toSet, array, isObject, debounce, isDate, inherits, stringValue } from 'vega-util';\nimport { changeset, isChangeSet, EventStream, transforms, Dataflow, asyncCallback } from 'vega-dataflow';\nimport { point, renderModule, CanvasHandler, RenderType, Scenegraph } from 'vega-scenegraph';\nimport { tickStep } from 'd3-array';\nimport { functionContext } from 'vega-functions';\nimport { context } from 'vega-runtime';\nimport { interval } from 'd3-timer';\nimport { locale } from 'vega-format'; // initialize aria role and label attributes\n\nfunction initializeAria(view) {\n  var el = view.container();\n\n  if (el) {\n    el.setAttribute('role', 'graphics-document');\n    el.setAttribute('aria-roleDescription', 'visualization');\n    ariaLabel(el, view.description());\n  }\n} // update aria-label if we have a DOM container element\n\n\nfunction ariaLabel(el, desc) {\n  if (el) desc == null ? el.removeAttribute('aria-label') : el.setAttribute('aria-label', desc);\n}\n\nfunction background(view) {\n  // respond to background signal\n  view.add(null, function (_) {\n    view._background = _.bg;\n    view._resize = 1;\n    return _.bg;\n  }, {\n    bg: view._signals.background\n  });\n}\n\nvar Default = 'default';\n\nfunction cursor(view) {\n  // get cursor signal, add to dataflow if needed\n  var cursor = view._signals.cursor || (view._signals.cursor = view.add({\n    user: Default,\n    item: null\n  })); // evaluate cursor on each mousemove event\n\n  view.on(view.events('view', 'mousemove'), cursor, function (_, event) {\n    var value = cursor.value,\n        user = value ? isString(value) ? value : value.user : Default,\n        item = event.item && event.item.cursor || null;\n    return value && user === value.user && item == value.item ? value : {\n      user: user,\n      item: item\n    };\n  }); // when cursor signal updates, set visible cursor\n\n  view.add(null, function (_) {\n    var user = _.cursor,\n        item = this.value;\n\n    if (!isString(user)) {\n      item = user.item;\n      user = user.user;\n    }\n\n    setCursor(view, user && user !== Default ? user : item || user);\n    return item;\n  }, {\n    cursor: cursor\n  });\n}\n\nfunction setCursor(view, cursor) {\n  var el = view.globalCursor() ? typeof document !== 'undefined' && document.body : view.container();\n\n  if (el) {\n    return cursor == null ? el.style.removeProperty('cursor') : el.style.cursor = cursor;\n  }\n}\n\nfunction dataref(view, name) {\n  var data = view._runtime.data;\n\n  if (!hasOwnProperty(data, name)) {\n    error('Unrecognized data set: ' + name);\n  }\n\n  return data[name];\n}\n\nfunction data(name, values) {\n  return arguments.length < 2 ? dataref(this, name).values.value : change.call(this, name, changeset().remove(truthy).insert(values));\n}\n\nfunction change(name, changes) {\n  if (!isChangeSet(changes)) {\n    error('Second argument to changes must be a changeset.');\n  }\n\n  var dataset = dataref(this, name);\n  dataset.modified = true;\n  return this.pulse(dataset.input, changes);\n}\n\nfunction insert(name, _) {\n  return change.call(this, name, changeset().insert(_));\n}\n\nfunction remove(name, _) {\n  return change.call(this, name, changeset().remove(_));\n}\n\nfunction width(view) {\n  var padding = view.padding();\n  return Math.max(0, view._viewWidth + padding.left + padding.right);\n}\n\nfunction height(view) {\n  var padding = view.padding();\n  return Math.max(0, view._viewHeight + padding.top + padding.bottom);\n}\n\nfunction offset(view) {\n  var padding = view.padding(),\n      origin = view._origin;\n  return [padding.left + origin[0], padding.top + origin[1]];\n}\n\nfunction resizeRenderer(view) {\n  var origin = offset(view),\n      w = width(view),\n      h = height(view);\n\n  view._renderer.background(view.background());\n\n  view._renderer.resize(w, h, origin);\n\n  view._handler.origin(origin);\n\n  view._resizeListeners.forEach(function (handler) {\n    try {\n      handler(w, h);\n    } catch (error) {\n      view.error(error);\n    }\n  });\n}\n/**\n * Extend an event with additional view-specific methods.\n * Adds a new property ('vega') to an event that provides a number\n * of methods for querying information about the current interaction.\n * The vega object provides the following methods:\n *   view - Returns the backing View instance.\n *   item - Returns the currently active scenegraph item (if any).\n *   group - Returns the currently active scenegraph group (if any).\n *     This method accepts a single string-typed argument indicating the name\n *     of the desired parent group. The scenegraph will be traversed from\n *     the item up towards the root to search for a matching group. If no\n *     argument is provided the enclosing group for the active item is\n *     returned, unless the item it itself a group, in which case it is\n *     returned directly.\n *   xy - Returns a two-element array containing the x and y coordinates for\n *     mouse or touch events. For touch events, this is based on the first\n *     elements in the changedTouches array. This method accepts a single\n *     argument: either an item instance or mark name that should serve as\n *     the reference coordinate system. If no argument is provided the\n *     top-level view coordinate system is assumed.\n *   x - Returns the current x-coordinate, accepts the same arguments as xy.\n *   y - Returns the current y-coordinate, accepts the same arguments as xy.\n * @param {Event} event - The input event to extend.\n * @param {Item} item - The currently active scenegraph item (if any).\n * @return {Event} - The extended input event.\n */\n\n\nfunction eventExtend(view, event, item) {\n  var r = view._renderer,\n      el = r && r.canvas(),\n      p,\n      e,\n      translate;\n\n  if (el) {\n    translate = offset(view);\n    e = event.changedTouches ? event.changedTouches[0] : event;\n    p = point(e, el);\n    p[0] -= translate[0];\n    p[1] -= translate[1];\n  }\n\n  event.dataflow = view;\n  event.item = item;\n  event.vega = extension(view, item, p);\n  return event;\n}\n\nfunction extension(view, item, point) {\n  var itemGroup = item ? item.mark.marktype === 'group' ? item : item.mark.group : null;\n\n  function group(name) {\n    var g = itemGroup,\n        i;\n    if (name) for (i = item; i; i = i.mark.group) {\n      if (i.mark.name === name) {\n        g = i;\n        break;\n      }\n    }\n    return g && g.mark && g.mark.interactive ? g : {};\n  }\n\n  function xy(item) {\n    if (!item) return point;\n    if (isString(item)) item = group(item);\n    var p = point.slice();\n\n    while (item) {\n      p[0] -= item.x || 0;\n      p[1] -= item.y || 0;\n      item = item.mark && item.mark.group;\n    }\n\n    return p;\n  }\n\n  return {\n    view: constant(view),\n    item: constant(item || {}),\n    group: group,\n    xy: xy,\n    x: function x(item) {\n      return xy(item)[0];\n    },\n    y: function y(item) {\n      return xy(item)[1];\n    }\n  };\n}\n\nvar VIEW = 'view',\n    TIMER = 'timer',\n    WINDOW = 'window',\n    NO_TRAP = {\n  trap: false\n};\n/**\n * Initialize event handling configuration.\n * @param {object} config - The configuration settings.\n * @return {object}\n */\n\nfunction initializeEventConfig(config) {\n  var events = extend({\n    defaults: {}\n  }, config);\n\n  var unpack = function unpack(obj, keys) {\n    keys.forEach(function (k) {\n      if (isArray(obj[k])) obj[k] = toSet(obj[k]);\n    });\n  };\n\n  unpack(events.defaults, ['prevent', 'allow']);\n  unpack(events, ['view', 'window', 'selector']);\n  return events;\n}\n\nfunction trackEventListener(view, sources, type, handler) {\n  view._eventListeners.push({\n    type: type,\n    sources: array(sources),\n    handler: handler\n  });\n}\n\nfunction prevent(view, type) {\n  var def = view._eventConfig.defaults,\n      prevent = def.prevent,\n      allow = def.allow;\n  return prevent === false || allow === true ? false : prevent === true || allow === false ? true : prevent ? prevent[type] : allow ? !allow[type] : view.preventDefault();\n}\n\nfunction permit(view, key, type) {\n  var rule = view._eventConfig && view._eventConfig[key];\n\n  if (rule === false || isObject(rule) && !rule[type]) {\n    view.warn(\"Blocked \".concat(key, \" \").concat(type, \" event listener.\"));\n    return false;\n  }\n\n  return true;\n}\n/**\n * Create a new event stream from an event source.\n * @param {object} source - The event source to monitor.\n * @param {string} type - The event type.\n * @param {function(object): boolean} [filter] - Event filter function.\n * @return {EventStream}\n */\n\n\nfunction events(source, type, filter) {\n  var view = this,\n      s = new EventStream(filter),\n      send = function send(e, item) {\n    view.runAsync(null, function () {\n      if (source === VIEW && prevent(view, type)) {\n        e.preventDefault();\n      }\n\n      s.receive(eventExtend(view, e, item));\n    });\n  },\n      sources;\n\n  if (source === TIMER) {\n    if (permit(view, 'timer', type)) {\n      view.timer(send, type);\n    }\n  } else if (source === VIEW) {\n    if (permit(view, 'view', type)) {\n      // send traps errors, so use {trap: false} option\n      view.addEventListener(type, send, NO_TRAP);\n    }\n  } else {\n    if (source === WINDOW) {\n      if (permit(view, 'window', type) && typeof window !== 'undefined') {\n        sources = [window];\n      }\n    } else if (typeof document !== 'undefined') {\n      if (permit(view, 'selector', type)) {\n        sources = document.querySelectorAll(source);\n      }\n    }\n\n    if (!sources) {\n      view.warn('Can not resolve event source: ' + source);\n    } else {\n      for (var i = 0, n = sources.length; i < n; ++i) {\n        sources[i].addEventListener(type, send);\n      }\n\n      trackEventListener(view, sources, type, send);\n    }\n  }\n\n  return s;\n}\n\nfunction itemFilter(event) {\n  return event.item;\n}\n\nfunction markTarget(event) {\n  // grab upstream collector feeding the mark operator\n  return event.item.mark.source;\n}\n\nfunction invoke(name) {\n  return function (_, event) {\n    return event.vega.view().changeset().encode(event.item, name);\n  };\n}\n\nfunction hover(hoverSet, leaveSet) {\n  hoverSet = [hoverSet || 'hover'];\n  leaveSet = [leaveSet || 'update', hoverSet[0]]; // invoke hover set upon mouseover\n\n  this.on(this.events('view', 'mouseover', itemFilter), markTarget, invoke(hoverSet)); // invoke leave set upon mouseout\n\n  this.on(this.events('view', 'mouseout', itemFilter), markTarget, invoke(leaveSet));\n  return this;\n}\n/**\n * Finalize a View instance that is being removed.\n * Cancel any running timers.\n * Remove all external event listeners.\n * Remove any currently displayed tooltip.\n */\n\n\nfunction finalize() {\n  var tooltip = this._tooltip,\n      timers = this._timers,\n      listeners = this._eventListeners,\n      n,\n      m,\n      e;\n  n = timers.length;\n\n  while (--n >= 0) {\n    timers[n].stop();\n  }\n\n  n = listeners.length;\n\n  while (--n >= 0) {\n    e = listeners[n];\n    m = e.sources.length;\n\n    while (--m >= 0) {\n      e.sources[m].removeEventListener(e.type, e.handler);\n    }\n  }\n\n  if (tooltip) {\n    tooltip.call(this, this._handler, null, null, null);\n  }\n\n  return this;\n}\n\nfunction element(tag, attr, text) {\n  var el = document.createElement(tag);\n\n  for (var key in attr) {\n    el.setAttribute(key, attr[key]);\n  }\n\n  if (text != null) el.textContent = text;\n  return el;\n}\n\nvar BindClass = 'vega-bind',\n    NameClass = 'vega-bind-name',\n    RadioClass = 'vega-bind-radio';\n/**\n * Bind a signal to an external HTML input element. The resulting two-way\n * binding will propagate input changes to signals, and propagate signal\n * changes to the input element state. If this view instance has no parent\n * element, we assume the view is headless and no bindings are created.\n * @param {Element|string} el - The parent DOM element to which the input\n *   element should be appended as a child. If string-valued, this argument\n *   will be treated as a CSS selector. If null or undefined, the parent\n *   element of this view will be used as the element.\n * @param {object} param - The binding parameters which specify the signal\n *   to bind to, the input element type, and type-specific configuration.\n * @return {View} - This view instance.\n */\n\nfunction bind(view, el, binding) {\n  if (!el) return;\n  var param = binding.param;\n  var bind = binding.state;\n\n  if (!bind) {\n    bind = binding.state = {\n      elements: null,\n      active: false,\n      set: null,\n      update: function update(value) {\n        if (value != view.signal(param.signal)) {\n          view.runAsync(null, function () {\n            bind.source = true;\n            view.signal(param.signal, value);\n          });\n        }\n      }\n    };\n\n    if (param.debounce) {\n      bind.update = debounce(param.debounce, bind.update);\n    }\n  }\n\n  var create = param.input == null && param.element ? target : generate;\n  create(bind, el, param, view);\n\n  if (!bind.active) {\n    view.on(view._signals[param.signal], null, function () {\n      bind.source ? bind.source = false : bind.set(view.signal(param.signal));\n    });\n    bind.active = true;\n  }\n\n  return bind;\n}\n/**\n * Bind the signal to an external EventTarget.\n */\n\n\nfunction target(bind, node, param, view) {\n  var type = param.event || 'input';\n\n  var handler = function handler() {\n    return bind.update(node.value);\n  }; // initialize signal value to external input value\n\n\n  view.signal(param.signal, node.value); // listen for changes on the element\n\n  node.addEventListener(type, handler); // register with view, so we can remove it upon finalization\n\n  trackEventListener(view, node, type, handler); // propagate change to element\n\n  bind.set = function (value) {\n    node.value = value;\n    node.dispatchEvent(event(type));\n  };\n}\n\nfunction event(type) {\n  return typeof Event !== 'undefined' ? new Event(type) : {\n    type: type\n  };\n}\n/**\n * Generate an HTML input form element and bind it to a signal.\n */\n\n\nfunction generate(bind, el, param, view) {\n  var value = view.signal(param.signal);\n  var div = element('div', {\n    'class': BindClass\n  });\n  var wrapper = param.input === 'radio' ? div : div.appendChild(element('label'));\n  wrapper.appendChild(element('span', {\n    'class': NameClass\n  }, param.name || param.signal));\n  el.appendChild(div);\n  var input = form;\n\n  switch (param.input) {\n    case 'checkbox':\n      input = checkbox;\n      break;\n\n    case 'select':\n      input = select;\n      break;\n\n    case 'radio':\n      input = radio;\n      break;\n\n    case 'range':\n      input = range;\n      break;\n  }\n\n  input(bind, wrapper, param, value);\n}\n/**\n * Generates an arbitrary input form element.\n * The input type is controlled via user-provided parameters.\n */\n\n\nfunction form(bind, el, param, value) {\n  var node = element('input');\n\n  for (var key in param) {\n    if (key !== 'signal' && key !== 'element') {\n      node.setAttribute(key === 'input' ? 'type' : key, param[key]);\n    }\n  }\n\n  node.setAttribute('name', param.signal);\n  node.value = value;\n  el.appendChild(node);\n  node.addEventListener('input', function () {\n    return bind.update(node.value);\n  });\n  bind.elements = [node];\n\n  bind.set = function (value) {\n    return node.value = value;\n  };\n}\n/**\n * Generates a checkbox input element.\n */\n\n\nfunction checkbox(bind, el, param, value) {\n  var attr = {\n    type: 'checkbox',\n    name: param.signal\n  };\n  if (value) attr.checked = true;\n  var node = element('input', attr);\n  el.appendChild(node);\n  node.addEventListener('change', function () {\n    return bind.update(node.checked);\n  });\n  bind.elements = [node];\n\n  bind.set = function (value) {\n    return node.checked = !!value || null;\n  };\n}\n/**\n * Generates a selection list input element.\n */\n\n\nfunction select(bind, el, param, value) {\n  var node = element('select', {\n    name: param.signal\n  }),\n      labels = param.labels || [];\n  param.options.forEach(function (option, i) {\n    var attr = {\n      value: option\n    };\n    if (valuesEqual(option, value)) attr.selected = true;\n    node.appendChild(element('option', attr, (labels[i] || option) + ''));\n  });\n  el.appendChild(node);\n  node.addEventListener('change', function () {\n    bind.update(param.options[node.selectedIndex]);\n  });\n  bind.elements = [node];\n\n  bind.set = function (value) {\n    for (var i = 0, n = param.options.length; i < n; ++i) {\n      if (valuesEqual(param.options[i], value)) {\n        node.selectedIndex = i;\n        return;\n      }\n    }\n  };\n}\n/**\n * Generates a radio button group.\n */\n\n\nfunction radio(bind, el, param, value) {\n  var group = element('span', {\n    'class': RadioClass\n  }),\n      labels = param.labels || [];\n  el.appendChild(group);\n  bind.elements = param.options.map(function (option, i) {\n    var attr = {\n      type: 'radio',\n      name: param.signal,\n      value: option\n    };\n    if (valuesEqual(option, value)) attr.checked = true;\n    var input = element('input', attr);\n    input.addEventListener('change', function () {\n      return bind.update(option);\n    });\n    var label = element('label', {}, (labels[i] || option) + '');\n    label.prepend(input);\n    group.appendChild(label);\n    return input;\n  });\n\n  bind.set = function (value) {\n    var nodes = bind.elements,\n        n = nodes.length;\n\n    for (var i = 0; i < n; ++i) {\n      if (valuesEqual(nodes[i].value, value)) nodes[i].checked = true;\n    }\n  };\n}\n/**\n * Generates a slider input element.\n */\n\n\nfunction range(bind, el, param, value) {\n  value = value !== undefined ? value : (+param.max + +param.min) / 2;\n  var max = param.max != null ? param.max : Math.max(100, +value) || 100,\n      min = param.min || Math.min(0, max, +value) || 0,\n      step = param.step || tickStep(min, max, 100);\n  var node = element('input', {\n    type: 'range',\n    name: param.signal,\n    min: min,\n    max: max,\n    step: step\n  });\n  node.value = value;\n  var span = element('span', {}, +value);\n  el.appendChild(node);\n  el.appendChild(span);\n\n  var update = function update() {\n    span.textContent = node.value;\n    bind.update(+node.value);\n  }; // subscribe to both input and change\n\n\n  node.addEventListener('input', update);\n  node.addEventListener('change', update);\n  bind.elements = [node];\n\n  bind.set = function (value) {\n    node.value = value;\n    span.textContent = value;\n  };\n}\n\nfunction valuesEqual(a, b) {\n  return a === b || a + '' === b + '';\n}\n\nfunction initializeRenderer(view, r, el, constructor, scaleFactor, opt) {\n  r = r || new constructor(view.loader());\n  return r.initialize(el, width(view), height(view), offset(view), scaleFactor, opt).background(view.background());\n}\n\nfunction trap(view, fn) {\n  return !fn ? null : function () {\n    try {\n      fn.apply(this, arguments);\n    } catch (error) {\n      view.error(error);\n    }\n  };\n}\n\nfunction initializeHandler(view, prevHandler, el, constructor) {\n  // instantiate scenegraph handler\n  var handler = new constructor(view.loader(), trap(view, view.tooltip())).scene(view.scenegraph().root).initialize(el, offset(view), view); // transfer event handlers\n\n  if (prevHandler) {\n    prevHandler.handlers().forEach(function (h) {\n      handler.on(h.type, h.handler);\n    });\n  }\n\n  return handler;\n}\n\nfunction initialize(el, elBind) {\n  var view = this,\n      type = view._renderType,\n      config = view._eventConfig.bind,\n      module = renderModule(type); // containing dom element\n\n  el = view._el = el ? lookup(view, el, true) : null; // initialize aria attributes\n\n  initializeAria(view); // select appropriate renderer & handler\n\n  if (!module) view.error('Unrecognized renderer type: ' + type);\n  var Handler = module.handler || CanvasHandler,\n      Renderer = el ? module.renderer : module.headless; // initialize renderer and input handler\n\n  view._renderer = !Renderer ? null : initializeRenderer(view, view._renderer, el, Renderer);\n  view._handler = initializeHandler(view, view._handler, el, Handler);\n  view._redraw = true; // initialize signal bindings\n\n  if (el && config !== 'none') {\n    elBind = elBind ? view._elBind = lookup(view, elBind, true) : el.appendChild(element('form', {\n      'class': 'vega-bindings'\n    }));\n\n    view._bind.forEach(function (_) {\n      if (_.param.element && config !== 'container') {\n        _.element = lookup(view, _.param.element, !!_.param.input);\n      }\n    });\n\n    view._bind.forEach(function (_) {\n      bind(view, _.element || elBind, _);\n    });\n  }\n\n  return view;\n}\n\nfunction lookup(view, el, clear) {\n  if (typeof el === 'string') {\n    if (typeof document !== 'undefined') {\n      el = document.querySelector(el);\n\n      if (!el) {\n        view.error('Signal bind element not found: ' + el);\n        return null;\n      }\n    } else {\n      view.error('DOM document instance not found.');\n      return null;\n    }\n  }\n\n  if (el && clear) {\n    try {\n      el.innerHTML = '';\n    } catch (e) {\n      el = null;\n      view.error(e);\n    }\n  }\n\n  return el;\n}\n\nvar number = function number(_) {\n  return +_ || 0;\n};\n\nvar paddingObject = function paddingObject(_) {\n  return {\n    top: _,\n    bottom: _,\n    left: _,\n    right: _\n  };\n};\n\nfunction _padding(_) {\n  return isObject(_) ? {\n    top: number(_.top),\n    bottom: number(_.bottom),\n    left: number(_.left),\n    right: number(_.right)\n  } : paddingObject(number(_));\n}\n/**\n * Render the current scene in a headless fashion.\n * This method is asynchronous, returning a Promise instance.\n * @return {Promise} - A Promise that resolves to a renderer.\n */\n\n\nfunction renderHeadless(_x, _x2, _x3, _x4) {\n  return _renderHeadless.apply(this, arguments);\n}\n/**\n * Produce an image URL for the visualization. Depending on the type\n * parameter, the generated URL contains data for either a PNG or SVG image.\n * The URL can be used (for example) to download images of the visualization.\n * This method is asynchronous, returning a Promise instance.\n * @param {string} type - The image type. One of 'svg', 'png' or 'canvas'.\n *   The 'canvas' and 'png' types are synonyms for a PNG image.\n * @return {Promise} - A promise that resolves to an image URL.\n */\n\n\nfunction _renderHeadless() {\n  _renderHeadless = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(view, type, scaleFactor, opt) {\n    var module, ctr;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            module = renderModule(type), ctr = module && module.headless;\n            if (!ctr) error('Unrecognized renderer type: ' + type);\n            _context2.next = 4;\n            return view.runAsync();\n\n          case 4:\n            return _context2.abrupt(\"return\", initializeRenderer(view, null, null, ctr, scaleFactor, opt).renderAsync(view._scenegraph.root));\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _renderHeadless.apply(this, arguments);\n}\n\nfunction renderToImageURL(_x5, _x6) {\n  return _renderToImageURL.apply(this, arguments);\n}\n\nfunction _renderToImageURL() {\n  _renderToImageURL = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(type, scaleFactor) {\n    var r;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (type !== RenderType.Canvas && type !== RenderType.SVG && type !== RenderType.PNG) {\n              error('Unrecognized image type: ' + type);\n            }\n\n            _context3.next = 3;\n            return renderHeadless(this, type, scaleFactor);\n\n          case 3:\n            r = _context3.sent;\n            return _context3.abrupt(\"return\", type === RenderType.SVG ? toBlobURL(r.svg(), 'image/svg+xml') : r.canvas().toDataURL('image/png'));\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n  return _renderToImageURL.apply(this, arguments);\n}\n\nfunction toBlobURL(data, mime) {\n  var blob = new Blob([data], {\n    type: mime\n  });\n  return window.URL.createObjectURL(blob);\n}\n/**\n * Produce a Canvas instance containing a rendered visualization.\n * This method is asynchronous, returning a Promise instance.\n * @return {Promise} - A promise that resolves to a Canvas instance.\n */\n\n\nfunction renderToCanvas(_x7, _x8) {\n  return _renderToCanvas.apply(this, arguments);\n}\n/**\n * Produce a rendered SVG string of the visualization.\n * This method is asynchronous, returning a Promise instance.\n * @return {Promise} - A promise that resolves to an SVG string.\n */\n\n\nfunction _renderToCanvas() {\n  _renderToCanvas = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(scaleFactor, opt) {\n    var r;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return renderHeadless(this, RenderType.Canvas, scaleFactor, opt);\n\n          case 2:\n            r = _context4.sent;\n            return _context4.abrupt(\"return\", r.canvas());\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this);\n  }));\n  return _renderToCanvas.apply(this, arguments);\n}\n\nfunction renderToSVG(_x9) {\n  return _renderToSVG.apply(this, arguments);\n}\n\nfunction _renderToSVG() {\n  _renderToSVG = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(scaleFactor) {\n    var r;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return renderHeadless(this, RenderType.SVG, scaleFactor);\n\n          case 2:\n            r = _context5.sent;\n            return _context5.abrupt(\"return\", r.svg());\n\n          case 4:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, this);\n  }));\n  return _renderToSVG.apply(this, arguments);\n}\n\nfunction runtime(view, spec, expr) {\n  return context(view, transforms, functionContext, expr).parse(spec);\n}\n\nfunction scale(name) {\n  var scales = this._runtime.scales;\n\n  if (!hasOwnProperty(scales, name)) {\n    error('Unrecognized scale or projection: ' + name);\n  }\n\n  return scales[name].value;\n}\n\nvar Width = 'width',\n    Height = 'height',\n    Padding = 'padding',\n    Skip = {\n  skip: true\n};\n\nfunction viewWidth(view, width) {\n  var a = view.autosize(),\n      p = view.padding();\n  return width - (a && a.contains === Padding ? p.left + p.right : 0);\n}\n\nfunction viewHeight(view, height) {\n  var a = view.autosize(),\n      p = view.padding();\n  return height - (a && a.contains === Padding ? p.top + p.bottom : 0);\n}\n\nfunction initializeResize(view) {\n  var s = view._signals,\n      w = s[Width],\n      h = s[Height],\n      p = s[Padding];\n\n  function resetSize() {\n    view._autosize = view._resize = 1;\n  } // respond to width signal\n\n\n  view._resizeWidth = view.add(null, function (_) {\n    view._width = _.size;\n    view._viewWidth = viewWidth(view, _.size);\n    resetSize();\n  }, {\n    size: w\n  }); // respond to height signal\n\n  view._resizeHeight = view.add(null, function (_) {\n    view._height = _.size;\n    view._viewHeight = viewHeight(view, _.size);\n    resetSize();\n  }, {\n    size: h\n  }); // respond to padding signal\n\n  var resizePadding = view.add(null, resetSize, {\n    pad: p\n  }); // set rank to run immediately after source signal\n\n  view._resizeWidth.rank = w.rank + 1;\n  view._resizeHeight.rank = h.rank + 1;\n  resizePadding.rank = p.rank + 1;\n}\n\nfunction resizeView(viewWidth, viewHeight, width, height, origin, auto) {\n  this.runAfter(function (view) {\n    var rerun = 0; // reset autosize flag\n\n    view._autosize = 0; // width value changed: update signal, skip resize op\n\n    if (view.width() !== width) {\n      rerun = 1;\n      view.signal(Width, width, Skip); // set width, skip update calc\n\n      view._resizeWidth.skip(true); // skip width resize handler\n\n    } // height value changed: update signal, skip resize op\n\n\n    if (view.height() !== height) {\n      rerun = 1;\n      view.signal(Height, height, Skip); // set height, skip update calc\n\n      view._resizeHeight.skip(true); // skip height resize handler\n\n    } // view width changed: update view property, set resize flag\n\n\n    if (view._viewWidth !== viewWidth) {\n      view._resize = 1;\n      view._viewWidth = viewWidth;\n    } // view height changed: update view property, set resize flag\n\n\n    if (view._viewHeight !== viewHeight) {\n      view._resize = 1;\n      view._viewHeight = viewHeight;\n    } // origin changed: update view property, set resize flag\n\n\n    if (view._origin[0] !== origin[0] || view._origin[1] !== origin[1]) {\n      view._resize = 1;\n      view._origin = origin;\n    } // run dataflow on width/height signal change\n\n\n    if (rerun) view.run('enter');\n    if (auto) view.runAfter(function (v) {\n      return v.resize();\n    });\n  }, false, 1);\n}\n/**\n * Get the current view state, consisting of signal values and/or data sets.\n * @param {object} [options] - Options flags indicating which state to export.\n *   If unspecified, all signals and data sets will be exported.\n * @param {function(string, Operator):boolean} [options.signals] - Optional\n *   predicate function for testing if a signal should be included in the\n *   exported state. If unspecified, all signals will be included, except for\n *   those named 'parent' or those which refer to a Transform value.\n * @param {function(string, object):boolean} [options.data] - Optional\n *   predicate function for testing if a data set's input should be included\n *   in the exported state. If unspecified, all data sets that have been\n *   explicitly modified will be included.\n * @param {boolean} [options.recurse=true] - Flag indicating if the exported\n *   state should recursively include state from group mark sub-contexts.\n * @return {object} - An object containing the exported state values.\n */\n\n\nfunction getState(options) {\n  return this._runtime.getState(options || {\n    data: dataTest,\n    signals: signalTest,\n    recurse: true\n  });\n}\n\nfunction dataTest(name, data) {\n  return data.modified && isArray(data.input.value) && name.indexOf('_:vega:_');\n}\n\nfunction signalTest(name, op) {\n  return !(name === 'parent' || op instanceof transforms.proxy);\n}\n/**\n * Sets the current view state and updates the view by invoking run.\n * @param {object} state - A state object containing signal and/or\n *   data set values, following the format used by the getState method.\n * @return {View} - This view instance.\n */\n\n\nfunction setState(state) {\n  this.runAsync(null, function (v) {\n    v._trigger = false;\n\n    v._runtime.setState(state);\n  }, function (v) {\n    v._trigger = true;\n  });\n  return this;\n}\n\nfunction timer(callback, delay) {\n  function tick(elapsed) {\n    callback({\n      timestamp: Date.now(),\n      elapsed: elapsed\n    });\n  }\n\n  this._timers.push(interval(tick, delay));\n}\n\nfunction defaultTooltip(handler, event, item, value) {\n  var el = handler.element();\n  if (el) el.setAttribute('title', formatTooltip(value));\n}\n\nfunction formatTooltip(value) {\n  return value == null ? '' : isArray(value) ? formatArray(value) : isObject(value) && !isDate(value) ? formatObject(value) : value + '';\n}\n\nfunction formatObject(obj) {\n  return Object.keys(obj).map(function (key) {\n    var v = obj[key];\n    return key + ': ' + (isArray(v) ? formatArray(v) : formatValue(v));\n  }).join('\\n');\n}\n\nfunction formatArray(value) {\n  return '[' + value.map(formatValue).join(', ') + ']';\n}\n\nfunction formatValue(value) {\n  return isArray(value) ? \"[\\u2026]\" : isObject(value) && !isDate(value) ? \"{\\u2026}\" : value;\n}\n/**\n * Create a new View instance from a Vega dataflow runtime specification.\n * The generated View will not immediately be ready for display. Callers\n * should also invoke the initialize method (e.g., to set the parent\n * DOM element in browser-based deployment) and then invoke the run\n * method to evaluate the dataflow graph. Rendering will automatically\n * be performed upon dataflow runs.\n * @constructor\n * @param {object} spec - The Vega dataflow runtime specification.\n */\n\n\nfunction View(spec, options) {\n  var view = this;\n  options = options || {};\n  Dataflow.call(view);\n  if (options.loader) view.loader(options.loader);\n  if (options.logger) view.logger(options.logger);\n  if (options.logLevel != null) view.logLevel(options.logLevel);\n\n  if (options.locale || spec.locale) {\n    var loc = extend({}, spec.locale, options.locale);\n    view.locale(locale(loc.number, loc.time));\n  }\n\n  view._el = null;\n  view._elBind = null;\n  view._renderType = options.renderer || RenderType.Canvas;\n  view._scenegraph = new Scenegraph();\n  var root = view._scenegraph.root; // initialize renderer, handler and event management\n\n  view._renderer = null;\n  view._tooltip = options.tooltip || defaultTooltip, view._redraw = true;\n  view._handler = new CanvasHandler().scene(root);\n  view._globalCursor = false;\n  view._preventDefault = false;\n  view._timers = [];\n  view._eventListeners = [];\n  view._resizeListeners = []; // initialize event configuration\n\n  view._eventConfig = initializeEventConfig(spec.eventConfig);\n  view.globalCursor(view._eventConfig.globalCursor); // initialize dataflow graph\n\n  var ctx = runtime(view, spec, options.expr);\n  view._runtime = ctx;\n  view._signals = ctx.signals;\n  view._bind = (spec.bindings || []).map(function (_) {\n    return {\n      state: null,\n      param: extend({}, _)\n    };\n  }); // initialize scenegraph\n\n  if (ctx.root) ctx.root.set(root);\n  root.source = ctx.data.root.input;\n  view.pulse(ctx.data.root.input, view.changeset().insert(root.items)); // initialize view size\n\n  view._width = view.width();\n  view._height = view.height();\n  view._viewWidth = viewWidth(view, view._width);\n  view._viewHeight = viewHeight(view, view._height);\n  view._origin = [0, 0];\n  view._resize = 0;\n  view._autosize = 1;\n  initializeResize(view); // initialize background color\n\n  background(view); // initialize cursor\n\n  cursor(view); // initialize view description\n\n  view.description(spec.description); // initialize hover proessing, if requested\n\n  if (options.hover) view.hover(); // initialize DOM container(s) and renderer\n\n  if (options.container) view.initialize(options.container, options.bind);\n}\n\nfunction lookupSignal(view, name) {\n  return hasOwnProperty(view._signals, name) ? view._signals[name] : error('Unrecognized signal name: ' + stringValue(name));\n}\n\nfunction findOperatorHandler(op, handler) {\n  var h = (op._targets || []).filter(function (op) {\n    return op._update && op._update.handler === handler;\n  });\n  return h.length ? h[0] : null;\n}\n\nfunction addOperatorListener(view, name, op, handler) {\n  var h = findOperatorHandler(op, handler);\n\n  if (!h) {\n    h = trap(view, function () {\n      return handler(name, op.value);\n    });\n    h.handler = handler;\n    view.on(op, null, h);\n  }\n\n  return view;\n}\n\nfunction removeOperatorListener(view, op, handler) {\n  var h = findOperatorHandler(op, handler);\n  if (h) op._targets.remove(h);\n  return view;\n}\n\ninherits(View, Dataflow, {\n  // -- DATAFLOW / RENDERING ----\n  evaluate: function evaluate(encode, prerun, postrun) {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return Dataflow.prototype.evaluate.call(_this, encode, prerun);\n\n            case 2:\n              if (!(_this._redraw || _this._resize)) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.prev = 3;\n\n              if (!_this._renderer) {\n                _context.next = 8;\n                break;\n              }\n\n              if (_this._resize) {\n                _this._resize = 0;\n                resizeRenderer(_this);\n              }\n\n              _context.next = 8;\n              return _this._renderer.renderAsync(_this._scenegraph.root);\n\n            case 8:\n              _this._redraw = false;\n              _context.next = 14;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](3);\n\n              _this.error(_context.t0);\n\n            case 14:\n              // evaluate postrun\n              if (postrun) asyncCallback(_this, postrun);\n              return _context.abrupt(\"return\", _this);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 11]]);\n    }))();\n  },\n  dirty: function dirty(item) {\n    this._redraw = true;\n    this._renderer && this._renderer.dirty(item);\n  },\n  // -- GET / SET ----\n  description: function description(text) {\n    if (arguments.length) {\n      var desc = text != null ? text + '' : null;\n      if (desc !== this._desc) ariaLabel(this._el, this._desc = desc);\n      return this;\n    }\n\n    return this._desc;\n  },\n  container: function container() {\n    return this._el;\n  },\n  scenegraph: function scenegraph() {\n    return this._scenegraph;\n  },\n  origin: function origin() {\n    return this._origin.slice();\n  },\n  signal: function signal(name, value, options) {\n    var op = lookupSignal(this, name);\n    return arguments.length === 1 ? op.value : this.update(op, value, options);\n  },\n  width: function width(_) {\n    return arguments.length ? this.signal('width', _) : this.signal('width');\n  },\n  height: function height(_) {\n    return arguments.length ? this.signal('height', _) : this.signal('height');\n  },\n  padding: function padding(_) {\n    return arguments.length ? this.signal('padding', _padding(_)) : _padding(this.signal('padding'));\n  },\n  autosize: function autosize(_) {\n    return arguments.length ? this.signal('autosize', _) : this.signal('autosize');\n  },\n  background: function background(_) {\n    return arguments.length ? this.signal('background', _) : this.signal('background');\n  },\n  renderer: function renderer(type) {\n    if (!arguments.length) return this._renderType;\n    if (!renderModule(type)) error('Unrecognized renderer type: ' + type);\n\n    if (type !== this._renderType) {\n      this._renderType = type;\n\n      this._resetRenderer();\n    }\n\n    return this;\n  },\n  tooltip: function tooltip(handler) {\n    if (!arguments.length) return this._tooltip;\n\n    if (handler !== this._tooltip) {\n      this._tooltip = handler;\n\n      this._resetRenderer();\n    }\n\n    return this;\n  },\n  loader: function loader(_loader) {\n    if (!arguments.length) return this._loader;\n\n    if (_loader !== this._loader) {\n      Dataflow.prototype.loader.call(this, _loader);\n\n      this._resetRenderer();\n    }\n\n    return this;\n  },\n  resize: function resize() {\n    // set flag to perform autosize\n    this._autosize = 1; // touch autosize signal to ensure top-level ViewLayout runs\n\n    return this.touch(lookupSignal(this, 'autosize'));\n  },\n  _resetRenderer: function _resetRenderer() {\n    if (this._renderer) {\n      this._renderer = null;\n      this.initialize(this._el, this._elBind);\n    }\n  },\n  // -- SIZING ----\n  _resizeView: resizeView,\n  // -- EVENT HANDLING ----\n  addEventListener: function addEventListener(type, handler, options) {\n    var callback = handler;\n\n    if (!(options && options.trap === false)) {\n      // wrap callback in error handler\n      callback = trap(this, handler);\n      callback.raw = handler;\n    }\n\n    this._handler.on(type, callback);\n\n    return this;\n  },\n  removeEventListener: function removeEventListener(type, handler) {\n    var handlers = this._handler.handlers(type),\n        i = handlers.length,\n        h,\n        t; // search registered handlers, remove if match found\n\n\n    while (--i >= 0) {\n      t = handlers[i].type;\n      h = handlers[i].handler;\n\n      if (type === t && (handler === h || handler === h.raw)) {\n        this._handler.off(t, h);\n\n        break;\n      }\n    }\n\n    return this;\n  },\n  addResizeListener: function addResizeListener(handler) {\n    var l = this._resizeListeners;\n\n    if (l.indexOf(handler) < 0) {\n      // add handler if it isn't already registered\n      // note: error trapping handled elsewhere, so\n      // no need to wrap handlers here\n      l.push(handler);\n    }\n\n    return this;\n  },\n  removeResizeListener: function removeResizeListener(handler) {\n    var l = this._resizeListeners,\n        i = l.indexOf(handler);\n\n    if (i >= 0) {\n      l.splice(i, 1);\n    }\n\n    return this;\n  },\n  addSignalListener: function addSignalListener(name, handler) {\n    return addOperatorListener(this, name, lookupSignal(this, name), handler);\n  },\n  removeSignalListener: function removeSignalListener(name, handler) {\n    return removeOperatorListener(this, lookupSignal(this, name), handler);\n  },\n  addDataListener: function addDataListener(name, handler) {\n    return addOperatorListener(this, name, dataref(this, name).values, handler);\n  },\n  removeDataListener: function removeDataListener(name, handler) {\n    return removeOperatorListener(this, dataref(this, name).values, handler);\n  },\n  globalCursor: function globalCursor(_) {\n    if (arguments.length) {\n      if (this._globalCursor !== !!_) {\n        var prev = setCursor(this, null); // clear previous cursor\n\n        this._globalCursor = !!_;\n        if (prev) setCursor(this, prev); // swap cursor\n      }\n\n      return this;\n    } else {\n      return this._globalCursor;\n    }\n  },\n  preventDefault: function preventDefault(_) {\n    if (arguments.length) {\n      this._preventDefault = _;\n      return this;\n    } else {\n      return this._preventDefault;\n    }\n  },\n  timer: timer,\n  events: events,\n  finalize: finalize,\n  hover: hover,\n  // -- DATA ----\n  data: data,\n  change: change,\n  insert: insert,\n  remove: remove,\n  // -- SCALES --\n  scale: scale,\n  // -- INITIALIZATION ----\n  initialize: initialize,\n  // -- HEADLESS RENDERING ----\n  toImageURL: renderToImageURL,\n  toCanvas: renderToCanvas,\n  toSVG: renderToSVG,\n  // -- SAVE / RESTORE STATE ----\n  getState: getState,\n  setState: setState\n});\nexport { View };","map":{"version":3,"sources":["C:/Users/wkuo/Documents/vitessce-forked-v1.2.2/vitessce/node_modules/vega-view/build/vega-view.module.js"],"names":["isString","hasOwnProperty","error","truthy","constant","extend","isArray","toSet","array","isObject","debounce","isDate","inherits","stringValue","changeset","isChangeSet","EventStream","transforms","Dataflow","asyncCallback","point","renderModule","CanvasHandler","RenderType","Scenegraph","tickStep","functionContext","context","interval","locale","initializeAria","view","el","container","setAttribute","ariaLabel","description","desc","removeAttribute","background","add","_","_background","bg","_resize","_signals","Default","cursor","user","item","on","events","event","value","setCursor","globalCursor","document","body","style","removeProperty","dataref","name","data","_runtime","values","arguments","length","change","call","remove","insert","changes","dataset","modified","pulse","input","width","padding","Math","max","_viewWidth","left","right","height","_viewHeight","top","bottom","offset","origin","_origin","resizeRenderer","w","h","_renderer","resize","_handler","_resizeListeners","forEach","handler","eventExtend","r","canvas","p","e","translate","changedTouches","dataflow","vega","extension","itemGroup","mark","marktype","group","g","i","interactive","xy","slice","x","y","VIEW","TIMER","WINDOW","NO_TRAP","trap","initializeEventConfig","config","defaults","unpack","obj","keys","k","trackEventListener","sources","type","_eventListeners","push","prevent","def","_eventConfig","allow","preventDefault","permit","key","rule","warn","source","filter","s","send","runAsync","receive","timer","addEventListener","window","querySelectorAll","n","itemFilter","markTarget","invoke","encode","hover","hoverSet","leaveSet","finalize","tooltip","_tooltip","timers","_timers","listeners","m","stop","removeEventListener","element","tag","attr","text","createElement","textContent","BindClass","NameClass","RadioClass","bind","binding","param","state","elements","active","set","update","signal","create","target","generate","node","dispatchEvent","Event","div","wrapper","appendChild","form","checkbox","select","radio","range","checked","labels","options","option","valuesEqual","selected","selectedIndex","map","label","prepend","nodes","undefined","min","step","span","a","b","initializeRenderer","constructor","scaleFactor","opt","loader","initialize","fn","apply","initializeHandler","prevHandler","scene","scenegraph","root","handlers","elBind","_renderType","module","_el","lookup","Handler","Renderer","renderer","headless","_redraw","_elBind","_bind","clear","querySelector","innerHTML","number","paddingObject","renderHeadless","ctr","renderAsync","_scenegraph","renderToImageURL","Canvas","SVG","PNG","toBlobURL","svg","toDataURL","mime","blob","Blob","URL","createObjectURL","renderToCanvas","renderToSVG","runtime","spec","expr","parse","scale","scales","Width","Height","Padding","Skip","skip","viewWidth","autosize","contains","viewHeight","initializeResize","resetSize","_autosize","_resizeWidth","_width","size","_resizeHeight","_height","resizePadding","pad","rank","resizeView","auto","runAfter","rerun","run","v","getState","dataTest","signals","signalTest","recurse","indexOf","op","proxy","setState","_trigger","callback","delay","tick","elapsed","timestamp","Date","now","defaultTooltip","formatTooltip","formatArray","formatObject","Object","formatValue","join","View","logger","logLevel","loc","time","_globalCursor","_preventDefault","eventConfig","ctx","bindings","items","lookupSignal","findOperatorHandler","_targets","_update","addOperatorListener","removeOperatorListener","evaluate","prerun","postrun","prototype","dirty","_desc","_resetRenderer","_loader","touch","_resizeView","raw","t","off","addResizeListener","l","removeResizeListener","splice","addSignalListener","removeSignalListener","addDataListener","removeDataListener","prev","toImageURL","toCanvas","toSVG"],"mappings":"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","sourcesContent":["import { isString, hasOwnProperty, error, truthy, constant, extend, isArray, toSet, array, isObject, debounce, isDate, inherits, stringValue } from 'vega-util';\nimport { changeset, isChangeSet, EventStream, transforms, Dataflow, asyncCallback } from 'vega-dataflow';\nimport { point, renderModule, CanvasHandler, RenderType, Scenegraph } from 'vega-scenegraph';\nimport { tickStep } from 'd3-array';\nimport { functionContext } from 'vega-functions';\nimport { context } from 'vega-runtime';\nimport { interval } from 'd3-timer';\nimport { locale } from 'vega-format';\n\n// initialize aria role and label attributes\nfunction initializeAria(view) {\n  const el = view.container();\n\n  if (el) {\n    el.setAttribute('role', 'graphics-document');\n    el.setAttribute('aria-roleDescription', 'visualization');\n    ariaLabel(el, view.description());\n  }\n} // update aria-label if we have a DOM container element\n\nfunction ariaLabel(el, desc) {\n  if (el) desc == null ? el.removeAttribute('aria-label') : el.setAttribute('aria-label', desc);\n}\n\nfunction background (view) {\n  // respond to background signal\n  view.add(null, _ => {\n    view._background = _.bg;\n    view._resize = 1;\n    return _.bg;\n  }, {\n    bg: view._signals.background\n  });\n}\n\nconst Default = 'default';\nfunction cursor (view) {\n  // get cursor signal, add to dataflow if needed\n  const cursor = view._signals.cursor || (view._signals.cursor = view.add({\n    user: Default,\n    item: null\n  })); // evaluate cursor on each mousemove event\n\n  view.on(view.events('view', 'mousemove'), cursor, (_, event) => {\n    const value = cursor.value,\n          user = value ? isString(value) ? value : value.user : Default,\n          item = event.item && event.item.cursor || null;\n    return value && user === value.user && item == value.item ? value : {\n      user: user,\n      item: item\n    };\n  }); // when cursor signal updates, set visible cursor\n\n  view.add(null, function (_) {\n    let user = _.cursor,\n        item = this.value;\n\n    if (!isString(user)) {\n      item = user.item;\n      user = user.user;\n    }\n\n    setCursor(view, user && user !== Default ? user : item || user);\n    return item;\n  }, {\n    cursor: cursor\n  });\n}\nfunction setCursor(view, cursor) {\n  const el = view.globalCursor() ? typeof document !== 'undefined' && document.body : view.container();\n\n  if (el) {\n    return cursor == null ? el.style.removeProperty('cursor') : el.style.cursor = cursor;\n  }\n}\n\nfunction dataref(view, name) {\n  var data = view._runtime.data;\n\n  if (!hasOwnProperty(data, name)) {\n    error('Unrecognized data set: ' + name);\n  }\n\n  return data[name];\n}\nfunction data(name, values) {\n  return arguments.length < 2 ? dataref(this, name).values.value : change.call(this, name, changeset().remove(truthy).insert(values));\n}\nfunction change(name, changes) {\n  if (!isChangeSet(changes)) {\n    error('Second argument to changes must be a changeset.');\n  }\n\n  const dataset = dataref(this, name);\n  dataset.modified = true;\n  return this.pulse(dataset.input, changes);\n}\nfunction insert(name, _) {\n  return change.call(this, name, changeset().insert(_));\n}\nfunction remove(name, _) {\n  return change.call(this, name, changeset().remove(_));\n}\n\nfunction width(view) {\n  var padding = view.padding();\n  return Math.max(0, view._viewWidth + padding.left + padding.right);\n}\nfunction height(view) {\n  var padding = view.padding();\n  return Math.max(0, view._viewHeight + padding.top + padding.bottom);\n}\nfunction offset(view) {\n  var padding = view.padding(),\n      origin = view._origin;\n  return [padding.left + origin[0], padding.top + origin[1]];\n}\nfunction resizeRenderer(view) {\n  var origin = offset(view),\n      w = width(view),\n      h = height(view);\n\n  view._renderer.background(view.background());\n\n  view._renderer.resize(w, h, origin);\n\n  view._handler.origin(origin);\n\n  view._resizeListeners.forEach(handler => {\n    try {\n      handler(w, h);\n    } catch (error) {\n      view.error(error);\n    }\n  });\n}\n\n/**\n * Extend an event with additional view-specific methods.\n * Adds a new property ('vega') to an event that provides a number\n * of methods for querying information about the current interaction.\n * The vega object provides the following methods:\n *   view - Returns the backing View instance.\n *   item - Returns the currently active scenegraph item (if any).\n *   group - Returns the currently active scenegraph group (if any).\n *     This method accepts a single string-typed argument indicating the name\n *     of the desired parent group. The scenegraph will be traversed from\n *     the item up towards the root to search for a matching group. If no\n *     argument is provided the enclosing group for the active item is\n *     returned, unless the item it itself a group, in which case it is\n *     returned directly.\n *   xy - Returns a two-element array containing the x and y coordinates for\n *     mouse or touch events. For touch events, this is based on the first\n *     elements in the changedTouches array. This method accepts a single\n *     argument: either an item instance or mark name that should serve as\n *     the reference coordinate system. If no argument is provided the\n *     top-level view coordinate system is assumed.\n *   x - Returns the current x-coordinate, accepts the same arguments as xy.\n *   y - Returns the current y-coordinate, accepts the same arguments as xy.\n * @param {Event} event - The input event to extend.\n * @param {Item} item - The currently active scenegraph item (if any).\n * @return {Event} - The extended input event.\n */\n\nfunction eventExtend (view, event, item) {\n  var r = view._renderer,\n      el = r && r.canvas(),\n      p,\n      e,\n      translate;\n\n  if (el) {\n    translate = offset(view);\n    e = event.changedTouches ? event.changedTouches[0] : event;\n    p = point(e, el);\n    p[0] -= translate[0];\n    p[1] -= translate[1];\n  }\n\n  event.dataflow = view;\n  event.item = item;\n  event.vega = extension(view, item, p);\n  return event;\n}\n\nfunction extension(view, item, point) {\n  const itemGroup = item ? item.mark.marktype === 'group' ? item : item.mark.group : null;\n\n  function group(name) {\n    var g = itemGroup,\n        i;\n    if (name) for (i = item; i; i = i.mark.group) {\n      if (i.mark.name === name) {\n        g = i;\n        break;\n      }\n    }\n    return g && g.mark && g.mark.interactive ? g : {};\n  }\n\n  function xy(item) {\n    if (!item) return point;\n    if (isString(item)) item = group(item);\n    const p = point.slice();\n\n    while (item) {\n      p[0] -= item.x || 0;\n      p[1] -= item.y || 0;\n      item = item.mark && item.mark.group;\n    }\n\n    return p;\n  }\n\n  return {\n    view: constant(view),\n    item: constant(item || {}),\n    group: group,\n    xy: xy,\n    x: item => xy(item)[0],\n    y: item => xy(item)[1]\n  };\n}\n\nconst VIEW = 'view',\n      TIMER = 'timer',\n      WINDOW = 'window',\n      NO_TRAP = {\n  trap: false\n};\n/**\n * Initialize event handling configuration.\n * @param {object} config - The configuration settings.\n * @return {object}\n */\n\nfunction initializeEventConfig(config) {\n  const events = extend({\n    defaults: {}\n  }, config);\n\n  const unpack = (obj, keys) => {\n    keys.forEach(k => {\n      if (isArray(obj[k])) obj[k] = toSet(obj[k]);\n    });\n  };\n\n  unpack(events.defaults, ['prevent', 'allow']);\n  unpack(events, ['view', 'window', 'selector']);\n  return events;\n}\nfunction trackEventListener(view, sources, type, handler) {\n  view._eventListeners.push({\n    type: type,\n    sources: array(sources),\n    handler: handler\n  });\n}\n\nfunction prevent(view, type) {\n  var def = view._eventConfig.defaults,\n      prevent = def.prevent,\n      allow = def.allow;\n  return prevent === false || allow === true ? false : prevent === true || allow === false ? true : prevent ? prevent[type] : allow ? !allow[type] : view.preventDefault();\n}\n\nfunction permit(view, key, type) {\n  const rule = view._eventConfig && view._eventConfig[key];\n\n  if (rule === false || isObject(rule) && !rule[type]) {\n    view.warn(`Blocked ${key} ${type} event listener.`);\n    return false;\n  }\n\n  return true;\n}\n/**\n * Create a new event stream from an event source.\n * @param {object} source - The event source to monitor.\n * @param {string} type - The event type.\n * @param {function(object): boolean} [filter] - Event filter function.\n * @return {EventStream}\n */\n\n\nfunction events(source, type, filter) {\n  var view = this,\n      s = new EventStream(filter),\n      send = function (e, item) {\n    view.runAsync(null, () => {\n      if (source === VIEW && prevent(view, type)) {\n        e.preventDefault();\n      }\n\n      s.receive(eventExtend(view, e, item));\n    });\n  },\n      sources;\n\n  if (source === TIMER) {\n    if (permit(view, 'timer', type)) {\n      view.timer(send, type);\n    }\n  } else if (source === VIEW) {\n    if (permit(view, 'view', type)) {\n      // send traps errors, so use {trap: false} option\n      view.addEventListener(type, send, NO_TRAP);\n    }\n  } else {\n    if (source === WINDOW) {\n      if (permit(view, 'window', type) && typeof window !== 'undefined') {\n        sources = [window];\n      }\n    } else if (typeof document !== 'undefined') {\n      if (permit(view, 'selector', type)) {\n        sources = document.querySelectorAll(source);\n      }\n    }\n\n    if (!sources) {\n      view.warn('Can not resolve event source: ' + source);\n    } else {\n      for (var i = 0, n = sources.length; i < n; ++i) {\n        sources[i].addEventListener(type, send);\n      }\n\n      trackEventListener(view, sources, type, send);\n    }\n  }\n\n  return s;\n}\n\nfunction itemFilter(event) {\n  return event.item;\n}\n\nfunction markTarget(event) {\n  // grab upstream collector feeding the mark operator\n  return event.item.mark.source;\n}\n\nfunction invoke(name) {\n  return function (_, event) {\n    return event.vega.view().changeset().encode(event.item, name);\n  };\n}\n\nfunction hover (hoverSet, leaveSet) {\n  hoverSet = [hoverSet || 'hover'];\n  leaveSet = [leaveSet || 'update', hoverSet[0]]; // invoke hover set upon mouseover\n\n  this.on(this.events('view', 'mouseover', itemFilter), markTarget, invoke(hoverSet)); // invoke leave set upon mouseout\n\n  this.on(this.events('view', 'mouseout', itemFilter), markTarget, invoke(leaveSet));\n  return this;\n}\n\n/**\n * Finalize a View instance that is being removed.\n * Cancel any running timers.\n * Remove all external event listeners.\n * Remove any currently displayed tooltip.\n */\nfunction finalize () {\n  var tooltip = this._tooltip,\n      timers = this._timers,\n      listeners = this._eventListeners,\n      n,\n      m,\n      e;\n  n = timers.length;\n\n  while (--n >= 0) {\n    timers[n].stop();\n  }\n\n  n = listeners.length;\n\n  while (--n >= 0) {\n    e = listeners[n];\n    m = e.sources.length;\n\n    while (--m >= 0) {\n      e.sources[m].removeEventListener(e.type, e.handler);\n    }\n  }\n\n  if (tooltip) {\n    tooltip.call(this, this._handler, null, null, null);\n  }\n\n  return this;\n}\n\nfunction element (tag, attr, text) {\n  const el = document.createElement(tag);\n\n  for (const key in attr) el.setAttribute(key, attr[key]);\n\n  if (text != null) el.textContent = text;\n  return el;\n}\n\nconst BindClass = 'vega-bind',\n      NameClass = 'vega-bind-name',\n      RadioClass = 'vega-bind-radio';\n/**\n * Bind a signal to an external HTML input element. The resulting two-way\n * binding will propagate input changes to signals, and propagate signal\n * changes to the input element state. If this view instance has no parent\n * element, we assume the view is headless and no bindings are created.\n * @param {Element|string} el - The parent DOM element to which the input\n *   element should be appended as a child. If string-valued, this argument\n *   will be treated as a CSS selector. If null or undefined, the parent\n *   element of this view will be used as the element.\n * @param {object} param - The binding parameters which specify the signal\n *   to bind to, the input element type, and type-specific configuration.\n * @return {View} - This view instance.\n */\n\nfunction bind (view, el, binding) {\n  if (!el) return;\n  const param = binding.param;\n  let bind = binding.state;\n\n  if (!bind) {\n    bind = binding.state = {\n      elements: null,\n      active: false,\n      set: null,\n      update: value => {\n        if (value != view.signal(param.signal)) {\n          view.runAsync(null, () => {\n            bind.source = true;\n            view.signal(param.signal, value);\n          });\n        }\n      }\n    };\n\n    if (param.debounce) {\n      bind.update = debounce(param.debounce, bind.update);\n    }\n  }\n\n  const create = param.input == null && param.element ? target : generate;\n  create(bind, el, param, view);\n\n  if (!bind.active) {\n    view.on(view._signals[param.signal], null, () => {\n      bind.source ? bind.source = false : bind.set(view.signal(param.signal));\n    });\n    bind.active = true;\n  }\n\n  return bind;\n}\n/**\n * Bind the signal to an external EventTarget.\n */\n\nfunction target(bind, node, param, view) {\n  const type = param.event || 'input';\n\n  const handler = () => bind.update(node.value); // initialize signal value to external input value\n\n\n  view.signal(param.signal, node.value); // listen for changes on the element\n\n  node.addEventListener(type, handler); // register with view, so we can remove it upon finalization\n\n  trackEventListener(view, node, type, handler); // propagate change to element\n\n  bind.set = value => {\n    node.value = value;\n    node.dispatchEvent(event(type));\n  };\n}\n\nfunction event(type) {\n  return typeof Event !== 'undefined' ? new Event(type) : {\n    type\n  };\n}\n/**\n * Generate an HTML input form element and bind it to a signal.\n */\n\n\nfunction generate(bind, el, param, view) {\n  const value = view.signal(param.signal);\n  const div = element('div', {\n    'class': BindClass\n  });\n  const wrapper = param.input === 'radio' ? div : div.appendChild(element('label'));\n  wrapper.appendChild(element('span', {\n    'class': NameClass\n  }, param.name || param.signal));\n  el.appendChild(div);\n  let input = form;\n\n  switch (param.input) {\n    case 'checkbox':\n      input = checkbox;\n      break;\n\n    case 'select':\n      input = select;\n      break;\n\n    case 'radio':\n      input = radio;\n      break;\n\n    case 'range':\n      input = range;\n      break;\n  }\n\n  input(bind, wrapper, param, value);\n}\n/**\n * Generates an arbitrary input form element.\n * The input type is controlled via user-provided parameters.\n */\n\n\nfunction form(bind, el, param, value) {\n  const node = element('input');\n\n  for (const key in param) {\n    if (key !== 'signal' && key !== 'element') {\n      node.setAttribute(key === 'input' ? 'type' : key, param[key]);\n    }\n  }\n\n  node.setAttribute('name', param.signal);\n  node.value = value;\n  el.appendChild(node);\n  node.addEventListener('input', () => bind.update(node.value));\n  bind.elements = [node];\n\n  bind.set = value => node.value = value;\n}\n/**\n * Generates a checkbox input element.\n */\n\n\nfunction checkbox(bind, el, param, value) {\n  const attr = {\n    type: 'checkbox',\n    name: param.signal\n  };\n  if (value) attr.checked = true;\n  const node = element('input', attr);\n  el.appendChild(node);\n  node.addEventListener('change', () => bind.update(node.checked));\n  bind.elements = [node];\n\n  bind.set = value => node.checked = !!value || null;\n}\n/**\n * Generates a selection list input element.\n */\n\n\nfunction select(bind, el, param, value) {\n  const node = element('select', {\n    name: param.signal\n  }),\n        labels = param.labels || [];\n  param.options.forEach((option, i) => {\n    const attr = {\n      value: option\n    };\n    if (valuesEqual(option, value)) attr.selected = true;\n    node.appendChild(element('option', attr, (labels[i] || option) + ''));\n  });\n  el.appendChild(node);\n  node.addEventListener('change', () => {\n    bind.update(param.options[node.selectedIndex]);\n  });\n  bind.elements = [node];\n\n  bind.set = value => {\n    for (let i = 0, n = param.options.length; i < n; ++i) {\n      if (valuesEqual(param.options[i], value)) {\n        node.selectedIndex = i;\n        return;\n      }\n    }\n  };\n}\n/**\n * Generates a radio button group.\n */\n\n\nfunction radio(bind, el, param, value) {\n  const group = element('span', {\n    'class': RadioClass\n  }),\n        labels = param.labels || [];\n  el.appendChild(group);\n  bind.elements = param.options.map((option, i) => {\n    const attr = {\n      type: 'radio',\n      name: param.signal,\n      value: option\n    };\n    if (valuesEqual(option, value)) attr.checked = true;\n    const input = element('input', attr);\n    input.addEventListener('change', () => bind.update(option));\n    const label = element('label', {}, (labels[i] || option) + '');\n    label.prepend(input);\n    group.appendChild(label);\n    return input;\n  });\n\n  bind.set = value => {\n    const nodes = bind.elements,\n          n = nodes.length;\n\n    for (let i = 0; i < n; ++i) {\n      if (valuesEqual(nodes[i].value, value)) nodes[i].checked = true;\n    }\n  };\n}\n/**\n * Generates a slider input element.\n */\n\n\nfunction range(bind, el, param, value) {\n  value = value !== undefined ? value : (+param.max + +param.min) / 2;\n  const max = param.max != null ? param.max : Math.max(100, +value) || 100,\n        min = param.min || Math.min(0, max, +value) || 0,\n        step = param.step || tickStep(min, max, 100);\n  const node = element('input', {\n    type: 'range',\n    name: param.signal,\n    min: min,\n    max: max,\n    step: step\n  });\n  node.value = value;\n  const span = element('span', {}, +value);\n  el.appendChild(node);\n  el.appendChild(span);\n\n  const update = () => {\n    span.textContent = node.value;\n    bind.update(+node.value);\n  }; // subscribe to both input and change\n\n\n  node.addEventListener('input', update);\n  node.addEventListener('change', update);\n  bind.elements = [node];\n\n  bind.set = value => {\n    node.value = value;\n    span.textContent = value;\n  };\n}\n\nfunction valuesEqual(a, b) {\n  return a === b || a + '' === b + '';\n}\n\nfunction initializeRenderer (view, r, el, constructor, scaleFactor, opt) {\n  r = r || new constructor(view.loader());\n  return r.initialize(el, width(view), height(view), offset(view), scaleFactor, opt).background(view.background());\n}\n\nfunction trap (view, fn) {\n  return !fn ? null : function () {\n    try {\n      fn.apply(this, arguments);\n    } catch (error) {\n      view.error(error);\n    }\n  };\n}\n\nfunction initializeHandler (view, prevHandler, el, constructor) {\n  // instantiate scenegraph handler\n  const handler = new constructor(view.loader(), trap(view, view.tooltip())).scene(view.scenegraph().root).initialize(el, offset(view), view); // transfer event handlers\n\n  if (prevHandler) {\n    prevHandler.handlers().forEach(h => {\n      handler.on(h.type, h.handler);\n    });\n  }\n\n  return handler;\n}\n\nfunction initialize (el, elBind) {\n  const view = this,\n        type = view._renderType,\n        config = view._eventConfig.bind,\n        module = renderModule(type); // containing dom element\n\n  el = view._el = el ? lookup(view, el, true) : null; // initialize aria attributes\n\n  initializeAria(view); // select appropriate renderer & handler\n\n  if (!module) view.error('Unrecognized renderer type: ' + type);\n  const Handler = module.handler || CanvasHandler,\n        Renderer = el ? module.renderer : module.headless; // initialize renderer and input handler\n\n  view._renderer = !Renderer ? null : initializeRenderer(view, view._renderer, el, Renderer);\n  view._handler = initializeHandler(view, view._handler, el, Handler);\n  view._redraw = true; // initialize signal bindings\n\n  if (el && config !== 'none') {\n    elBind = elBind ? view._elBind = lookup(view, elBind, true) : el.appendChild(element('form', {\n      'class': 'vega-bindings'\n    }));\n\n    view._bind.forEach(_ => {\n      if (_.param.element && config !== 'container') {\n        _.element = lookup(view, _.param.element, !!_.param.input);\n      }\n    });\n\n    view._bind.forEach(_ => {\n      bind(view, _.element || elBind, _);\n    });\n  }\n\n  return view;\n}\n\nfunction lookup(view, el, clear) {\n  if (typeof el === 'string') {\n    if (typeof document !== 'undefined') {\n      el = document.querySelector(el);\n\n      if (!el) {\n        view.error('Signal bind element not found: ' + el);\n        return null;\n      }\n    } else {\n      view.error('DOM document instance not found.');\n      return null;\n    }\n  }\n\n  if (el && clear) {\n    try {\n      el.innerHTML = '';\n    } catch (e) {\n      el = null;\n      view.error(e);\n    }\n  }\n\n  return el;\n}\n\nconst number = _ => +_ || 0;\n\nconst paddingObject = _ => ({\n  top: _,\n  bottom: _,\n  left: _,\n  right: _\n});\n\nfunction padding (_) {\n  return isObject(_) ? {\n    top: number(_.top),\n    bottom: number(_.bottom),\n    left: number(_.left),\n    right: number(_.right)\n  } : paddingObject(number(_));\n}\n\n/**\n * Render the current scene in a headless fashion.\n * This method is asynchronous, returning a Promise instance.\n * @return {Promise} - A Promise that resolves to a renderer.\n */\n\nasync function renderHeadless (view, type, scaleFactor, opt) {\n  const module = renderModule(type),\n        ctr = module && module.headless;\n  if (!ctr) error('Unrecognized renderer type: ' + type);\n  await view.runAsync();\n  return initializeRenderer(view, null, null, ctr, scaleFactor, opt).renderAsync(view._scenegraph.root);\n}\n\n/**\n * Produce an image URL for the visualization. Depending on the type\n * parameter, the generated URL contains data for either a PNG or SVG image.\n * The URL can be used (for example) to download images of the visualization.\n * This method is asynchronous, returning a Promise instance.\n * @param {string} type - The image type. One of 'svg', 'png' or 'canvas'.\n *   The 'canvas' and 'png' types are synonyms for a PNG image.\n * @return {Promise} - A promise that resolves to an image URL.\n */\n\nasync function renderToImageURL (type, scaleFactor) {\n  if (type !== RenderType.Canvas && type !== RenderType.SVG && type !== RenderType.PNG) {\n    error('Unrecognized image type: ' + type);\n  }\n\n  const r = await renderHeadless(this, type, scaleFactor);\n  return type === RenderType.SVG ? toBlobURL(r.svg(), 'image/svg+xml') : r.canvas().toDataURL('image/png');\n}\n\nfunction toBlobURL(data, mime) {\n  const blob = new Blob([data], {\n    type: mime\n  });\n  return window.URL.createObjectURL(blob);\n}\n\n/**\n * Produce a Canvas instance containing a rendered visualization.\n * This method is asynchronous, returning a Promise instance.\n * @return {Promise} - A promise that resolves to a Canvas instance.\n */\n\nasync function renderToCanvas (scaleFactor, opt) {\n  const r = await renderHeadless(this, RenderType.Canvas, scaleFactor, opt);\n  return r.canvas();\n}\n\n/**\n * Produce a rendered SVG string of the visualization.\n * This method is asynchronous, returning a Promise instance.\n * @return {Promise} - A promise that resolves to an SVG string.\n */\n\nasync function renderToSVG (scaleFactor) {\n  const r = await renderHeadless(this, RenderType.SVG, scaleFactor);\n  return r.svg();\n}\n\nfunction runtime (view, spec, expr) {\n  return context(view, transforms, functionContext, expr).parse(spec);\n}\n\nfunction scale(name) {\n  var scales = this._runtime.scales;\n\n  if (!hasOwnProperty(scales, name)) {\n    error('Unrecognized scale or projection: ' + name);\n  }\n\n  return scales[name].value;\n}\n\nvar Width = 'width',\n    Height = 'height',\n    Padding = 'padding',\n    Skip = {\n  skip: true\n};\nfunction viewWidth(view, width) {\n  var a = view.autosize(),\n      p = view.padding();\n  return width - (a && a.contains === Padding ? p.left + p.right : 0);\n}\nfunction viewHeight(view, height) {\n  var a = view.autosize(),\n      p = view.padding();\n  return height - (a && a.contains === Padding ? p.top + p.bottom : 0);\n}\nfunction initializeResize(view) {\n  var s = view._signals,\n      w = s[Width],\n      h = s[Height],\n      p = s[Padding];\n\n  function resetSize() {\n    view._autosize = view._resize = 1;\n  } // respond to width signal\n\n\n  view._resizeWidth = view.add(null, _ => {\n    view._width = _.size;\n    view._viewWidth = viewWidth(view, _.size);\n    resetSize();\n  }, {\n    size: w\n  }); // respond to height signal\n\n  view._resizeHeight = view.add(null, _ => {\n    view._height = _.size;\n    view._viewHeight = viewHeight(view, _.size);\n    resetSize();\n  }, {\n    size: h\n  }); // respond to padding signal\n\n  const resizePadding = view.add(null, resetSize, {\n    pad: p\n  }); // set rank to run immediately after source signal\n\n  view._resizeWidth.rank = w.rank + 1;\n  view._resizeHeight.rank = h.rank + 1;\n  resizePadding.rank = p.rank + 1;\n}\nfunction resizeView(viewWidth, viewHeight, width, height, origin, auto) {\n  this.runAfter(view => {\n    let rerun = 0; // reset autosize flag\n\n    view._autosize = 0; // width value changed: update signal, skip resize op\n\n    if (view.width() !== width) {\n      rerun = 1;\n      view.signal(Width, width, Skip); // set width, skip update calc\n\n      view._resizeWidth.skip(true); // skip width resize handler\n\n    } // height value changed: update signal, skip resize op\n\n\n    if (view.height() !== height) {\n      rerun = 1;\n      view.signal(Height, height, Skip); // set height, skip update calc\n\n      view._resizeHeight.skip(true); // skip height resize handler\n\n    } // view width changed: update view property, set resize flag\n\n\n    if (view._viewWidth !== viewWidth) {\n      view._resize = 1;\n      view._viewWidth = viewWidth;\n    } // view height changed: update view property, set resize flag\n\n\n    if (view._viewHeight !== viewHeight) {\n      view._resize = 1;\n      view._viewHeight = viewHeight;\n    } // origin changed: update view property, set resize flag\n\n\n    if (view._origin[0] !== origin[0] || view._origin[1] !== origin[1]) {\n      view._resize = 1;\n      view._origin = origin;\n    } // run dataflow on width/height signal change\n\n\n    if (rerun) view.run('enter');\n    if (auto) view.runAfter(v => v.resize());\n  }, false, 1);\n}\n\n/**\n * Get the current view state, consisting of signal values and/or data sets.\n * @param {object} [options] - Options flags indicating which state to export.\n *   If unspecified, all signals and data sets will be exported.\n * @param {function(string, Operator):boolean} [options.signals] - Optional\n *   predicate function for testing if a signal should be included in the\n *   exported state. If unspecified, all signals will be included, except for\n *   those named 'parent' or those which refer to a Transform value.\n * @param {function(string, object):boolean} [options.data] - Optional\n *   predicate function for testing if a data set's input should be included\n *   in the exported state. If unspecified, all data sets that have been\n *   explicitly modified will be included.\n * @param {boolean} [options.recurse=true] - Flag indicating if the exported\n *   state should recursively include state from group mark sub-contexts.\n * @return {object} - An object containing the exported state values.\n */\n\nfunction getState(options) {\n  return this._runtime.getState(options || {\n    data: dataTest,\n    signals: signalTest,\n    recurse: true\n  });\n}\n\nfunction dataTest(name, data) {\n  return data.modified && isArray(data.input.value) && name.indexOf('_:vega:_');\n}\n\nfunction signalTest(name, op) {\n  return !(name === 'parent' || op instanceof transforms.proxy);\n}\n/**\n * Sets the current view state and updates the view by invoking run.\n * @param {object} state - A state object containing signal and/or\n *   data set values, following the format used by the getState method.\n * @return {View} - This view instance.\n */\n\n\nfunction setState(state) {\n  this.runAsync(null, v => {\n    v._trigger = false;\n\n    v._runtime.setState(state);\n  }, v => {\n    v._trigger = true;\n  });\n  return this;\n}\n\nfunction timer (callback, delay) {\n  function tick(elapsed) {\n    callback({\n      timestamp: Date.now(),\n      elapsed: elapsed\n    });\n  }\n\n  this._timers.push(interval(tick, delay));\n}\n\nfunction defaultTooltip (handler, event, item, value) {\n  const el = handler.element();\n  if (el) el.setAttribute('title', formatTooltip(value));\n}\n\nfunction formatTooltip(value) {\n  return value == null ? '' : isArray(value) ? formatArray(value) : isObject(value) && !isDate(value) ? formatObject(value) : value + '';\n}\n\nfunction formatObject(obj) {\n  return Object.keys(obj).map(key => {\n    const v = obj[key];\n    return key + ': ' + (isArray(v) ? formatArray(v) : formatValue(v));\n  }).join('\\n');\n}\n\nfunction formatArray(value) {\n  return '[' + value.map(formatValue).join(', ') + ']';\n}\n\nfunction formatValue(value) {\n  return isArray(value) ? '[\\u2026]' : isObject(value) && !isDate(value) ? '{\\u2026}' : value;\n}\n\n/**\n * Create a new View instance from a Vega dataflow runtime specification.\n * The generated View will not immediately be ready for display. Callers\n * should also invoke the initialize method (e.g., to set the parent\n * DOM element in browser-based deployment) and then invoke the run\n * method to evaluate the dataflow graph. Rendering will automatically\n * be performed upon dataflow runs.\n * @constructor\n * @param {object} spec - The Vega dataflow runtime specification.\n */\n\nfunction View(spec, options) {\n  const view = this;\n  options = options || {};\n  Dataflow.call(view);\n  if (options.loader) view.loader(options.loader);\n  if (options.logger) view.logger(options.logger);\n  if (options.logLevel != null) view.logLevel(options.logLevel);\n\n  if (options.locale || spec.locale) {\n    const loc = extend({}, spec.locale, options.locale);\n    view.locale(locale(loc.number, loc.time));\n  }\n\n  view._el = null;\n  view._elBind = null;\n  view._renderType = options.renderer || RenderType.Canvas;\n  view._scenegraph = new Scenegraph();\n  const root = view._scenegraph.root; // initialize renderer, handler and event management\n\n  view._renderer = null;\n  view._tooltip = options.tooltip || defaultTooltip, view._redraw = true;\n  view._handler = new CanvasHandler().scene(root);\n  view._globalCursor = false;\n  view._preventDefault = false;\n  view._timers = [];\n  view._eventListeners = [];\n  view._resizeListeners = []; // initialize event configuration\n\n  view._eventConfig = initializeEventConfig(spec.eventConfig);\n  view.globalCursor(view._eventConfig.globalCursor); // initialize dataflow graph\n\n  const ctx = runtime(view, spec, options.expr);\n  view._runtime = ctx;\n  view._signals = ctx.signals;\n  view._bind = (spec.bindings || []).map(_ => ({\n    state: null,\n    param: extend({}, _)\n  })); // initialize scenegraph\n\n  if (ctx.root) ctx.root.set(root);\n  root.source = ctx.data.root.input;\n  view.pulse(ctx.data.root.input, view.changeset().insert(root.items)); // initialize view size\n\n  view._width = view.width();\n  view._height = view.height();\n  view._viewWidth = viewWidth(view, view._width);\n  view._viewHeight = viewHeight(view, view._height);\n  view._origin = [0, 0];\n  view._resize = 0;\n  view._autosize = 1;\n  initializeResize(view); // initialize background color\n\n  background(view); // initialize cursor\n\n  cursor(view); // initialize view description\n\n  view.description(spec.description); // initialize hover proessing, if requested\n\n  if (options.hover) view.hover(); // initialize DOM container(s) and renderer\n\n  if (options.container) view.initialize(options.container, options.bind);\n}\n\nfunction lookupSignal(view, name) {\n  return hasOwnProperty(view._signals, name) ? view._signals[name] : error('Unrecognized signal name: ' + stringValue(name));\n}\n\nfunction findOperatorHandler(op, handler) {\n  const h = (op._targets || []).filter(op => op._update && op._update.handler === handler);\n  return h.length ? h[0] : null;\n}\n\nfunction addOperatorListener(view, name, op, handler) {\n  let h = findOperatorHandler(op, handler);\n\n  if (!h) {\n    h = trap(view, () => handler(name, op.value));\n    h.handler = handler;\n    view.on(op, null, h);\n  }\n\n  return view;\n}\n\nfunction removeOperatorListener(view, op, handler) {\n  const h = findOperatorHandler(op, handler);\n  if (h) op._targets.remove(h);\n  return view;\n}\n\ninherits(View, Dataflow, {\n  // -- DATAFLOW / RENDERING ----\n  async evaluate(encode, prerun, postrun) {\n    // evaluate dataflow and prerun\n    await Dataflow.prototype.evaluate.call(this, encode, prerun); // render as needed\n\n    if (this._redraw || this._resize) {\n      try {\n        if (this._renderer) {\n          if (this._resize) {\n            this._resize = 0;\n            resizeRenderer(this);\n          }\n\n          await this._renderer.renderAsync(this._scenegraph.root);\n        }\n\n        this._redraw = false;\n      } catch (e) {\n        this.error(e);\n      }\n    } // evaluate postrun\n\n\n    if (postrun) asyncCallback(this, postrun);\n    return this;\n  },\n\n  dirty(item) {\n    this._redraw = true;\n    this._renderer && this._renderer.dirty(item);\n  },\n\n  // -- GET / SET ----\n  description(text) {\n    if (arguments.length) {\n      const desc = text != null ? text + '' : null;\n      if (desc !== this._desc) ariaLabel(this._el, this._desc = desc);\n      return this;\n    }\n\n    return this._desc;\n  },\n\n  container() {\n    return this._el;\n  },\n\n  scenegraph() {\n    return this._scenegraph;\n  },\n\n  origin() {\n    return this._origin.slice();\n  },\n\n  signal(name, value, options) {\n    const op = lookupSignal(this, name);\n    return arguments.length === 1 ? op.value : this.update(op, value, options);\n  },\n\n  width(_) {\n    return arguments.length ? this.signal('width', _) : this.signal('width');\n  },\n\n  height(_) {\n    return arguments.length ? this.signal('height', _) : this.signal('height');\n  },\n\n  padding(_) {\n    return arguments.length ? this.signal('padding', padding(_)) : padding(this.signal('padding'));\n  },\n\n  autosize(_) {\n    return arguments.length ? this.signal('autosize', _) : this.signal('autosize');\n  },\n\n  background(_) {\n    return arguments.length ? this.signal('background', _) : this.signal('background');\n  },\n\n  renderer(type) {\n    if (!arguments.length) return this._renderType;\n    if (!renderModule(type)) error('Unrecognized renderer type: ' + type);\n\n    if (type !== this._renderType) {\n      this._renderType = type;\n\n      this._resetRenderer();\n    }\n\n    return this;\n  },\n\n  tooltip(handler) {\n    if (!arguments.length) return this._tooltip;\n\n    if (handler !== this._tooltip) {\n      this._tooltip = handler;\n\n      this._resetRenderer();\n    }\n\n    return this;\n  },\n\n  loader(loader) {\n    if (!arguments.length) return this._loader;\n\n    if (loader !== this._loader) {\n      Dataflow.prototype.loader.call(this, loader);\n\n      this._resetRenderer();\n    }\n\n    return this;\n  },\n\n  resize() {\n    // set flag to perform autosize\n    this._autosize = 1; // touch autosize signal to ensure top-level ViewLayout runs\n\n    return this.touch(lookupSignal(this, 'autosize'));\n  },\n\n  _resetRenderer() {\n    if (this._renderer) {\n      this._renderer = null;\n      this.initialize(this._el, this._elBind);\n    }\n  },\n\n  // -- SIZING ----\n  _resizeView: resizeView,\n\n  // -- EVENT HANDLING ----\n  addEventListener(type, handler, options) {\n    let callback = handler;\n\n    if (!(options && options.trap === false)) {\n      // wrap callback in error handler\n      callback = trap(this, handler);\n      callback.raw = handler;\n    }\n\n    this._handler.on(type, callback);\n\n    return this;\n  },\n\n  removeEventListener(type, handler) {\n    var handlers = this._handler.handlers(type),\n        i = handlers.length,\n        h,\n        t; // search registered handlers, remove if match found\n\n\n    while (--i >= 0) {\n      t = handlers[i].type;\n      h = handlers[i].handler;\n\n      if (type === t && (handler === h || handler === h.raw)) {\n        this._handler.off(t, h);\n\n        break;\n      }\n    }\n\n    return this;\n  },\n\n  addResizeListener(handler) {\n    const l = this._resizeListeners;\n\n    if (l.indexOf(handler) < 0) {\n      // add handler if it isn't already registered\n      // note: error trapping handled elsewhere, so\n      // no need to wrap handlers here\n      l.push(handler);\n    }\n\n    return this;\n  },\n\n  removeResizeListener(handler) {\n    var l = this._resizeListeners,\n        i = l.indexOf(handler);\n\n    if (i >= 0) {\n      l.splice(i, 1);\n    }\n\n    return this;\n  },\n\n  addSignalListener(name, handler) {\n    return addOperatorListener(this, name, lookupSignal(this, name), handler);\n  },\n\n  removeSignalListener(name, handler) {\n    return removeOperatorListener(this, lookupSignal(this, name), handler);\n  },\n\n  addDataListener(name, handler) {\n    return addOperatorListener(this, name, dataref(this, name).values, handler);\n  },\n\n  removeDataListener(name, handler) {\n    return removeOperatorListener(this, dataref(this, name).values, handler);\n  },\n\n  globalCursor(_) {\n    if (arguments.length) {\n      if (this._globalCursor !== !!_) {\n        const prev = setCursor(this, null); // clear previous cursor\n\n        this._globalCursor = !!_;\n        if (prev) setCursor(this, prev); // swap cursor\n      }\n\n      return this;\n    } else {\n      return this._globalCursor;\n    }\n  },\n\n  preventDefault(_) {\n    if (arguments.length) {\n      this._preventDefault = _;\n      return this;\n    } else {\n      return this._preventDefault;\n    }\n  },\n\n  timer,\n  events,\n  finalize,\n  hover,\n  // -- DATA ----\n  data,\n  change,\n  insert,\n  remove,\n  // -- SCALES --\n  scale,\n  // -- INITIALIZATION ----\n  initialize,\n  // -- HEADLESS RENDERING ----\n  toImageURL: renderToImageURL,\n  toCanvas: renderToCanvas,\n  toSVG: renderToSVG,\n  // -- SAVE / RESTORE STATE ----\n  getState,\n  setState\n});\n\nexport { View };\n"]},"metadata":{},"sourceType":"module"}