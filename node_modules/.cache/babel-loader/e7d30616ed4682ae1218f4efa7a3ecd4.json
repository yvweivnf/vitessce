{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { GL, GLType } from '@loaders.gl/math';\n\nvar Tile3DFeatureTable = /*#__PURE__*/function () {\n  function Tile3DFeatureTable(featureTableJson, featureTableBinary) {\n    _classCallCheck(this, Tile3DFeatureTable);\n\n    _defineProperty(this, \"json\", void 0);\n\n    _defineProperty(this, \"buffer\", void 0);\n\n    _defineProperty(this, \"featuresLength\", 0);\n\n    _defineProperty(this, \"_cachedTypedArrays\", {});\n\n    this.json = featureTableJson;\n    this.buffer = featureTableBinary;\n  }\n\n  _createClass(Tile3DFeatureTable, [{\n    key: \"getExtension\",\n    value: function getExtension(extensionName) {\n      return this.json.extensions && this.json.extensions[extensionName];\n    }\n  }, {\n    key: \"hasProperty\",\n    value: function hasProperty(propertyName) {\n      return Boolean(this.json[propertyName]);\n    }\n  }, {\n    key: \"getGlobalProperty\",\n    value: function getGlobalProperty(propertyName) {\n      var componentType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : GL.UNSIGNED_INT;\n      var componentLength = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n      var jsonValue = this.json[propertyName];\n\n      if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n        return this._getTypedArrayFromBinary(propertyName, componentType, componentLength, 1, jsonValue.byteOffset);\n      }\n\n      return jsonValue;\n    }\n  }, {\n    key: \"getPropertyArray\",\n    value: function getPropertyArray(propertyName, componentType, componentLength) {\n      var jsonValue = this.json[propertyName];\n\n      if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n        if ('componentType' in jsonValue) {\n          componentType = GLType.fromName(jsonValue.componentType);\n        }\n\n        return this._getTypedArrayFromBinary(propertyName, componentType, componentLength, this.featuresLength, jsonValue.byteOffset);\n      }\n\n      return this._getTypedArrayFromArray(propertyName, componentType, jsonValue);\n    }\n  }, {\n    key: \"getProperty\",\n    value: function getProperty(propertyName, componentType, componentLength, featureId, result) {\n      var jsonValue = this.json[propertyName];\n\n      if (!jsonValue) {\n        return jsonValue;\n      }\n\n      var typedArray = this.getPropertyArray(propertyName, componentType, componentLength);\n\n      if (componentLength === 1) {\n        return typedArray[featureId];\n      }\n\n      for (var i = 0; i < componentLength; ++i) {\n        result[i] = typedArray[componentLength * featureId + i];\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_getTypedArrayFromBinary\",\n    value: function _getTypedArrayFromBinary(propertyName, componentType, componentLength, count, byteOffset) {\n      var cachedTypedArrays = this._cachedTypedArrays;\n      var typedArray = cachedTypedArrays[propertyName];\n\n      if (!typedArray) {\n        typedArray = GLType.createTypedArray(componentType, this.buffer.buffer, this.buffer.byteOffset + byteOffset, count * componentLength);\n        cachedTypedArrays[propertyName] = typedArray;\n      }\n\n      return typedArray;\n    }\n  }, {\n    key: \"_getTypedArrayFromArray\",\n    value: function _getTypedArrayFromArray(propertyName, componentType, array) {\n      var cachedTypedArrays = this._cachedTypedArrays;\n      var typedArray = cachedTypedArrays[propertyName];\n\n      if (!typedArray) {\n        typedArray = GLType.createTypedArray(componentType, array);\n        cachedTypedArrays[propertyName] = typedArray;\n      }\n\n      return typedArray;\n    }\n  }]);\n\n  return Tile3DFeatureTable;\n}();\n\nexport { Tile3DFeatureTable as default };","map":{"version":3,"sources":["../../../../src/lib/classes/tile-3d-feature-table.ts"],"names":["constructor","Boolean","componentType","GL","componentLength","jsonValue","Number","GLType","typedArray","i","result","cachedTypedArrays","count"],"mappings":"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","sourcesContent":["// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\nimport {GL, GLType} from '@loaders.gl/math';\n\n// Reference:\n// https://github.com/AnalyticalGraphicsInc/cesium/blob/1de96d087f0b17575eb1a3f736407b348c765d59/Source/Scene/Cesium3DTileFeatureTable.js\nexport default class Tile3DFeatureTable {\n  json;\n  buffer;\n  featuresLength = 0;\n  _cachedTypedArrays = {};\n\n  constructor(featureTableJson, featureTableBinary) {\n    this.json = featureTableJson;\n    this.buffer = featureTableBinary;\n  }\n\n  getExtension(extensionName) {\n    return this.json.extensions && this.json.extensions[extensionName];\n  }\n\n  hasProperty(propertyName) {\n    return Boolean(this.json[propertyName]);\n  }\n\n  getGlobalProperty(propertyName, componentType = GL.UNSIGNED_INT, componentLength = 1) {\n    const jsonValue = this.json[propertyName];\n\n    if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n      return this._getTypedArrayFromBinary(\n        propertyName,\n        componentType,\n        componentLength,\n        1,\n        jsonValue.byteOffset\n      );\n    }\n\n    return jsonValue;\n  }\n\n  getPropertyArray(propertyName, componentType, componentLength) {\n    const jsonValue = this.json[propertyName];\n\n    if (jsonValue && Number.isFinite(jsonValue.byteOffset)) {\n      if ('componentType' in jsonValue) {\n        componentType = GLType.fromName(jsonValue.componentType);\n      }\n      return this._getTypedArrayFromBinary(\n        propertyName,\n        componentType,\n        componentLength,\n        this.featuresLength,\n        jsonValue.byteOffset\n      );\n    }\n\n    return this._getTypedArrayFromArray(propertyName, componentType, jsonValue);\n  }\n\n  getProperty(propertyName, componentType, componentLength, featureId, result) {\n    const jsonValue = this.json[propertyName];\n    if (!jsonValue) {\n      return jsonValue;\n    }\n\n    const typedArray = this.getPropertyArray(propertyName, componentType, componentLength);\n\n    if (componentLength === 1) {\n      return typedArray[featureId];\n    }\n\n    for (let i = 0; i < componentLength; ++i) {\n      result[i] = typedArray[componentLength * featureId + i];\n    }\n\n    return result;\n  }\n\n  // HELPERS\n\n  _getTypedArrayFromBinary(propertyName, componentType, componentLength, count, byteOffset) {\n    const cachedTypedArrays = this._cachedTypedArrays;\n    let typedArray = cachedTypedArrays[propertyName];\n    if (!typedArray) {\n      typedArray = GLType.createTypedArray(\n        componentType,\n        this.buffer.buffer,\n        this.buffer.byteOffset + byteOffset,\n        count * componentLength\n      );\n      cachedTypedArrays[propertyName] = typedArray;\n    }\n    return typedArray;\n  }\n\n  _getTypedArrayFromArray(propertyName, componentType, array) {\n    const cachedTypedArrays = this._cachedTypedArrays;\n    let typedArray = cachedTypedArrays[propertyName];\n    if (!typedArray) {\n      typedArray = GLType.createTypedArray(componentType, array);\n      cachedTypedArrays[propertyName] = typedArray;\n    }\n    return typedArray;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}