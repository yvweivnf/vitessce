{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useMemo,useEffect}from'react';import isEqual from'lodash/isEqual';import{sum}from'd3-array';import TitleInfo from'../TitleInfo';import{useReady,useUrls,useGridItemSize}from'../hooks';import{useCoordination,useLoaders}from'../../app/state/hooks';import{COMPONENT_COORDINATION_TYPES}from'../../app/state/coordination';import{useGenomicProfilesData}from'../data-hooks';import HiGlassLazy from'./HiGlassLazy';var GENOMIC_PROFILES_DATA_TYPES=['genomic-profiles'];var REFERENCE_TILESETS={hg38:{chromosomes:'NyITQvZsS_mOFNlz5C2LJg',genes:'P0PLbQMwTYGy-5uPIQid7A'},hg19:{chromosomes:'N12wVGG9SPiTkk03yUayUw',genes:'OHJakQICQD6gTD7skx4EWA'},mm9:{chromosomes:'WAVhNHYxQVueq6KulwgWiQ',genes:'GUm5aBiLRCyz2PsBea7Yzg'},mm10:{chromosomes:'EtrWT0VtScixmsmwFSd7zg',genes:'QDutvmyiSrec5nX4pA5WGQ'}};/**\n * A component for visualization of genomic profiles\n * with genome-wide bar plots.\n * @param {object} props The component props.\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.profileTrackUidKey The key in the genomic profiles row_info that identifies\n * each track. By default, 'path'.\n * @param {string} props.profileTrackNameKey The key in the genomic profiles row_info that\n * gives a name for each track. By default, null. When null is provided, uses the\n * profileTrackUidKey for both UID and name. If UID values are path arrays,\n * they will be converted to name strings.\n * @param {string} props.higlassServer The URL for the higlass server used to retreive\n * reference tilesets for the chromosome and gene annotations.\n * @param {string} props.assembly The genome assembly to use for the reference\n * tilesets for the chromosome and gene annotations.\n * @param {string} props.title The title of the component.\n */export default function GenomicProfilesSubscriber(props){var coordinationScopes=props.coordinationScopes,theme=props.theme,removeGridComponent=props.removeGridComponent,_props$profileTrackUi=props.profileTrackUidKey,profileTrackUidKey=_props$profileTrackUi===void 0?'path':_props$profileTrackUi,_props$profileTrackNa=props.profileTrackNameKey,profileTrackNameKey=_props$profileTrackNa===void 0?null:_props$profileTrackNa,_props$higlassServer=props.higlassServer,higlassServer=_props$higlassServer===void 0?'https://higlass.io/api/v1':_props$higlassServer,_props$assembly=props.assembly,assembly=_props$assembly===void 0?'hg38':_props$assembly,_props$title=props.title,title=_props$title===void 0?'Genomic Profiles':_props$title;// eslint-disable-next-line no-unused-vars\nvar _useGridItemSize=useGridItemSize(),_useGridItemSize2=_slicedToArray(_useGridItemSize,3),width=_useGridItemSize2[0],height=_useGridItemSize2[1],containerRef=_useGridItemSize2[2];var loaders=useLoaders();// Get \"props\" from the coordination space.\nvar _useCoordination=useCoordination(COMPONENT_COORDINATION_TYPES.genomicProfiles,coordinationScopes),_useCoordination2=_slicedToArray(_useCoordination,1),_useCoordination2$=_useCoordination2[0],dataset=_useCoordination2$.dataset,cellSetColor=_useCoordination2$.obsSetColor,cellSetSelection=_useCoordination2$.obsSetSelection;// eslint-disable-next-line no-unused-vars\nvar _useReady=useReady(GENOMIC_PROFILES_DATA_TYPES),_useReady2=_slicedToArray(_useReady,4),isReady=_useReady2[0],setItemIsReady=_useReady2[1],setItemIsNotReady=_useReady2[2],// eslint-disable-line no-unused-vars\nresetReadyItems=_useReady2[3];// eslint-disable-next-line no-unused-vars\nvar _useUrls=useUrls(),_useUrls2=_slicedToArray(_useUrls,3),urls=_useUrls2[0],addUrl=_useUrls2[1],resetUrls=_useUrls2[2];var _useGenomicProfilesDa=useGenomicProfilesData(loaders,dataset,setItemIsReady,addUrl,true),_useGenomicProfilesDa2=_slicedToArray(_useGenomicProfilesDa,1),genomicProfilesAttrs=_useGenomicProfilesDa2[0];var hgViewConfig=useMemo(function(){if(!genomicProfilesAttrs||urls.length!==1){return null;}// Get the URL to the data file from the downloadable URLs array.\nvar url=urls[0].url;// Set up the colors to use in the HiGlass view config based on the current theme.\nvar foregroundColor=theme==='dark'?'#C0C0C0':'#000000';var backgroundColor=theme==='dark'?'#000000':'#f1f1f1';var dimColor=theme==='dark'?'dimgray':'silver';// Define the \"reference tracks\" for chromosome labels and gene annotations.\nvar referenceTracks=[{type:'horizontal-chromosome-labels',server:higlassServer,tilesetUid:REFERENCE_TILESETS[assembly].chromosomes,uid:'chromosome-labels',options:{color:foregroundColor,fontSize:12,fontIsLeftAligned:false,showMousePosition:true,mousePositionColor:foregroundColor},height:30},{type:'horizontal-gene-annotations',server:higlassServer,tilesetUid:REFERENCE_TILESETS[assembly].genes,uid:'gene-annotations',options:{name:'Gene Annotations (hg38)',fontSize:10,labelPosition:'hidden',labelLeftMargin:0,labelRightMargin:0,labelTopMargin:0,labelBottomMargin:0,minHeight:24,geneAnnotationHeight:16,geneLabelPosition:'outside',geneStrandSpacing:4,showMousePosition:true,mousePositionColor:foregroundColor,plusStrandColor:foregroundColor,minusStrandColor:foregroundColor,labelColor:'black',labelBackgroundColor:backgroundColor,trackBorderWidth:0,trackBorderColor:'black'},height:70}];// Determine the heights of each profile track by subtracting the\n// reference track heights from the component height, then\n// dividing by the number of profiles.\nvar referenceTracksHeightSum=sum(referenceTracks.map(function(t){return t.height;}));var profileTracksHeightSum=height-referenceTracksHeightSum-10;var profileTrackHeight=profileTracksHeightSum/genomicProfilesAttrs.row_infos.length;var profileTracks=genomicProfilesAttrs.row_infos.map(function(rowInfo,i){var _cellSetColor$find;// Get the uid for the HiGlass track.\nvar trackUid=rowInfo[profileTrackUidKey];// When profiles correspond to cell sets, the profile UID will be the cell set path array.\nvar isPath=Array.isArray(trackUid);// Get the name for the HiGlass track: try the name key first,\n// then try the tail of the path, and otherwise the track UID.\n// eslint-disable-next-line no-nested-ternary\nvar trackName=profileTrackNameKey?rowInfo[profileTrackNameKey]:isPath?trackUid[trackUid.length-1]:trackUid;// If the uid is a path, then try to get the corresponding cell set's color,\n// if it is currently selected.\nvar setInSelection=isPath?cellSetSelection===null||cellSetSelection===void 0?void 0:cellSetSelection.find(function(s){return isEqual(s,trackUid);}):false;var setColor=isPath?cellSetColor===null||cellSetColor===void 0?void 0:(_cellSetColor$find=cellSetColor.find(function(s){return isEqual(s.path,trackUid);}))===null||_cellSetColor$find===void 0?void 0:_cellSetColor$find.color:null;// Get the track UID as a string before passing to HiGlass.\nvar trackUidString=isPath?trackUid.join('__'):trackUid;// Create the HiGlass track definition for this profile.\nvar track={type:'horizontal-bar',uid:\"bar-track-\".concat(trackUidString),data:{type:'zarr-multivec',url:url,row:i},options:{name:trackName,showMousePosition:true,mousePositionColor:foregroundColor,labelColor:theme==='dark'?'white':'black',labelBackgroundColor:theme==='dark'?'black':'white',labelShowAssembly:false},height:profileTrackHeight};// Set the track color if it is available.\nif(setColor&&setInSelection){var c=setColor;track.options.barFillColor=\"rgb(\".concat(c[0],\",\").concat(c[1],\",\").concat(c[2],\")\");}else{track.options.barFillColor=dimColor;}return track;});// Create the higlass view.\n// The HiGlassLazy component will fill in the fields 'uid',\n// 'initialXDomain', and 'initialYDomain'.\nvar hgView={tracks:{top:[].concat(referenceTracks,_toConsumableArray(profileTracks)),left:[],center:[],right:[],bottom:[],whole:[],gallery:[]},layout:{w:12,h:12,x:0,y:0,static:false}};return hgView;},[genomicProfilesAttrs,urls,theme,height,profileTrackUidKey,profileTrackNameKey,cellSetSelection,cellSetColor,higlassServer,assembly]);// Reset file URLs and loader progress when the dataset has changed.\nuseEffect(function(){resetUrls();resetReadyItems();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[loaders,dataset]);return/*#__PURE__*/React.createElement(\"div\",{className:\"higlass-title-wrapper\"},/*#__PURE__*/React.createElement(TitleInfo,{title:title,removeGridComponent:removeGridComponent,theme:theme,isReady:isReady,urls:urls},/*#__PURE__*/React.createElement(\"div\",{className:\"higlass-lazy-wrapper\",ref:containerRef},hgViewConfig?/*#__PURE__*/React.createElement(HiGlassLazy,{coordinationScopes:coordinationScopes,theme:theme,hgViewConfig:hgViewConfig,height:height}):null)));}","map":{"version":3,"sources":["C:/Users/wkuo/Documents/vitessce-forked-v1.2.2/vitessce/src/components/higlass/GenomicProfilesSubscriber.js"],"names":["React","useMemo","useEffect","isEqual","sum","TitleInfo","useReady","useUrls","useGridItemSize","useCoordination","useLoaders","COMPONENT_COORDINATION_TYPES","useGenomicProfilesData","HiGlassLazy","GENOMIC_PROFILES_DATA_TYPES","REFERENCE_TILESETS","hg38","chromosomes","genes","hg19","mm9","mm10","GenomicProfilesSubscriber","props","coordinationScopes","theme","removeGridComponent","profileTrackUidKey","profileTrackNameKey","higlassServer","assembly","title","width","height","containerRef","loaders","genomicProfiles","dataset","cellSetColor","obsSetColor","cellSetSelection","obsSetSelection","isReady","setItemIsReady","setItemIsNotReady","resetReadyItems","urls","addUrl","resetUrls","genomicProfilesAttrs","hgViewConfig","length","url","foregroundColor","backgroundColor","dimColor","referenceTracks","type","server","tilesetUid","uid","options","color","fontSize","fontIsLeftAligned","showMousePosition","mousePositionColor","name","labelPosition","labelLeftMargin","labelRightMargin","labelTopMargin","labelBottomMargin","minHeight","geneAnnotationHeight","geneLabelPosition","geneStrandSpacing","plusStrandColor","minusStrandColor","labelColor","labelBackgroundColor","trackBorderWidth","trackBorderColor","referenceTracksHeightSum","map","t","profileTracksHeightSum","profileTrackHeight","row_infos","profileTracks","rowInfo","i","trackUid","isPath","Array","isArray","trackName","setInSelection","find","s","setColor","path","trackUidString","join","track","data","row","labelShowAssembly","c","barFillColor","hgView","tracks","top","left","center","right","bottom","whole","gallery","layout","w","h","x","y","static"],"mappings":"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","sourcesContent":["import React, {\n  useMemo, useEffect,\n} from 'react';\nimport isEqual from 'lodash/isEqual';\nimport { sum } from 'd3-array';\nimport TitleInfo from '../TitleInfo';\nimport { useReady, useUrls, useGridItemSize } from '../hooks';\nimport {\n  useCoordination, useLoaders,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\nimport { useGenomicProfilesData } from '../data-hooks';\nimport HiGlassLazy from './HiGlassLazy';\n\nconst GENOMIC_PROFILES_DATA_TYPES = ['genomic-profiles'];\n\nconst REFERENCE_TILESETS = {\n  hg38: {\n    chromosomes: 'NyITQvZsS_mOFNlz5C2LJg',\n    genes: 'P0PLbQMwTYGy-5uPIQid7A',\n  },\n  hg19: {\n    chromosomes: 'N12wVGG9SPiTkk03yUayUw',\n    genes: 'OHJakQICQD6gTD7skx4EWA',\n  },\n  mm9: {\n    chromosomes: 'WAVhNHYxQVueq6KulwgWiQ',\n    genes: 'GUm5aBiLRCyz2PsBea7Yzg',\n  },\n  mm10: {\n    chromosomes: 'EtrWT0VtScixmsmwFSd7zg',\n    genes: 'QDutvmyiSrec5nX4pA5WGQ',\n  },\n};\n\n/**\n * A component for visualization of genomic profiles\n * with genome-wide bar plots.\n * @param {object} props The component props.\n * @param {string} props.theme The current theme name.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.profileTrackUidKey The key in the genomic profiles row_info that identifies\n * each track. By default, 'path'.\n * @param {string} props.profileTrackNameKey The key in the genomic profiles row_info that\n * gives a name for each track. By default, null. When null is provided, uses the\n * profileTrackUidKey for both UID and name. If UID values are path arrays,\n * they will be converted to name strings.\n * @param {string} props.higlassServer The URL for the higlass server used to retreive\n * reference tilesets for the chromosome and gene annotations.\n * @param {string} props.assembly The genome assembly to use for the reference\n * tilesets for the chromosome and gene annotations.\n * @param {string} props.title The title of the component.\n */\nexport default function GenomicProfilesSubscriber(props) {\n  const {\n    coordinationScopes,\n    theme,\n    removeGridComponent,\n    profileTrackUidKey = 'path',\n    profileTrackNameKey = null,\n    higlassServer = 'https://higlass.io/api/v1',\n    assembly = 'hg38',\n    title = 'Genomic Profiles',\n  } = props;\n\n  // eslint-disable-next-line no-unused-vars\n  const [width, height, containerRef] = useGridItemSize();\n  const loaders = useLoaders();\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    obsSetColor: cellSetColor,\n    obsSetSelection: cellSetSelection,\n  }] = useCoordination(\n    COMPONENT_COORDINATION_TYPES.genomicProfiles,\n    coordinationScopes,\n  );\n\n  // eslint-disable-next-line no-unused-vars\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    GENOMIC_PROFILES_DATA_TYPES,\n  );\n    // eslint-disable-next-line no-unused-vars\n  const [urls, addUrl, resetUrls] = useUrls();\n\n  const [genomicProfilesAttrs] = useGenomicProfilesData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n\n  const hgViewConfig = useMemo(() => {\n    if (!genomicProfilesAttrs || urls.length !== 1) {\n      return null;\n    }\n    // Get the URL to the data file from the downloadable URLs array.\n    const { url } = urls[0];\n\n    // Set up the colors to use in the HiGlass view config based on the current theme.\n    const foregroundColor = (theme === 'dark' ? '#C0C0C0' : '#000000');\n    const backgroundColor = (theme === 'dark' ? '#000000' : '#f1f1f1');\n    const dimColor = (theme === 'dark' ? 'dimgray' : 'silver');\n\n    // Define the \"reference tracks\" for chromosome labels and gene annotations.\n    const referenceTracks = [\n      {\n        type: 'horizontal-chromosome-labels',\n        server: higlassServer,\n        tilesetUid: REFERENCE_TILESETS[assembly].chromosomes,\n        uid: 'chromosome-labels',\n        options: {\n          color: foregroundColor,\n          fontSize: 12,\n          fontIsLeftAligned: false,\n          showMousePosition: true,\n          mousePositionColor: foregroundColor,\n        },\n        height: 30,\n      },\n      {\n        type: 'horizontal-gene-annotations',\n        server: higlassServer,\n        tilesetUid: REFERENCE_TILESETS[assembly].genes,\n        uid: 'gene-annotations',\n        options: {\n          name: 'Gene Annotations (hg38)',\n          fontSize: 10,\n          labelPosition: 'hidden',\n          labelLeftMargin: 0,\n          labelRightMargin: 0,\n          labelTopMargin: 0,\n          labelBottomMargin: 0,\n          minHeight: 24,\n          geneAnnotationHeight: 16,\n          geneLabelPosition: 'outside',\n          geneStrandSpacing: 4,\n          showMousePosition: true,\n          mousePositionColor: foregroundColor,\n          plusStrandColor: foregroundColor,\n          minusStrandColor: foregroundColor,\n          labelColor: 'black',\n          labelBackgroundColor: backgroundColor,\n          trackBorderWidth: 0,\n          trackBorderColor: 'black',\n        },\n        height: 70,\n      },\n    ];\n    // Determine the heights of each profile track by subtracting the\n    // reference track heights from the component height, then\n    // dividing by the number of profiles.\n    const referenceTracksHeightSum = sum(referenceTracks.map(t => t.height));\n    const profileTracksHeightSum = height - referenceTracksHeightSum - 10;\n    const profileTrackHeight = profileTracksHeightSum / genomicProfilesAttrs.row_infos.length;\n    const profileTracks = genomicProfilesAttrs.row_infos.map((rowInfo, i) => {\n      // Get the uid for the HiGlass track.\n      const trackUid = rowInfo[profileTrackUidKey];\n      // When profiles correspond to cell sets, the profile UID will be the cell set path array.\n      const isPath = Array.isArray(trackUid);\n      // Get the name for the HiGlass track: try the name key first,\n      // then try the tail of the path, and otherwise the track UID.\n      // eslint-disable-next-line no-nested-ternary\n      const trackName = profileTrackNameKey\n        ? rowInfo[profileTrackNameKey]\n        : (isPath ? trackUid[trackUid.length - 1] : trackUid);\n      // If the uid is a path, then try to get the corresponding cell set's color,\n      // if it is currently selected.\n      const setInSelection = isPath ? cellSetSelection?.find(s => isEqual(s, trackUid)) : false;\n      const setColor = isPath ? cellSetColor?.find(s => isEqual(s.path, trackUid))?.color : null;\n      // Get the track UID as a string before passing to HiGlass.\n      const trackUidString = isPath ? trackUid.join('__') : trackUid;\n      // Create the HiGlass track definition for this profile.\n      const track = {\n        type: 'horizontal-bar',\n        uid: `bar-track-${trackUidString}`,\n        data: {\n          type: 'zarr-multivec',\n          url,\n          row: i,\n        },\n        options: {\n          name: trackName,\n          showMousePosition: true,\n          mousePositionColor: foregroundColor,\n          labelColor: (theme === 'dark' ? 'white' : 'black'),\n          labelBackgroundColor: (theme === 'dark' ? 'black' : 'white'),\n          labelShowAssembly: false,\n        },\n        height: profileTrackHeight,\n      };\n      // Set the track color if it is available.\n      if (setColor && setInSelection) {\n        const c = setColor;\n        track.options.barFillColor = `rgb(${c[0]},${c[1]},${c[2]})`;\n      } else {\n        track.options.barFillColor = dimColor;\n      }\n      return track;\n    });\n\n    // Create the higlass view.\n    // The HiGlassLazy component will fill in the fields 'uid',\n    // 'initialXDomain', and 'initialYDomain'.\n    const hgView = {\n      tracks: {\n        top: [\n          ...referenceTracks,\n          ...profileTracks,\n        ],\n        left: [],\n        center: [],\n        right: [],\n        bottom: [],\n        whole: [],\n        gallery: [],\n      },\n      layout: {\n        w: 12,\n        h: 12,\n        x: 0,\n        y: 0,\n        static: false,\n      },\n    };\n    return hgView;\n  }, [genomicProfilesAttrs, urls, theme, height, profileTrackUidKey,\n    profileTrackNameKey, cellSetSelection, cellSetColor,\n    higlassServer, assembly]);\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  return (\n    <div className=\"higlass-title-wrapper\">\n      <TitleInfo\n        title={title}\n        removeGridComponent={removeGridComponent}\n        theme={theme}\n        isReady={isReady}\n        urls={urls}\n      >\n        <div className=\"higlass-lazy-wrapper\" ref={containerRef}>\n          {hgViewConfig ? (\n            <HiGlassLazy\n              coordinationScopes={coordinationScopes}\n              theme={theme}\n              hgViewConfig={hgViewConfig}\n              height={height}\n            />\n          ) : null}\n        </div>\n      </TitleInfo>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}