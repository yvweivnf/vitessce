{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _get from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";\nimport _inherits from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport { default as LayersPass } from './layers-pass';\nimport { Framebuffer, Texture2D, Renderbuffer, withParameters, cssToDeviceRatio } from '@luma.gl/core';\n\nvar ShadowPass = /*#__PURE__*/function (_LayersPass) {\n  _inherits(ShadowPass, _LayersPass);\n\n  var _super = _createSuper(ShadowPass);\n\n  function ShadowPass(gl, props) {\n    var _parameters, _attachments;\n\n    var _this;\n\n    _classCallCheck(this, ShadowPass);\n\n    _this = _super.call(this, gl, props);\n    _this.shadowMap = new Texture2D(gl, {\n      width: 1,\n      height: 1,\n      parameters: (_parameters = {}, _defineProperty(_parameters, 10241, 9729), _defineProperty(_parameters, 10240, 9729), _defineProperty(_parameters, 10242, 33071), _defineProperty(_parameters, 10243, 33071), _parameters)\n    });\n    _this.depthBuffer = new Renderbuffer(gl, {\n      format: 33189,\n      width: 1,\n      height: 1\n    });\n    _this.fbo = new Framebuffer(gl, {\n      id: 'shadowmap',\n      width: 1,\n      height: 1,\n      attachments: (_attachments = {}, _defineProperty(_attachments, 36064, _this.shadowMap), _defineProperty(_attachments, 36096, _this.depthBuffer), _attachments)\n    });\n    return _this;\n  }\n\n  _createClass(ShadowPass, [{\n    key: \"render\",\n    value: function render(params) {\n      var _this2 = this;\n\n      var target = this.fbo;\n      withParameters(this.gl, {\n        depthRange: [0, 1],\n        depthTest: true,\n        blend: false,\n        clearColor: [1, 1, 1, 1]\n      }, function () {\n        var viewport = params.viewports[0];\n        var pixelRatio = cssToDeviceRatio(_this2.gl);\n        var width = viewport.width * pixelRatio;\n        var height = viewport.height * pixelRatio;\n\n        if (width !== target.width || height !== target.height) {\n          target.resize({\n            width: width,\n            height: height\n          });\n        }\n\n        _get(_getPrototypeOf(ShadowPass.prototype), \"render\", _this2).call(_this2, _objectSpread({}, params, {\n          target: target,\n          pass: 'shadow'\n        }));\n      });\n    }\n  }, {\n    key: \"shouldDrawLayer\",\n    value: function shouldDrawLayer(layer) {\n      return layer.props.shadowEnabled !== false;\n    }\n  }, {\n    key: \"getModuleParameters\",\n    value: function getModuleParameters() {\n      return {\n        drawToShadowMap: true\n      };\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete() {\n      if (this.fbo) {\n        this.fbo.delete();\n        this.fbo = null;\n      }\n\n      if (this.shadowMap) {\n        this.shadowMap.delete();\n        this.shadowMap = null;\n      }\n\n      if (this.depthBuffer) {\n        this.depthBuffer.delete();\n        this.depthBuffer = null;\n      }\n    }\n  }]);\n\n  return ShadowPass;\n}(LayersPass);\n\nexport { ShadowPass as default };","map":{"version":3,"sources":["../../../src/passes/shadow-pass.js"],"names":["default","constructor","width","height","parameters","format","id","attachments","depthBuffer","target","withParameters","depthRange","depthTest","blend","clearColor","viewport","params","pixelRatio","cssToDeviceRatio","pass","layer","drawToShadowMap"],"mappings":";;;;;;;;AAAA,SAAQA,OAAO,IAAf,UAAA,QAAA,eAAA;AACA,SAAA,WAAA,EAAA,SAAA,EAAA,YAAA,EAAA,cAAA,EAAA,gBAAA,QAAA,eAAA;;IAQe,U;;;;;AACbC,sBAAW,EAAXA,EAAW,KAAXA,EAAuB;AAAA;;AAAA;;AAAA;;AACrB,8BAAA,EAAA,EAAA,KAAA;AAGA,UAAA,SAAA,GAAiB,IAAA,SAAA,CAAA,EAAA,EAAkB;AACjCC,MAAAA,KAAK,EAD4B,CAAA;AAEjCC,MAAAA,MAAM,EAF2B,CAAA;AAGjCC,MAAAA,UAAU,kDACR,KADQ,EAAE,IAAF,gCAER,KAFQ,EAAE,IAAF,gCAGR,KAHQ,EAAE,KAAF,gCAIR,KAJQ,EAIR,KAJQ;AAHuB,KAAlB,CAAjB;AAWA,UAAA,WAAA,GAAmB,IAAA,YAAA,CAAA,EAAA,EAAqB;AACtCC,MAAAA,MAAM,EADgC,KAAA;AAEtCH,MAAAA,KAAK,EAFiC,CAAA;AAGtCC,MAAAA,MAAM,EAAE;AAH8B,KAArB,CAAnB;AAMA,UAAA,GAAA,GAAW,IAAA,WAAA,CAAA,EAAA,EAAoB;AAC7BG,MAAAA,EAAE,EAD2B,WAAA;AAE7BJ,MAAAA,KAAK,EAFwB,CAAA;AAG7BC,MAAAA,MAAM,EAHuB,CAAA;AAI7BI,MAAAA,WAAW,oDACT,KADS,EACe,MADb,SAAF,iCAGT,KAHS,EAGc,MAAKC,WAHnB;AAJkB,KAApB,CAAX;AArBqB;AA+BtB;;;;2BAEK,M,EAAS;AAAA;;AACb,UAAMC,MAAM,GAAG,KAAf,GAAA;AAEAC,MAAAA,cAAc,CACZ,KADY,EAAA,EAEZ;AACEC,QAAAA,UAAU,EAAE,CAAA,CAAA,EADd,CACc,CADd;AAEEC,QAAAA,SAAS,EAFX,IAAA;AAGEC,QAAAA,KAAK,EAHP,KAAA;AAIEC,QAAAA,UAAU,EAAE,CAAA,CAAA,EAAA,CAAA,EAAA,CAAA,EAAA,CAAA;AAJd,OAFY,EAQZ,YAAM;AACJ,YAAMC,QAAQ,GAAGC,MAAM,CAANA,SAAAA,CAAjB,CAAiBA,CAAjB;AACA,YAAMC,UAAU,GAAGC,gBAAgB,CAAC,MAAA,CAApC,EAAmC,CAAnC;AACA,YAAMhB,KAAK,GAAGa,QAAQ,CAARA,KAAAA,GAAd,UAAA;AACA,YAAMZ,MAAM,GAAGY,QAAQ,CAARA,MAAAA,GAAf,UAAA;;AACA,YAAIb,KAAK,KAAKO,MAAM,CAAhBP,KAAAA,IAA0BC,MAAM,KAAKM,MAAM,CAA/C,MAAA,EAAwD;AACtDA,UAAAA,MAAM,CAANA,MAAAA,CAAc;AAACP,YAAAA,KAAD,EAACA,KAAD;AAAQC,YAAAA,MAAAA,EAAAA;AAAR,WAAdM;AACD;;AAED,qGAAa,MAAb;AAAyBA,UAAAA,MAAZ,EAAYA,MAAzB;AAAiCU,UAAAA,IAAI,EAAE;AAAvC;AAjBJT,OAAc,CAAdA;AAoBD;;;oCAEc,K,EAAQ;AACrB,aAAOU,KAAK,CAALA,KAAAA,CAAAA,aAAAA,KAAP,KAAA;AACD;;;0CAEqB;AACpB,aAAO;AACLC,QAAAA,eAAe,EAAE;AADZ,OAAP;AAGD;;;8BAEQ;AACP,UAAI,KAAJ,GAAA,EAAc;AACZ,aAAA,GAAA,CAAA,MAAA;AACA,aAAA,GAAA,GAAA,IAAA;AACD;;AAED,UAAI,KAAJ,SAAA,EAAoB;AAClB,aAAA,SAAA,CAAA,MAAA;AACA,aAAA,SAAA,GAAA,IAAA;AACD;;AAED,UAAI,KAAJ,WAAA,EAAsB;AACpB,aAAA,WAAA,CAAA,MAAA;AACA,aAAA,WAAA,GAAA,IAAA;AACD;AACF;;;;EApFY,U;;SAAA,U","sourcesContent":["import {default as LayersPass} from './layers-pass';\nimport {\n  Framebuffer,\n  Texture2D,\n  Renderbuffer,\n  withParameters,\n  cssToDeviceRatio\n} from '@luma.gl/core';\n\nexport default class ShadowPass extends LayersPass {\n  constructor(gl, props) {\n    super(gl, props);\n\n    // The shadowMap texture\n    this.shadowMap = new Texture2D(gl, {\n      width: 1,\n      height: 1,\n      parameters: {\n        [gl.TEXTURE_MIN_FILTER]: gl.LINEAR,\n        [gl.TEXTURE_MAG_FILTER]: gl.LINEAR,\n        [gl.TEXTURE_WRAP_S]: gl.CLAMP_TO_EDGE,\n        [gl.TEXTURE_WRAP_T]: gl.CLAMP_TO_EDGE\n      }\n    });\n\n    this.depthBuffer = new Renderbuffer(gl, {\n      format: gl.DEPTH_COMPONENT16,\n      width: 1,\n      height: 1\n    });\n\n    this.fbo = new Framebuffer(gl, {\n      id: 'shadowmap',\n      width: 1,\n      height: 1,\n      attachments: {\n        [gl.COLOR_ATTACHMENT0]: this.shadowMap,\n        // Depth attachment has to be specified for depth test to work\n        [gl.DEPTH_ATTACHMENT]: this.depthBuffer\n      }\n    });\n  }\n\n  render(params) {\n    const target = this.fbo;\n\n    withParameters(\n      this.gl,\n      {\n        depthRange: [0, 1],\n        depthTest: true,\n        blend: false,\n        clearColor: [1, 1, 1, 1]\n      },\n      () => {\n        const viewport = params.viewports[0];\n        const pixelRatio = cssToDeviceRatio(this.gl);\n        const width = viewport.width * pixelRatio;\n        const height = viewport.height * pixelRatio;\n        if (width !== target.width || height !== target.height) {\n          target.resize({width, height});\n        }\n\n        super.render({...params, target, pass: 'shadow'});\n      }\n    );\n  }\n\n  shouldDrawLayer(layer) {\n    return layer.props.shadowEnabled !== false;\n  }\n\n  getModuleParameters() {\n    return {\n      drawToShadowMap: true\n    };\n  }\n\n  delete() {\n    if (this.fbo) {\n      this.fbo.delete();\n      this.fbo = null;\n    }\n\n    if (this.shadowMap) {\n      this.shadowMap.delete();\n      this.shadowMap = null;\n    }\n\n    if (this.depthBuffer) {\n      this.depthBuffer.delete();\n      this.depthBuffer = null;\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}