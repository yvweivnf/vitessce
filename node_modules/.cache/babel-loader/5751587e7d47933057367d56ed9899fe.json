{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useCallback,useMemo}from'react';import TitleInfo from'../TitleInfo';import{pluralize,capitalize}from'../../utils';import{useDeckCanvasSize,useReady,useUrls}from'../hooks';import{mergeCellSets}from'../utils';import{useCellsData,useCellSetsData,useExpressionMatrixData}from'../data-hooks';import{getCellColors}from'../interpolate-colors';import{useCoordination,useLoaders,useSetComponentHover,useSetComponentViewInfo}from'../../app/state/hooks';import{COMPONENT_COORDINATION_TYPES}from'../../app/state/coordination';import Heatmap from'./Heatmap';import HeatmapTooltipSubscriber from'./HeatmapTooltipSubscriber';import HeatmapOptions from'./HeatmapOptions';var HEATMAP_DATA_TYPES=['cells','cell-sets','expression-matrix'];/**\n * @param {object} props\n * @param {number} props.uuid The unique identifier for this component.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n * @param {boolean} props.transpose Whether to\n * render as cell-by-gene or gene-by-cell.\n * @param {string} props.observationsLabelOverride The singular\n * form of the name of the observation.\n * @param {string} props.observationsPluralLabelOverride The\n * plural form of the name of the observation.\n * @param {string} props.variablesLabelOverride The singular\n * form of the name of the variable.\n * @param {string} props.variablesPluralLabelOverride The plural\n * form of the name of the variable.\n * @param {boolean} props.disableTooltip Whether to disable the\n * tooltip on mouse hover.\n */export default function HeatmapSubscriber(props){var uuid=props.uuid,coordinationScopes=props.coordinationScopes,removeGridComponent=props.removeGridComponent,theme=props.theme,transpose=props.transpose,_props$observationsLa=props.observationsLabelOverride,observationsLabel=_props$observationsLa===void 0?'cell':_props$observationsLa,_props$observationsPl=props.observationsPluralLabelOverride,observationsPluralLabel=_props$observationsPl===void 0?\"\".concat(observationsLabel,\"s\"):_props$observationsPl,_props$variablesLabel=props.variablesLabelOverride,variablesLabel=_props$variablesLabel===void 0?'gene':_props$variablesLabel,_props$variablesPlura=props.variablesPluralLabelOverride,variablesPluralLabel=_props$variablesPlura===void 0?\"\".concat(variablesLabel,\"s\"):_props$variablesPlura,_props$disableTooltip=props.disableTooltip,disableTooltip=_props$disableTooltip===void 0?false:_props$disableTooltip,_props$title=props.title,title=_props$title===void 0?'Heatmap':_props$title;var loaders=useLoaders();var _setComponentHover=useSetComponentHover();var setComponentViewInfo=useSetComponentViewInfo(uuid);// Get \"props\" from the coordination space.\nvar _useCoordination=useCoordination(COMPONENT_COORDINATION_TYPES.heatmap,coordinationScopes),_useCoordination2=_slicedToArray(_useCoordination,2),_useCoordination2$=_useCoordination2[0],dataset=_useCoordination2$.dataset,zoomX=_useCoordination2$.heatmapZoomX,targetX=_useCoordination2$.heatmapTargetX,targetY=_useCoordination2$.heatmapTargetY,geneSelection=_useCoordination2$.featureSelection,cellHighlight=_useCoordination2$.obsHighlight,geneHighlight=_useCoordination2$.featureHighlight,cellSetSelection=_useCoordination2$.obsSetSelection,cellSetColor=_useCoordination2$.obsSetColor,additionalCellSets=_useCoordination2$.additionalObsSets,geneExpressionColormap=_useCoordination2$.featureValueColormap,geneExpressionColormapRange=_useCoordination2$.featureValueColormapRange,_useCoordination2$2=_useCoordination2[1],setZoomX=_useCoordination2$2.setHeatmapZoomX,setZoomY=_useCoordination2$2.setHeatmapZoomY,setTargetX=_useCoordination2$2.setHeatmapTargetX,setTargetY=_useCoordination2$2.setHeatmapTargetY,setCellHighlight=_useCoordination2$2.setObsHighlight,setGeneHighlight=_useCoordination2$2.setFeatureHighlight,setCellSetSelection=_useCoordination2$2.setObsSetSelection,setCellSetColor=_useCoordination2$2.setObsSetColor,setGeneExpressionColormapRange=_useCoordination2$2.setFeatureValueColormapRange,setGeneExpressionColormap=_useCoordination2$2.setFeatureValueColormap;var observationsTitle=capitalize(observationsPluralLabel);var variablesTitle=capitalize(variablesPluralLabel);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isRendering=_useState2[0],setIsRendering=_useState2[1];var _useReady=useReady(HEATMAP_DATA_TYPES),_useReady2=_slicedToArray(_useReady,4),isReady=_useReady2[0],setItemIsReady=_useReady2[1],setItemIsNotReady=_useReady2[2],// eslint-disable-line no-unused-vars\nresetReadyItems=_useReady2[3];var _useUrls=useUrls(),_useUrls2=_slicedToArray(_useUrls,3),urls=_useUrls2[0],addUrl=_useUrls2[1],resetUrls=_useUrls2[2];var _useDeckCanvasSize=useDeckCanvasSize(),_useDeckCanvasSize2=_slicedToArray(_useDeckCanvasSize,3),width=_useDeckCanvasSize2[0],height=_useDeckCanvasSize2[1],deckRef=_useDeckCanvasSize2[2];// Reset file URLs and loader progress when the dataset has changed.\nuseEffect(function(){resetUrls();resetReadyItems();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[loaders,dataset]);// Get data from loaders using the data hooks.\nvar _useCellsData=useCellsData(loaders,dataset,setItemIsReady,addUrl,false),_useCellsData2=_slicedToArray(_useCellsData,1),cells=_useCellsData2[0];var _useExpressionMatrixD=useExpressionMatrixData(loaders,dataset,setItemIsReady,addUrl,true),_useExpressionMatrixD2=_slicedToArray(_useExpressionMatrixD,1),expressionMatrix=_useExpressionMatrixD2[0];var _useCellSetsData=useCellSetsData(loaders,dataset,setItemIsReady,addUrl,false,{setObsSetSelection:setCellSetSelection,setObsSetColor:setCellSetColor},{obsSetSelection:cellSetSelection,obsSetColor:cellSetColor}),_useCellSetsData2=_slicedToArray(_useCellSetsData,1),cellSets=_useCellSetsData2[0];var mergedCellSets=useMemo(function(){return mergeCellSets(cellSets,additionalCellSets);},[cellSets,additionalCellSets]);var cellColors=useMemo(function(){return getCellColors({// Only show cell set selection on heatmap labels.\ncellColorEncoding:'cellSetSelection',geneSelection:geneSelection,cellSets:mergedCellSets,cellSetSelection:cellSetSelection,cellSetColor:cellSetColor,expressionDataAttrs:expressionMatrix,theme:theme});},[mergedCellSets,geneSelection,theme,cellSetColor,cellSetSelection,expressionMatrix]);var getCellInfo=useCallback(function(cellId){if(cellId){var cellInfo=cells[cellId];return _objectSpread(_defineProperty({},\"\".concat(capitalize(observationsLabel),\" ID\"),cellId),cellInfo?cellInfo.factors:{});}return null;},[cells,observationsLabel]);var getGeneInfo=useCallback(function(geneId){if(geneId){return _defineProperty({},\"\".concat(capitalize(variablesLabel),\" ID\"),geneId);}return null;},[variablesLabel]);var setTrackHighlight=useCallback(function(){// No-op, since the default handler\n// logs in the console on every hover event.\n},[]);var cellColorLabels=useMemo(function(){return[\"\".concat(capitalize(observationsLabel),\" Set\")];},[observationsLabel]);var cellsCount=expressionMatrix&&expressionMatrix.rows?expressionMatrix.rows.length:0;var genesCount=expressionMatrix&&expressionMatrix.cols?expressionMatrix.cols.length:0;var selectedCount=cellColors.size;return/*#__PURE__*/React.createElement(TitleInfo,{title:title,info:\"\".concat(cellsCount,\" \").concat(pluralize(observationsLabel,observationsPluralLabel,cellsCount),\" \\xD7 \").concat(genesCount,\" \").concat(pluralize(variablesLabel,variablesPluralLabel,genesCount),\",\\n             with \").concat(selectedCount,\" \").concat(pluralize(observationsLabel,observationsPluralLabel,selectedCount),\" selected\"),urls:urls,theme:theme,removeGridComponent:removeGridComponent,isReady:isReady&&!isRendering,options:/*#__PURE__*/React.createElement(HeatmapOptions,{geneExpressionColormap:geneExpressionColormap,setGeneExpressionColormap:setGeneExpressionColormap,geneExpressionColormapRange:geneExpressionColormapRange,setGeneExpressionColormapRange:setGeneExpressionColormapRange})},/*#__PURE__*/React.createElement(Heatmap,{ref:deckRef,transpose:transpose,viewState:{zoom:zoomX,target:[targetX,targetY]},setViewState:function setViewState(_ref2){var zoom=_ref2.zoom,target=_ref2.target;setZoomX(zoom);setZoomY(zoom);setTargetX(target[0]);setTargetY(target[1]);},colormapRange:geneExpressionColormapRange,setColormapRange:setGeneExpressionColormapRange,height:height,width:width,theme:theme,uuid:uuid,expressionMatrix:expressionMatrix,cellColors:cellColors,colormap:geneExpressionColormap,setIsRendering:setIsRendering,setCellHighlight:setCellHighlight,setGeneHighlight:setGeneHighlight,setTrackHighlight:setTrackHighlight,setComponentHover:function setComponentHover(){_setComponentHover(uuid);},updateViewInfo:setComponentViewInfo,observationsTitle:observationsTitle,variablesTitle:variablesTitle,variablesDashes:false,observationsDashes:false,cellColorLabels:cellColorLabels,useDevicePixels:true}),!disableTooltip&&/*#__PURE__*/React.createElement(HeatmapTooltipSubscriber,{parentUuid:uuid,width:width,height:height,transpose:transpose,getCellInfo:getCellInfo,getGeneInfo:getGeneInfo,cellHighlight:cellHighlight,geneHighlight:geneHighlight}));}","map":{"version":3,"sources":["C:/Users/wkuo/Documents/vitessce-forked-v1.2.2/vitessce/src/components/heatmap/HeatmapSubscriber.js"],"names":["React","useEffect","useState","useCallback","useMemo","TitleInfo","pluralize","capitalize","useDeckCanvasSize","useReady","useUrls","mergeCellSets","useCellsData","useCellSetsData","useExpressionMatrixData","getCellColors","useCoordination","useLoaders","useSetComponentHover","useSetComponentViewInfo","COMPONENT_COORDINATION_TYPES","Heatmap","HeatmapTooltipSubscriber","HeatmapOptions","HEATMAP_DATA_TYPES","HeatmapSubscriber","props","uuid","coordinationScopes","removeGridComponent","theme","transpose","observationsLabelOverride","observationsLabel","observationsPluralLabelOverride","observationsPluralLabel","variablesLabelOverride","variablesLabel","variablesPluralLabelOverride","variablesPluralLabel","disableTooltip","title","loaders","setComponentHover","setComponentViewInfo","heatmap","dataset","zoomX","heatmapZoomX","targetX","heatmapTargetX","targetY","heatmapTargetY","geneSelection","featureSelection","cellHighlight","obsHighlight","geneHighlight","featureHighlight","cellSetSelection","obsSetSelection","cellSetColor","obsSetColor","additionalCellSets","additionalObsSets","geneExpressionColormap","featureValueColormap","geneExpressionColormapRange","featureValueColormapRange","setZoomX","setHeatmapZoomX","setZoomY","setHeatmapZoomY","setTargetX","setHeatmapTargetX","setTargetY","setHeatmapTargetY","setCellHighlight","setObsHighlight","setGeneHighlight","setFeatureHighlight","setCellSetSelection","setObsSetSelection","setCellSetColor","setObsSetColor","setGeneExpressionColormapRange","setFeatureValueColormapRange","setGeneExpressionColormap","setFeatureValueColormap","observationsTitle","variablesTitle","isRendering","setIsRendering","isReady","setItemIsReady","setItemIsNotReady","resetReadyItems","urls","addUrl","resetUrls","width","height","deckRef","cells","expressionMatrix","cellSets","mergedCellSets","cellColors","cellColorEncoding","expressionDataAttrs","getCellInfo","cellId","cellInfo","factors","getGeneInfo","geneId","setTrackHighlight","cellColorLabels","cellsCount","rows","length","genesCount","cols","selectedCount","size","zoom","target"],"mappings":"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","sourcesContent":["import React, {\n  useEffect, useState, useCallback, useMemo,\n} from 'react';\nimport TitleInfo from '../TitleInfo';\nimport { pluralize, capitalize } from '../../utils';\nimport { useDeckCanvasSize, useReady, useUrls } from '../hooks';\nimport { mergeCellSets } from '../utils';\nimport {\n  useCellsData,\n  useCellSetsData,\n  useExpressionMatrixData,\n} from '../data-hooks';\nimport { getCellColors } from '../interpolate-colors';\nimport {\n  useCoordination, useLoaders,\n  useSetComponentHover, useSetComponentViewInfo,\n} from '../../app/state/hooks';\nimport {\n  COMPONENT_COORDINATION_TYPES,\n} from '../../app/state/coordination';\nimport Heatmap from './Heatmap';\nimport HeatmapTooltipSubscriber from './HeatmapTooltipSubscriber';\nimport HeatmapOptions from './HeatmapOptions';\n\nconst HEATMAP_DATA_TYPES = ['cells', 'cell-sets', 'expression-matrix'];\n\n/**\n * @param {object} props\n * @param {number} props.uuid The unique identifier for this component.\n * @param {object} props.coordinationScopes The mapping from coordination types to coordination\n * scopes.\n * @param {function} props.removeGridComponent The callback function to pass to TitleInfo,\n * to call when the component has been removed from the grid.\n * @param {string} props.title The component title.\n * @param {boolean} props.transpose Whether to\n * render as cell-by-gene or gene-by-cell.\n * @param {string} props.observationsLabelOverride The singular\n * form of the name of the observation.\n * @param {string} props.observationsPluralLabelOverride The\n * plural form of the name of the observation.\n * @param {string} props.variablesLabelOverride The singular\n * form of the name of the variable.\n * @param {string} props.variablesPluralLabelOverride The plural\n * form of the name of the variable.\n * @param {boolean} props.disableTooltip Whether to disable the\n * tooltip on mouse hover.\n */\nexport default function HeatmapSubscriber(props) {\n  const {\n    uuid,\n    coordinationScopes,\n    removeGridComponent, theme, transpose,\n    observationsLabelOverride: observationsLabel = 'cell',\n    observationsPluralLabelOverride: observationsPluralLabel = `${observationsLabel}s`,\n    variablesLabelOverride: variablesLabel = 'gene',\n    variablesPluralLabelOverride: variablesPluralLabel = `${variablesLabel}s`,\n    disableTooltip = false,\n    title = 'Heatmap',\n  } = props;\n\n  const loaders = useLoaders();\n  const setComponentHover = useSetComponentHover();\n  const setComponentViewInfo = useSetComponentViewInfo(uuid);\n\n  // Get \"props\" from the coordination space.\n  const [{\n    dataset,\n    heatmapZoomX: zoomX,\n    heatmapTargetX: targetX,\n    heatmapTargetY: targetY,\n    featureSelection: geneSelection,\n    obsHighlight: cellHighlight,\n    featureHighlight: geneHighlight,\n    obsSetSelection: cellSetSelection,\n    obsSetColor: cellSetColor,\n    additionalObsSets: additionalCellSets,\n    featureValueColormap: geneExpressionColormap,\n    featureValueColormapRange: geneExpressionColormapRange,\n  }, {\n    setHeatmapZoomX: setZoomX,\n    setHeatmapZoomY: setZoomY,\n    setHeatmapTargetX: setTargetX,\n    setHeatmapTargetY: setTargetY,\n    setObsHighlight: setCellHighlight,\n    setFeatureHighlight: setGeneHighlight,\n    setObsSetSelection: setCellSetSelection,\n    setObsSetColor: setCellSetColor,\n    setFeatureValueColormapRange: setGeneExpressionColormapRange,\n    setFeatureValueColormap: setGeneExpressionColormap,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.heatmap, coordinationScopes);\n\n  const observationsTitle = capitalize(observationsPluralLabel);\n  const variablesTitle = capitalize(variablesPluralLabel);\n\n  const [isRendering, setIsRendering] = useState(false);\n  const [\n    isReady,\n    setItemIsReady,\n    setItemIsNotReady, // eslint-disable-line no-unused-vars\n    resetReadyItems,\n  ] = useReady(\n    HEATMAP_DATA_TYPES,\n  );\n  const [urls, addUrl, resetUrls] = useUrls();\n  const [width, height, deckRef] = useDeckCanvasSize();\n\n  // Reset file URLs and loader progress when the dataset has changed.\n  useEffect(() => {\n    resetUrls();\n    resetReadyItems();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loaders, dataset]);\n\n  // Get data from loaders using the data hooks.\n  const [cells] = useCellsData(loaders, dataset, setItemIsReady, addUrl, false);\n  const [expressionMatrix] = useExpressionMatrixData(\n    loaders, dataset, setItemIsReady, addUrl, true,\n  );\n  const [cellSets] = useCellSetsData(\n    loaders, dataset, setItemIsReady, addUrl, false,\n    { setObsSetSelection: setCellSetSelection, setObsSetColor: setCellSetColor },\n    { obsSetSelection: cellSetSelection, obsSetColor: cellSetColor },\n  );\n\n  const mergedCellSets = useMemo(() => mergeCellSets(\n    cellSets, additionalCellSets,\n  ), [cellSets, additionalCellSets]);\n\n  const cellColors = useMemo(() => getCellColors({\n    // Only show cell set selection on heatmap labels.\n    cellColorEncoding: 'cellSetSelection',\n    geneSelection,\n    cellSets: mergedCellSets,\n    cellSetSelection,\n    cellSetColor,\n    expressionDataAttrs: expressionMatrix,\n    theme,\n  }), [mergedCellSets, geneSelection, theme,\n    cellSetColor, cellSetSelection, expressionMatrix]);\n\n  const getCellInfo = useCallback((cellId) => {\n    if (cellId) {\n      const cellInfo = cells[cellId];\n      return {\n        [`${capitalize(observationsLabel)} ID`]: cellId,\n        ...(cellInfo ? cellInfo.factors : {}),\n      };\n    }\n    return null;\n  }, [cells, observationsLabel]);\n\n  const getGeneInfo = useCallback((geneId) => {\n    if (geneId) {\n      return { [`${capitalize(variablesLabel)} ID`]: geneId };\n    }\n    return null;\n  }, [variablesLabel]);\n\n  const setTrackHighlight = useCallback(() => {\n    // No-op, since the default handler\n    // logs in the console on every hover event.\n  }, []);\n\n  const cellColorLabels = useMemo(() => ([\n    `${capitalize(observationsLabel)} Set`,\n  ]), [observationsLabel]);\n\n  const cellsCount = expressionMatrix && expressionMatrix.rows\n    ? expressionMatrix.rows.length : 0;\n  const genesCount = expressionMatrix && expressionMatrix.cols\n    ? expressionMatrix.cols.length : 0;\n  const selectedCount = cellColors.size;\n  return (\n    <TitleInfo\n      title={title}\n      info={`${cellsCount} ${pluralize(observationsLabel, observationsPluralLabel, cellsCount)} Ã— ${genesCount} ${pluralize(variablesLabel, variablesPluralLabel, genesCount)},\n             with ${selectedCount} ${pluralize(observationsLabel, observationsPluralLabel, selectedCount)} selected`}\n      urls={urls}\n      theme={theme}\n      removeGridComponent={removeGridComponent}\n      isReady={isReady && !isRendering}\n      options={(\n        <HeatmapOptions\n          geneExpressionColormap={geneExpressionColormap}\n          setGeneExpressionColormap={setGeneExpressionColormap}\n          geneExpressionColormapRange={geneExpressionColormapRange}\n          setGeneExpressionColormapRange={setGeneExpressionColormapRange}\n        />\n      )}\n    >\n      <Heatmap\n        ref={deckRef}\n        transpose={transpose}\n        viewState={{ zoom: zoomX, target: [targetX, targetY] }}\n        setViewState={({ zoom, target }) => {\n          setZoomX(zoom);\n          setZoomY(zoom);\n          setTargetX(target[0]);\n          setTargetY(target[1]);\n        }}\n        colormapRange={geneExpressionColormapRange}\n        setColormapRange={setGeneExpressionColormapRange}\n        height={height}\n        width={width}\n        theme={theme}\n        uuid={uuid}\n        expressionMatrix={expressionMatrix}\n        cellColors={cellColors}\n        colormap={geneExpressionColormap}\n        setIsRendering={setIsRendering}\n        setCellHighlight={setCellHighlight}\n        setGeneHighlight={setGeneHighlight}\n        setTrackHighlight={setTrackHighlight}\n        setComponentHover={() => {\n          setComponentHover(uuid);\n        }}\n        updateViewInfo={setComponentViewInfo}\n        observationsTitle={observationsTitle}\n        variablesTitle={variablesTitle}\n        variablesDashes={false}\n        observationsDashes={false}\n        cellColorLabels={cellColorLabels}\n        useDevicePixels\n      />\n      {!disableTooltip && (\n      <HeatmapTooltipSubscriber\n        parentUuid={uuid}\n        width={width}\n        height={height}\n        transpose={transpose}\n        getCellInfo={getCellInfo}\n        getGeneInfo={getGeneInfo}\n        cellHighlight={cellHighlight}\n        geneHighlight={geneHighlight}\n      />\n      )}\n    </TitleInfo>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}