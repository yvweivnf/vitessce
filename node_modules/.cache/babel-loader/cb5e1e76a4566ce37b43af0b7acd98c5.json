{"ast":null,"code":"import _toConsumableArray from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport { getViewConfigContinuousSize } from '../../config';\nimport { hasDiscreteDomain } from '../../scale';\nimport { getFirstDefined } from '../../util';\nimport { isVgRangeStep } from '../../vega.schema';\nimport { signalOrStringValue } from '../common';\nimport { isFacetModel } from '../model';\nexport function assembleLayoutSignals(model) {\n  return [].concat(_toConsumableArray(sizeSignals(model, 'width')), _toConsumableArray(sizeSignals(model, 'height')), _toConsumableArray(sizeSignals(model, 'childWidth')), _toConsumableArray(sizeSignals(model, 'childHeight')));\n}\nexport function sizeSignals(model, sizeType) {\n  var channel = sizeType === 'width' ? 'x' : 'y';\n  var size = model.component.layoutSize.get(sizeType);\n\n  if (!size || size === 'merged') {\n    return [];\n  } // Read size signal name from name map, just in case it is the top-level size signal that got renamed.\n\n\n  var name = model.getSizeSignalRef(sizeType).signal;\n\n  if (size === 'step') {\n    var scaleComponent = model.getScaleComponent(channel);\n\n    if (scaleComponent) {\n      var type = scaleComponent.get('type');\n      var range = scaleComponent.get('range');\n\n      if (hasDiscreteDomain(type) && isVgRangeStep(range)) {\n        var scaleName = model.scaleName(channel);\n\n        if (isFacetModel(model.parent)) {\n          // If parent is facet and this is an independent scale, return only signal signal\n          // as the width/height will be calculated using the cardinality from\n          // facet's aggregate rather than reading from scale domain\n          var parentResolve = model.parent.component.resolve;\n\n          if (parentResolve.scale[channel] === 'independent') {\n            return [stepSignal(scaleName, range)];\n          }\n        }\n\n        return [stepSignal(scaleName, range), {\n          name: name,\n          update: sizeExpr(scaleName, scaleComponent, \"domain('\".concat(scaleName, \"').length\"))\n        }];\n      }\n    }\n    /* istanbul ignore next: Condition should not happen -- only for warning in development. */\n\n\n    throw new Error('layout size is step although width/height is not step.');\n  } else if (size == 'container') {\n    var isWidth = name.endsWith('width');\n    var expr = isWidth ? 'containerSize()[0]' : 'containerSize()[1]';\n    var defaultValue = getViewConfigContinuousSize(model.config.view, isWidth ? 'width' : 'height');\n    var safeExpr = \"isFinite(\".concat(expr, \") ? \").concat(expr, \" : \").concat(defaultValue);\n    return [{\n      name: name,\n      init: safeExpr,\n      on: [{\n        update: safeExpr,\n        events: 'window:resize'\n      }]\n    }];\n  } else {\n    return [{\n      name: name,\n      value: size\n    }];\n  }\n}\n\nfunction stepSignal(scaleName, range) {\n  return {\n    name: \"\".concat(scaleName, \"_step\"),\n    value: range.step\n  };\n}\n\nexport function sizeExpr(scaleName, scaleComponent, cardinality) {\n  var type = scaleComponent.get('type');\n  var padding = scaleComponent.get('padding');\n  var paddingOuter = getFirstDefined(scaleComponent.get('paddingOuter'), padding);\n  var paddingInner = scaleComponent.get('paddingInner');\n  paddingInner = type === 'band' ? // only band has real paddingInner\n  paddingInner !== undefined ? paddingInner : padding : // For point, as calculated in https://github.com/vega/vega-scale/blob/master/src/band.js#L128,\n  // it's equivalent to have paddingInner = 1 since there is only n-1 steps between n points.\n  1;\n  return \"bandspace(\".concat(cardinality, \", \").concat(signalOrStringValue(paddingInner), \", \").concat(signalOrStringValue(paddingOuter), \") * \").concat(scaleName, \"_step\");\n}","map":{"version":3,"sources":["../../../../src/compile/layoutsize/assemble.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { getViewConfigContinuousSize } from '../../config';\nimport { hasDiscreteDomain } from '../../scale';\nimport { getFirstDefined } from '../../util';\nimport { isVgRangeStep } from '../../vega.schema';\nimport { signalOrStringValue } from '../common';\nimport { isFacetModel } from '../model';\nexport function assembleLayoutSignals(model) {\n    return [\n        ...sizeSignals(model, 'width'),\n        ...sizeSignals(model, 'height'),\n        ...sizeSignals(model, 'childWidth'),\n        ...sizeSignals(model, 'childHeight')\n    ];\n}\nexport function sizeSignals(model, sizeType) {\n    const channel = sizeType === 'width' ? 'x' : 'y';\n    const size = model.component.layoutSize.get(sizeType);\n    if (!size || size === 'merged') {\n        return [];\n    }\n    // Read size signal name from name map, just in case it is the top-level size signal that got renamed.\n    const name = model.getSizeSignalRef(sizeType).signal;\n    if (size === 'step') {\n        const scaleComponent = model.getScaleComponent(channel);\n        if (scaleComponent) {\n            const type = scaleComponent.get('type');\n            const range = scaleComponent.get('range');\n            if (hasDiscreteDomain(type) && isVgRangeStep(range)) {\n                const scaleName = model.scaleName(channel);\n                if (isFacetModel(model.parent)) {\n                    // If parent is facet and this is an independent scale, return only signal signal\n                    // as the width/height will be calculated using the cardinality from\n                    // facet's aggregate rather than reading from scale domain\n                    const parentResolve = model.parent.component.resolve;\n                    if (parentResolve.scale[channel] === 'independent') {\n                        return [stepSignal(scaleName, range)];\n                    }\n                }\n                return [\n                    stepSignal(scaleName, range),\n                    {\n                        name,\n                        update: sizeExpr(scaleName, scaleComponent, `domain('${scaleName}').length`)\n                    }\n                ];\n            }\n        }\n        /* istanbul ignore next: Condition should not happen -- only for warning in development. */\n        throw new Error('layout size is step although width/height is not step.');\n    }\n    else if (size == 'container') {\n        const isWidth = name.endsWith('width');\n        const expr = isWidth ? 'containerSize()[0]' : 'containerSize()[1]';\n        const defaultValue = getViewConfigContinuousSize(model.config.view, isWidth ? 'width' : 'height');\n        const safeExpr = `isFinite(${expr}) ? ${expr} : ${defaultValue}`;\n        return [{ name, init: safeExpr, on: [{ update: safeExpr, events: 'window:resize' }] }];\n    }\n    else {\n        return [\n            {\n                name,\n                value: size\n            }\n        ];\n    }\n}\nfunction stepSignal(scaleName, range) {\n    return {\n        name: `${scaleName}_step`,\n        value: range.step\n    };\n}\nexport function sizeExpr(scaleName, scaleComponent, cardinality) {\n    const type = scaleComponent.get('type');\n    const padding = scaleComponent.get('padding');\n    const paddingOuter = getFirstDefined(scaleComponent.get('paddingOuter'), padding);\n    let paddingInner = scaleComponent.get('paddingInner');\n    paddingInner =\n        type === 'band'\n            ? // only band has real paddingInner\n                paddingInner !== undefined\n                    ? paddingInner\n                    : padding\n            : // For point, as calculated in https://github.com/vega/vega-scale/blob/master/src/band.js#L128,\n                // it's equivalent to have paddingInner = 1 since there is only n-1 steps between n points.\n                1;\n    return `bandspace(${cardinality}, ${signalOrStringValue(paddingInner)}, ${signalOrStringValue(paddingOuter)}) * ${scaleName}_step`;\n}\n//# sourceMappingURL=assemble.js.map"]},"metadata":{},"sourceType":"module"}