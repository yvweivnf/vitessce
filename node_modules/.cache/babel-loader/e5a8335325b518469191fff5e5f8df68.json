{"ast":null,"code":"import { _isImageFormatSupported } from '@loaders.gl/images';\nimport GLTFScenegraph from '../api/gltf-scenegraph';\nconst EXT_TEXTURE_WEBP = 'EXT_texture_webp';\nexport const name = EXT_TEXTURE_WEBP;\nexport function preprocess(gltfData, options) {\n  const scenegraph = new GLTFScenegraph(gltfData);\n\n  if (!_isImageFormatSupported('image/webp')) {\n    if (scenegraph.getRequiredExtensions().includes(EXT_TEXTURE_WEBP)) {\n      throw new Error(\"gltf: Required extension \".concat(EXT_TEXTURE_WEBP, \" not supported by browser\"));\n    }\n\n    return;\n  }\n\n  const {\n    json\n  } = scenegraph;\n\n  for (const texture of json.textures || []) {\n    const extension = scenegraph.getObjectExtension(texture, EXT_TEXTURE_WEBP);\n\n    if (extension) {\n      texture.source = extension.source;\n    }\n\n    scenegraph.removeObjectExtension(texture, EXT_TEXTURE_WEBP);\n  }\n\n  scenegraph.removeExtension(EXT_TEXTURE_WEBP);\n}","map":{"version":3,"sources":["../../../../src/lib/extensions/EXT_texture_webp.ts"],"names":["EXT_TEXTURE_WEBP","name","scenegraph","_isImageFormatSupported","json","extension","texture"],"mappings":"AAOA,SAAA,uBAAA,QAAA,oBAAA;AACA,OAAA,cAAA,MAAA,wBAAA;AAEA,MAAMA,gBAAgB,GAAtB,kBAAA;AAGA,OAAO,MAAMC,IAAI,GAAV,gBAAA;AAMP,OAAO,SAAA,UAAA,CAAA,QAAA,EAAA,OAAA,EAA8E;AACnF,QAAMC,UAAU,GAAG,IAAA,cAAA,CAAnB,QAAmB,CAAnB;;AAEA,MAAI,CAACC,uBAAuB,CAA5B,YAA4B,CAA5B,EAA4C;AAC1C,QAAID,UAAU,CAAVA,qBAAAA,GAAAA,QAAAA,CAAJ,gBAAIA,CAAJ,EAAmE;AACjE,YAAM,IAAA,KAAA,CAAA,4BAAA,MAAA,CAAA,gBAAA,EAAN,2BAAM,CAAA,CAAN;AACD;;AACD;AACD;;AAED,QAAM;AAACE,IAAAA;AAAD,MAAN,UAAA;;AAEA,OAAK,MAAL,OAAA,IAAsBA,IAAI,CAAJA,QAAAA,IAAtB,EAAA,EAA2C;AACzC,UAAMC,SAAS,GAAGH,UAAU,CAAVA,kBAAAA,CAAAA,OAAAA,EAAlB,gBAAkBA,CAAlB;;AAIA,QAAA,SAAA,EAAe;AACbI,MAAAA,OAAO,CAAPA,MAAAA,GAAiBD,SAAS,CAA1BC,MAAAA;AACD;;AACDJ,IAAAA,UAAU,CAAVA,qBAAAA,CAAAA,OAAAA,EAAAA,gBAAAA;AACD;;AAGDA,EAAAA,UAAU,CAAVA,eAAAA,CAAAA,gBAAAA;AACD","sourcesContent":["// GLTF EXTENSION: EXT_TEXTURE_WEBP\n// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/EXT_TEXTURE_WEBP\n/* eslint-disable camelcase */\n\nimport type {GLTF, GLTF_EXT_texture_webp} from '../types/gltf-types';\nimport type {GLTFLoaderOptions} from '../../gltf-loader';\n\nimport {_isImageFormatSupported} from '@loaders.gl/images';\nimport GLTFScenegraph from '../api/gltf-scenegraph';\n\nconst EXT_TEXTURE_WEBP = 'EXT_texture_webp';\n\n/** Extension name */\nexport const name = EXT_TEXTURE_WEBP;\n\n/**\n * Replaces a texture source reference with the extension texture\n * Done in preprocess() to prevent load of default image\n */\nexport function preprocess(gltfData: {json: GLTF}, options: GLTFLoaderOptions): void {\n  const scenegraph = new GLTFScenegraph(gltfData);\n\n  if (!_isImageFormatSupported('image/webp')) {\n    if (scenegraph.getRequiredExtensions().includes(EXT_TEXTURE_WEBP)) {\n      throw new Error(`gltf: Required extension ${EXT_TEXTURE_WEBP} not supported by browser`);\n    }\n    return;\n  }\n\n  const {json} = scenegraph;\n\n  for (const texture of json.textures || []) {\n    const extension = scenegraph.getObjectExtension<GLTF_EXT_texture_webp>(\n      texture,\n      EXT_TEXTURE_WEBP\n    );\n    if (extension) {\n      texture.source = extension.source;\n    }\n    scenegraph.removeObjectExtension(texture, EXT_TEXTURE_WEBP);\n  }\n\n  // Remove the top-level extension\n  scenegraph.removeExtension(EXT_TEXTURE_WEBP);\n}\n"]},"metadata":{},"sourceType":"module"}