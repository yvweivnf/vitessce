{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useMemo,useEffect,useRef,Suspense,useState}from'react';import ReactDOM from'react-dom';import dynamicImportPolyfill from'dynamic-import-polyfill';import register from'higlass-register';import{ZarrMultivecDataFetcher}from'higlass-zarr-datafetchers';import packageJson from'../../../package.json';import{createWarningComponent,asEsModule}from'../utils';import{useGridItemSize}from'../hooks';import{useCoordination}from'../../app/state/hooks';import{COMPONENT_COORDINATION_TYPES}from'../../app/state/coordination';var PIXI_BUNDLE_VERSION=packageJson.dependencies['window-pixi'];var HIGLASS_BUNDLE_VERSION=packageJson.dependencies.higlass;var BUNDLE_FILE_EXT=process.env.NODE_ENV==='development'?'js':'min.js';var PIXI_BUNDLE_URL=\"https://unpkg.com/window-pixi@\".concat(PIXI_BUNDLE_VERSION,\"/dist/pixi.\").concat(BUNDLE_FILE_EXT);var HIGLASS_BUNDLE_URL=\"https://unpkg.com/higlass@\".concat(HIGLASS_BUNDLE_VERSION,\"/dist/hglib.\").concat(BUNDLE_FILE_EXT);// Initialize the dynamic __import__() function.\nif(dynamicImportPolyfill){dynamicImportPolyfill.initialize();}// Register the zarr-multivec plugin data fetcher.\n// References:\n// https://github.com/higlass/higlass-register\n// https://github.com/higlass/higlass-zarr-datafetchers\nregister({dataFetcher:ZarrMultivecDataFetcher,config:ZarrMultivecDataFetcher.config},{pluginType:'dataFetcher'});// Lazy load the HiGlass React component,\n// using dynamic imports with absolute URLs.\nvar HiGlassComponent=React.lazy(function(){if(!window.React){window.React=React;}if(!window.ReactDOM){window.ReactDOM=ReactDOM;}return new Promise(function(resolve){var handleImportError=function handleImportError(e){console.warn(e);resolve(asEsModule(createWarningComponent({title:'Could not load HiGlass',message:'The HiGlass scripts could not be dynamically imported.'})));};// eslint-disable-next-line no-undef\n__import__(PIXI_BUNDLE_URL).then(function(){// eslint-disable-next-line no-undef\n__import__(HIGLASS_BUNDLE_URL).then(function(){// React.lazy promise must return an ES module with the\n// component as the default export.\nresolve(asEsModule(window.hglib.HiGlassComponent));}).catch(handleImportError);}).catch(handleImportError);});});// Use an arbitrary size for normalization of the zoom level.\n// (800 means 800 px width for the full genome)\nvar HG_SIZE=800;/**\n   * A wrapper around HiGlass (http://higlass.io/).\n   * The HiGlassComponent react component is loaded lazily.\n   * @prop {object} hgViewConfig A HiGlass viewconfig object to pass\n   * to the HiGlassComponent viewConfig prop.\n   * @prop {object} hgOptions An optional HiGlass object to pass\n   * to the HiGlassComponent hgOptions prop.\n   * @prop {function} removeGridComponent A grid component removal handler\n   * to pass to the TitleInfo component.\n   * @prop {function} onReady A callback function to signal that the component is ready.\n   */export default function HiGlassLazy(props){var coordinationScopes=props.coordinationScopes,theme=props.theme,hgViewConfigProp=props.hgViewConfig,hgOptionsProp=props.hgOptions,genomeSize=props.genomeSize,height=props.height;// Get \"props\" from the coordination space.\nvar _useCoordination=useCoordination(COMPONENT_COORDINATION_TYPES.higlass,coordinationScopes),_useCoordination2=_slicedToArray(_useCoordination,2),_useCoordination2$=_useCoordination2[0],genomicZoomX=_useCoordination2$.genomicZoomX,genomicZoomY=_useCoordination2$.genomicZoomY,genomicTargetX=_useCoordination2$.genomicTargetX,genomicTargetY=_useCoordination2$.genomicTargetY,_useCoordination2$2=_useCoordination2[1],setGenomicZoomX=_useCoordination2$2.setGenomicZoomX,setGenomicZoomY=_useCoordination2$2.setGenomicZoomY,setGenomicTargetX=_useCoordination2$2.setGenomicTargetX,setGenomicTargetY=_useCoordination2$2.setGenomicTargetY;// eslint-disable-next-line no-unused-vars\nvar _useGridItemSize=useGridItemSize(),_useGridItemSize2=_slicedToArray(_useGridItemSize,3),width=_useGridItemSize2[0],computedHeight=_useGridItemSize2[1],containerRef=_useGridItemSize2[2];var _useState=useState(),_useState2=_slicedToArray(_useState,2),hgInstance=_useState2[0],setHgInstance=_useState2[1];var isActiveRef=useRef();var hgOptions=useMemo(function(){return _objectSpread({},hgOptionsProp,{theme:theme});},[hgOptionsProp,theme]);var hgViewConfig=useMemo(function(){// HiGlass needs the start and end absolute genome coordinates\nvar centerX=genomicTargetX;var genomesPerUnitX=genomeSize/Math.pow(2,genomicZoomX);var unitX=width/HG_SIZE;var initialXDomain=[centerX-genomesPerUnitX*unitX/2,centerX+genomesPerUnitX*unitX/2];var centerY=genomicTargetY;var genomesPerUnitY=genomeSize/Math.pow(2,genomicZoomY);var unitY=height/HG_SIZE;var initialYDomain=[centerY-genomesPerUnitY*unitY/2,centerY+genomesPerUnitY*unitY/2];return{editable:false,zoomFixed:false,trackSourceServers:['//higlass.io/api/v1'],exportViewUrl:'//higlass.io/api/v1/viewconfs',views:[_objectSpread({uid:'main'},hgViewConfigProp,{initialXDomain:initialXDomain,initialYDomain:initialYDomain})],zoomLocks:{locksByViewUid:{},locksDict:{}},locationLocks:{locksByViewUid:{},locksDict:{}},valueScaleLocks:{locksByViewUid:{},locksDict:{}}};},[genomicTargetX,genomeSize,genomicZoomX,width,genomicTargetY,genomicZoomY,height,hgViewConfigProp]);useEffect(function(){var handleMouseEnter=function handleMouseEnter(){isActiveRef.current=true;};var handleMouseLeave=function handleMouseLeave(){isActiveRef.current=false;};var container=containerRef.current;container.addEventListener('mouseenter',handleMouseEnter);container.addEventListener('mouseleave',handleMouseLeave);return function(){container.removeEventListener('mouseenter',handleMouseEnter);container.removeEventListener('mouseenter',handleMouseLeave);};},[containerRef]);useEffect(function(){if(!hgInstance){return function(){};}hgInstance.api.on('viewConfig',function(viewConfigString){// Only set if the user mouse is over this component (\"is active\").\n// Otherwise, this could be an initial on viewConfig change callback from a sibling,\n// which will cause an infinite loop.\nif(!isActiveRef.current){return;}var viewConfig=JSON.parse(viewConfigString);var xDomain=viewConfig.views[0].initialXDomain;var yDomain=viewConfig.views[0].initialYDomain;var nextGenomicZoomX=Math.log2(genomeSize/((xDomain[1]-xDomain[0])*(HG_SIZE/width)));var nextGenomicZoomY=Math.log2(genomeSize/((yDomain[1]-yDomain[0])*(HG_SIZE/height)));var nextGenomicTargetX=xDomain[0]+(xDomain[1]-xDomain[0])/2;var nextGenomicTargetY=yDomain[0]+(yDomain[1]-yDomain[0])/2;setGenomicZoomX(nextGenomicZoomX);setGenomicZoomY(nextGenomicZoomY);setGenomicTargetX(nextGenomicTargetX);setGenomicTargetY(nextGenomicTargetY);});return function(){return hgInstance.api.off('viewConfig');};},[hgInstance,genomeSize,width,height,setGenomicZoomX,setGenomicZoomY,setGenomicTargetX,setGenomicTargetY]);return/*#__PURE__*/React.createElement(\"div\",{className:\"higlass-wrapper-parent\"},/*#__PURE__*/React.createElement(\"div\",{className:\"higlass-wrapper\",ref:containerRef,style:{height:\"\".concat(height,\"px\")}},/*#__PURE__*/React.createElement(Suspense,{fallback:/*#__PURE__*/React.createElement(\"div\",null,\"Loading...\")},/*#__PURE__*/React.createElement(HiGlassComponent,{ref:setHgInstance,zoomFixed:false,viewConfig:hgViewConfig,options:hgOptions}))));}HiGlassLazy.defaultProps={hgOptions:{bounded:true,pixelPreciseMarginPadding:true,containerPaddingX:0,containerPaddingY:0,sizeMode:'default'},genomeSize:3100000000};","map":{"version":3,"sources":["C:/Users/wkuo/Documents/vitessce-forked-v1.2.2/vitessce/src/components/higlass/HiGlassLazy.js"],"names":["React","useMemo","useEffect","useRef","Suspense","useState","ReactDOM","dynamicImportPolyfill","register","ZarrMultivecDataFetcher","packageJson","createWarningComponent","asEsModule","useGridItemSize","useCoordination","COMPONENT_COORDINATION_TYPES","PIXI_BUNDLE_VERSION","dependencies","HIGLASS_BUNDLE_VERSION","higlass","BUNDLE_FILE_EXT","process","env","NODE_ENV","PIXI_BUNDLE_URL","HIGLASS_BUNDLE_URL","initialize","dataFetcher","config","pluginType","HiGlassComponent","lazy","window","Promise","resolve","handleImportError","e","console","warn","title","message","__import__","then","hglib","catch","HG_SIZE","HiGlassLazy","props","coordinationScopes","theme","hgViewConfigProp","hgViewConfig","hgOptionsProp","hgOptions","genomeSize","height","genomicZoomX","genomicZoomY","genomicTargetX","genomicTargetY","setGenomicZoomX","setGenomicZoomY","setGenomicTargetX","setGenomicTargetY","width","computedHeight","containerRef","hgInstance","setHgInstance","isActiveRef","centerX","genomesPerUnitX","unitX","initialXDomain","centerY","genomesPerUnitY","unitY","initialYDomain","editable","zoomFixed","trackSourceServers","exportViewUrl","views","uid","zoomLocks","locksByViewUid","locksDict","locationLocks","valueScaleLocks","handleMouseEnter","current","handleMouseLeave","container","addEventListener","removeEventListener","api","on","viewConfigString","viewConfig","JSON","parse","xDomain","yDomain","nextGenomicZoomX","Math","log2","nextGenomicZoomY","nextGenomicTargetX","nextGenomicTargetY","off","defaultProps","bounded","pixelPreciseMarginPadding","containerPaddingX","containerPaddingY","sizeMode"],"mappings":"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","sourcesContent":["import React, {\n  useMemo, useEffect, useRef, Suspense, useState,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport dynamicImportPolyfill from 'dynamic-import-polyfill';\nimport register from 'higlass-register';\nimport { ZarrMultivecDataFetcher } from 'higlass-zarr-datafetchers';\nimport packageJson from '../../../package.json';\nimport { createWarningComponent, asEsModule } from '../utils';\nimport { useGridItemSize } from '../hooks';\nimport {\n  useCoordination,\n} from '../../app/state/hooks';\nimport { COMPONENT_COORDINATION_TYPES } from '../../app/state/coordination';\n\nconst PIXI_BUNDLE_VERSION = packageJson.dependencies['window-pixi'];\nconst HIGLASS_BUNDLE_VERSION = packageJson.dependencies.higlass;\nconst BUNDLE_FILE_EXT = process.env.NODE_ENV === 'development' ? 'js' : 'min.js';\nconst PIXI_BUNDLE_URL = `https://unpkg.com/window-pixi@${PIXI_BUNDLE_VERSION}/dist/pixi.${BUNDLE_FILE_EXT}`;\nconst HIGLASS_BUNDLE_URL = `https://unpkg.com/higlass@${HIGLASS_BUNDLE_VERSION}/dist/hglib.${BUNDLE_FILE_EXT}`;\n\n\n// Initialize the dynamic __import__() function.\nif (dynamicImportPolyfill) {\n  dynamicImportPolyfill.initialize();\n}\n\n// Register the zarr-multivec plugin data fetcher.\n// References:\n// https://github.com/higlass/higlass-register\n// https://github.com/higlass/higlass-zarr-datafetchers\nregister(\n  { dataFetcher: ZarrMultivecDataFetcher, config: ZarrMultivecDataFetcher.config },\n  { pluginType: 'dataFetcher' },\n);\n\n// Lazy load the HiGlass React component,\n// using dynamic imports with absolute URLs.\nconst HiGlassComponent = React.lazy(() => {\n  if (!window.React) {\n    window.React = React;\n  }\n  if (!window.ReactDOM) {\n    window.ReactDOM = ReactDOM;\n  }\n  return new Promise((resolve) => {\n    const handleImportError = (e) => {\n      console.warn(e);\n      resolve(asEsModule(createWarningComponent({\n        title: 'Could not load HiGlass',\n        message: 'The HiGlass scripts could not be dynamically imported.',\n      })));\n    };\n      // eslint-disable-next-line no-undef\n    __import__(PIXI_BUNDLE_URL).then(() => {\n      // eslint-disable-next-line no-undef\n      __import__(HIGLASS_BUNDLE_URL).then(() => {\n        // React.lazy promise must return an ES module with the\n        // component as the default export.\n        resolve(asEsModule(window.hglib.HiGlassComponent));\n      }).catch(handleImportError);\n    }).catch(handleImportError);\n  });\n});\n\n// Use an arbitrary size for normalization of the zoom level.\n// (800 means 800 px width for the full genome)\nconst HG_SIZE = 800;\n\n/**\n   * A wrapper around HiGlass (http://higlass.io/).\n   * The HiGlassComponent react component is loaded lazily.\n   * @prop {object} hgViewConfig A HiGlass viewconfig object to pass\n   * to the HiGlassComponent viewConfig prop.\n   * @prop {object} hgOptions An optional HiGlass object to pass\n   * to the HiGlassComponent hgOptions prop.\n   * @prop {function} removeGridComponent A grid component removal handler\n   * to pass to the TitleInfo component.\n   * @prop {function} onReady A callback function to signal that the component is ready.\n   */\nexport default function HiGlassLazy(props) {\n  const {\n    coordinationScopes,\n    theme,\n    hgViewConfig: hgViewConfigProp,\n    hgOptions: hgOptionsProp,\n    genomeSize,\n    height,\n  } = props;\n\n  // Get \"props\" from the coordination space.\n  const [{\n    genomicZoomX,\n    genomicZoomY,\n    genomicTargetX,\n    genomicTargetY,\n  }, {\n    setGenomicZoomX,\n    setGenomicZoomY,\n    setGenomicTargetX,\n    setGenomicTargetY,\n  }] = useCoordination(COMPONENT_COORDINATION_TYPES.higlass, coordinationScopes);\n\n  // eslint-disable-next-line no-unused-vars\n  const [width, computedHeight, containerRef] = useGridItemSize();\n  const [hgInstance, setHgInstance] = useState();\n  const isActiveRef = useRef();\n\n  const hgOptions = useMemo(() => ({\n    ...hgOptionsProp,\n    theme,\n  }), [hgOptionsProp, theme]);\n\n  const hgViewConfig = useMemo(() => {\n    // HiGlass needs the start and end absolute genome coordinates\n    const centerX = genomicTargetX;\n    const genomesPerUnitX = genomeSize / (2 ** genomicZoomX);\n    const unitX = width / HG_SIZE;\n    const initialXDomain = [\n      centerX - genomesPerUnitX * unitX / 2,\n      centerX + genomesPerUnitX * unitX / 2,\n    ];\n    const centerY = genomicTargetY;\n    const genomesPerUnitY = genomeSize / (2 ** genomicZoomY);\n    const unitY = height / HG_SIZE;\n    const initialYDomain = [\n      centerY - genomesPerUnitY * unitY / 2,\n      centerY + genomesPerUnitY * unitY / 2,\n    ];\n    return {\n      editable: false,\n      zoomFixed: false,\n      trackSourceServers: [\n        '//higlass.io/api/v1',\n      ],\n      exportViewUrl: '//higlass.io/api/v1/viewconfs',\n      views: [\n        {\n          uid: 'main',\n          ...hgViewConfigProp,\n          initialXDomain,\n          initialYDomain,\n        },\n      ],\n      zoomLocks: {\n        locksByViewUid: {},\n        locksDict: {},\n      },\n      locationLocks: {\n        locksByViewUid: {},\n        locksDict: {},\n      },\n      valueScaleLocks: {\n        locksByViewUid: {},\n        locksDict: {},\n      },\n    };\n  }, [genomicTargetX, genomeSize, genomicZoomX, width, genomicTargetY,\n    genomicZoomY, height, hgViewConfigProp]);\n\n  useEffect(() => {\n    const handleMouseEnter = () => {\n      isActiveRef.current = true;\n    };\n    const handleMouseLeave = () => {\n      isActiveRef.current = false;\n    };\n    const container = containerRef.current;\n    container.addEventListener('mouseenter', handleMouseEnter);\n    container.addEventListener('mouseleave', handleMouseLeave);\n    return () => {\n      container.removeEventListener('mouseenter', handleMouseEnter);\n      container.removeEventListener('mouseenter', handleMouseLeave);\n    };\n  }, [containerRef]);\n\n\n  useEffect(() => {\n    if (!hgInstance) {\n      return () => {};\n    }\n    hgInstance.api.on('viewConfig', (viewConfigString) => {\n      // Only set if the user mouse is over this component (\"is active\").\n      // Otherwise, this could be an initial on viewConfig change callback from a sibling,\n      // which will cause an infinite loop.\n      if (!isActiveRef.current) {\n        return;\n      }\n      const viewConfig = JSON.parse(viewConfigString);\n      const xDomain = viewConfig.views[0].initialXDomain;\n      const yDomain = viewConfig.views[0].initialYDomain;\n\n      const nextGenomicZoomX = Math.log2(\n        genomeSize / ((xDomain[1] - xDomain[0]) * (HG_SIZE / width)),\n      );\n      const nextGenomicZoomY = Math.log2(\n        genomeSize / ((yDomain[1] - yDomain[0]) * (HG_SIZE / height)),\n      );\n      const nextGenomicTargetX = xDomain[0] + (xDomain[1] - xDomain[0]) / 2;\n      const nextGenomicTargetY = yDomain[0] + (yDomain[1] - yDomain[0]) / 2;\n      setGenomicZoomX(nextGenomicZoomX);\n      setGenomicZoomY(nextGenomicZoomY);\n      setGenomicTargetX(nextGenomicTargetX);\n      setGenomicTargetY(nextGenomicTargetY);\n    });\n    return () => hgInstance.api.off('viewConfig');\n  }, [hgInstance, genomeSize, width, height, setGenomicZoomX, setGenomicZoomY,\n    setGenomicTargetX, setGenomicTargetY]);\n\n  return (\n    <div className=\"higlass-wrapper-parent\">\n      <div className=\"higlass-wrapper\" ref={containerRef} style={{ height: `${height}px` }}>\n        <Suspense fallback={<div>Loading...</div>}>\n          <HiGlassComponent\n            ref={setHgInstance}\n            zoomFixed={false}\n            viewConfig={hgViewConfig}\n            options={hgOptions}\n          />\n        </Suspense>\n      </div>\n    </div>\n  );\n}\n\nHiGlassLazy.defaultProps = {\n  hgOptions: {\n    bounded: true,\n    pixelPreciseMarginPadding: true,\n    containerPaddingX: 0,\n    containerPaddingY: 0,\n    sizeMode: 'default',\n  },\n  genomeSize: 3100000000,\n};\n"]},"metadata":{},"sourceType":"module"}