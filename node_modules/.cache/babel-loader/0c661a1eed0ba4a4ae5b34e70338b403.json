{"ast":null,"code":"var fs = \"uniform float strength;\\n\\nvec4 denoise_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\\n  float adjustedExponent = 3. + 200. * pow(1. - strength, 4.);\\n\\n  vec4 center = texture2D(texture, texCoord);\\n  vec4 color = vec4(0.0);\\n  float total = 0.0;\\n  for (float x = -4.0; x <= 4.0; x += 1.0) {\\n    for (float y = -4.0; y <= 4.0; y += 1.0) {\\n      vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\n      float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\n      weight = pow(weight, adjustedExponent);\\n      color += sample * weight;\\n      total += weight;\\n    }\\n  }\\n\\n  return color / total;\\n}\\n\";\nvar uniforms = {\n  strength: {\n    value: 0.5,\n    min: 0,\n    max: 0.1,\n    adjust: function adjust(strength) {\n      return 0.53 + 200 * Math.pow(1 - strength, 4);\n    }\n  }\n};\nexport var denoise = {\n  name: 'denoise',\n  uniforms: uniforms,\n  fs: fs,\n  passes: [{\n    sampler: true\n  }, {\n    sampler: true\n  }]\n};","map":{"version":3,"sources":["../../../../src/modules/image-adjust-filters/denoise.js"],"names":["fs","uniforms","strength","value","min","max","adjust","Math","denoise","name","passes","sampler"],"mappings":"AAGA,IAAMA,EAAE,mpBAAR;AAuBA,IAAMC,QAAQ,GAAG;AACfC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,KAAK,EADG,GAAA;AAERC,IAAAA,GAAG,EAFK,CAAA;AAGRC,IAAAA,GAAG,EAHK,GAAA;AAIRC,IAAAA,MAAM,EAAEJ,gBAAAA,QAAQ;AAAA,aAAI,OAAO,MAAMK,IAAI,CAAJA,GAAAA,CAAS,IAATA,QAAAA,EAAAA,CAAAA,CAAjB;AAAA;AAJR;AADK,CAAjB;AAUA,OAAO,IAAMC,OAAO,GAAG;AACrBC,EAAAA,IAAI,EADiB,SAAA;AAErBR,EAAAA,QAFqB,EAErBA,QAFqB;AAGrBD,EAAAA,EAHqB,EAGrBA,EAHqB;AAIrBU,EAAAA,MAAM,EAAE,CAAC;AAACC,IAAAA,OAAO,EAAE;AAAV,GAAD,EAAkB;AAACA,IAAAA,OAAO,EAAE;AAAV,GAAlB;AAJa,CAAhB","sourcesContent":["/** @typedef {import('../../types').ShaderPass} ShaderPass */\n\n// Do a 9x9 bilateral box filter\nconst fs = `\\\nuniform float strength;\n\nvec4 denoise_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  float adjustedExponent = 3. + 200. * pow(1. - strength, 4.);\n\n  vec4 center = texture2D(texture, texCoord);\n  vec4 color = vec4(0.0);\n  float total = 0.0;\n  for (float x = -4.0; x <= 4.0; x += 1.0) {\n    for (float y = -4.0; y <= 4.0; y += 1.0) {\n      vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\n      float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\n      weight = pow(weight, adjustedExponent);\n      color += sample * weight;\n      total += weight;\n    }\n  }\n\n  return color / total;\n}\n`;\n\nconst uniforms = {\n  strength: {\n    value: 0.5,\n    min: 0,\n    max: 0.1,\n    adjust: strength => 0.53 + 200 * Math.pow(1 - strength, 4) // TODO - JS preprocessing\n  }\n};\n\n/** @type {ShaderPass} */\nexport const denoise = {\n  name: 'denoise',\n  uniforms,\n  fs,\n  passes: [{sampler: true}, {sampler: true}]\n};\n"]},"metadata":{},"sourceType":"module"}