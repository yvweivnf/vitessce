{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _slicedToArray from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _getPrototypeOf from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _get from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/get\";import _inherits from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import{extent}from'd3-array';import range from'lodash/range';import clustersSchema from'../schemas/clusters.schema.json';import JsonLoader from'./JsonLoader';import{AbstractLoaderError}from'./errors';import LoaderResult from'./LoaderResult';var ClustersJsonAsMatrixZarrLoader=/*#__PURE__*/function(_JsonLoader){_inherits(ClustersJsonAsMatrixZarrLoader,_JsonLoader);var _super=_createSuper(ClustersJsonAsMatrixZarrLoader);function ClustersJsonAsMatrixZarrLoader(dataSource,params){var _this;_classCallCheck(this,ClustersJsonAsMatrixZarrLoader);_this=_super.call(this,dataSource,params);_this.schema=clustersSchema;return _this;}_createClass(ClustersJsonAsMatrixZarrLoader,[{key:\"load\",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var payload,data,url,rows,cols,matrix,attrs,shape,normalizedMatrix,tNormalizedMatrix,normalizedFlatMatrix,arr;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _get(_getPrototypeOf(ClustersJsonAsMatrixZarrLoader.prototype),\"load\",this).call(this).catch(function(reason){return Promise.resolve(reason);});case 2:payload=_context.sent;if(!(payload instanceof AbstractLoaderError)){_context.next=5;break;}return _context.abrupt(\"return\",Promise.reject(payload));case 5:data=payload.data,url=payload.url;rows=data.rows,cols=data.cols,matrix=data.matrix;attrs={rows:cols,cols:rows};shape=[attrs.rows.length,attrs.cols.length];// Normalize values by converting to one-byte integers.\n// Normalize for each gene (column) independently.\nnormalizedMatrix=matrix.map(function(col){var _extent=extent(col),_extent2=_slicedToArray(_extent,2),min=_extent2[0],max=_extent2[1];var normalize=function normalize(d){return Math.floor((d-min)/(max-min)*255);};return col.map(normalize);});// Transpose the normalized matrix.\ntNormalizedMatrix=range(shape[0]).map(function(i){return range(shape[1]).map(function(j){return normalizedMatrix[j][i];});});// Flatten the transposed matrix.\nnormalizedFlatMatrix=tNormalizedMatrix.flat();// Need to wrap the NestedArray to mock the HTTPStore-based array\n// which returns promises.\narr={data:Uint8Array.from(normalizedFlatMatrix)};return _context.abrupt(\"return\",Promise.resolve(new LoaderResult([attrs,arr],url)));case 14:case\"end\":return _context.stop();}}},_callee,this);}));function load(){return _load.apply(this,arguments);}return load;}()}]);return ClustersJsonAsMatrixZarrLoader;}(JsonLoader);export{ClustersJsonAsMatrixZarrLoader as default};","map":{"version":3,"sources":["C:/Users/wkuo/Documents/vitessce-forked-v1.2.2/vitessce/src/loaders/ClustersJsonAsMatrixZarrLoader.js"],"names":["extent","range","clustersSchema","JsonLoader","AbstractLoaderError","LoaderResult","ClustersJsonAsMatrixZarrLoader","dataSource","params","schema","catch","reason","Promise","resolve","payload","reject","data","url","rows","cols","matrix","attrs","shape","length","normalizedMatrix","map","col","min","max","normalize","d","Math","floor","tNormalizedMatrix","i","j","normalizedFlatMatrix","flat","arr","Uint8Array","from"],"mappings":"mlDAAA,OAASA,MAAT,KAAuB,UAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,cAAlB,CACA,MAAOC,CAAAA,cAAP,KAA2B,iCAA3B,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,OAASC,mBAAT,KAAoC,UAApC,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,C,GAEqBC,CAAAA,8B,kJACnB,wCAAYC,UAAZ,CAAwBC,MAAxB,CAAgC,gEAC9B,uBAAMD,UAAN,CAAkBC,MAAlB,EAEA,MAAKC,MAAL,CAAcP,cAAd,CAH8B,aAI/B,C,mZAGuB,wFAAaQ,KAAb,CAAmB,SAAAC,MAAM,QAAIC,CAAAA,OAAO,CAACC,OAAR,CAAgBF,MAAhB,CAAJ,EAAzB,C,QAAhBG,O,oBACFA,OAAO,WAAYV,CAAAA,mB,0DACdQ,OAAO,CAACG,MAAR,CAAeD,OAAf,C,SAEDE,I,CAAcF,O,CAAdE,I,CAAMC,G,CAAQH,O,CAARG,G,CACNC,I,CAAuBF,I,CAAvBE,I,CAAMC,I,CAAiBH,I,CAAjBG,I,CAAMC,M,CAAWJ,I,CAAXI,M,CACdC,K,CAAQ,CACZH,IAAI,CAAEC,IADM,CAEZA,IAAI,CAAED,IAFM,C,CAIRI,K,CAAQ,CAACD,KAAK,CAACH,IAAN,CAAWK,MAAZ,CAAoBF,KAAK,CAACF,IAAN,CAAWI,MAA/B,C,CACd;AACA;AACMC,gB,CAAmBJ,MAAM,CAACK,GAAP,CAAW,SAACC,GAAD,CAAS,aACxB1B,MAAM,CAAC0B,GAAD,CADkB,oCACpCC,GADoC,aAC/BC,GAD+B,aAE3C,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,CAAC,QAAIC,CAAAA,IAAI,CAACC,KAAL,CAAY,CAACF,CAAC,CAAGH,GAAL,GAAaC,GAAG,CAAGD,GAAnB,CAAD,CAA4B,GAAvC,CAAJ,EAAnB,CACA,MAAOD,CAAAA,GAAG,CAACD,GAAJ,CAAQI,SAAR,CAAP,CACD,CAJwB,C,CAKzB;AACMI,iB,CAAoBhC,KAAK,CAACqB,KAAK,CAAC,CAAD,CAAN,CAAL,CACvBG,GADuB,CACnB,SAAAS,CAAC,QAAIjC,CAAAA,KAAK,CAACqB,KAAK,CAAC,CAAD,CAAN,CAAL,CAAgBG,GAAhB,CAAoB,SAAAU,CAAC,QAAIX,CAAAA,gBAAgB,CAACW,CAAD,CAAhB,CAAoBD,CAApB,CAAJ,EAArB,CAAJ,EADkB,C,CAE1B;AACME,oB,CAAuBH,iBAAiB,CAACI,IAAlB,E,CAC7B;AACA;AACMC,G,CAAM,CAAEtB,IAAI,CAAEuB,UAAU,CAACC,IAAX,CAAgBJ,oBAAhB,CAAR,C,iCACLxB,OAAO,CAACC,OAAR,CAAgB,GAAIR,CAAAA,YAAJ,CAAiB,CAACgB,KAAD,CAAQiB,GAAR,CAAjB,CAA+BrB,GAA/B,CAAhB,C,gLAlCiDd,U,SAAvCG,8B","sourcesContent":["import { extent } from 'd3-array';\nimport range from 'lodash/range';\nimport clustersSchema from '../schemas/clusters.schema.json';\nimport JsonLoader from './JsonLoader';\nimport { AbstractLoaderError } from './errors';\nimport LoaderResult from './LoaderResult';\n\nexport default class ClustersJsonAsMatrixZarrLoader extends JsonLoader {\n  constructor(dataSource, params) {\n    super(dataSource, params);\n\n    this.schema = clustersSchema;\n  }\n\n  async load() {\n    const payload = await super.load().catch(reason => Promise.resolve(reason));\n    if (payload instanceof AbstractLoaderError) {\n      return Promise.reject(payload);\n    }\n    const { data, url } = payload;\n    const { rows, cols, matrix } = data;\n    const attrs = {\n      rows: cols,\n      cols: rows,\n    };\n    const shape = [attrs.rows.length, attrs.cols.length];\n    // Normalize values by converting to one-byte integers.\n    // Normalize for each gene (column) independently.\n    const normalizedMatrix = matrix.map((col) => {\n      const [min, max] = extent(col);\n      const normalize = d => Math.floor(((d - min) / (max - min)) * 255);\n      return col.map(normalize);\n    });\n    // Transpose the normalized matrix.\n    const tNormalizedMatrix = range(shape[0])\n      .map(i => range(shape[1]).map(j => normalizedMatrix[j][i]));\n    // Flatten the transposed matrix.\n    const normalizedFlatMatrix = tNormalizedMatrix.flat();\n    // Need to wrap the NestedArray to mock the HTTPStore-based array\n    // which returns promises.\n    const arr = { data: Uint8Array.from(normalizedFlatMatrix) };\n    return Promise.resolve(new LoaderResult([attrs, arr], url));\n  }\n}\n"]},"metadata":{},"sourceType":"module"}