{"ast":null,"code":"const VIEW = 'view',\n      LBRACK = '[',\n      RBRACK = ']',\n      LBRACE = '{',\n      RBRACE = '}',\n      COLON = ':',\n      COMMA = ',',\n      NAME = '@',\n      GT = '>',\n      ILLEGAL = /[[\\]{}]/,\n      DEFAULT_MARKS = {\n  '*': 1,\n  arc: 1,\n  area: 1,\n  group: 1,\n  image: 1,\n  line: 1,\n  path: 1,\n  rect: 1,\n  rule: 1,\n  shape: 1,\n  symbol: 1,\n  text: 1,\n  trail: 1\n};\nlet DEFAULT_SOURCE, MARKS;\n/**\n * Parse an event selector string.\n * Returns an array of event stream definitions.\n */\n\nfunction eventSelector(selector, source, marks) {\n  DEFAULT_SOURCE = source || VIEW;\n  MARKS = marks || DEFAULT_MARKS;\n  return parseMerge(selector.trim()).map(parseSelector);\n}\n\nfunction isMarkType(type) {\n  return MARKS[type];\n}\n\nfunction find(s, i, endChar, pushChar, popChar) {\n  const n = s.length;\n  let count = 0,\n      c;\n\n  for (; i < n; ++i) {\n    c = s[i];\n    if (!count && c === endChar) return i;else if (popChar && popChar.indexOf(c) >= 0) --count;else if (pushChar && pushChar.indexOf(c) >= 0) ++count;\n  }\n\n  return i;\n}\n\nfunction parseMerge(s) {\n  const output = [],\n        n = s.length;\n  let start = 0,\n      i = 0;\n\n  while (i < n) {\n    i = find(s, i, COMMA, LBRACK + LBRACE, RBRACK + RBRACE);\n    output.push(s.substring(start, i).trim());\n    start = ++i;\n  }\n\n  if (output.length === 0) {\n    throw 'Empty event selector: ' + s;\n  }\n\n  return output;\n}\n\nfunction parseSelector(s) {\n  return s[0] === '[' ? parseBetween(s) : parseStream(s);\n}\n\nfunction parseBetween(s) {\n  const n = s.length;\n  let i = 1,\n      b;\n  i = find(s, i, RBRACK, LBRACK, RBRACK);\n\n  if (i === n) {\n    throw 'Empty between selector: ' + s;\n  }\n\n  b = parseMerge(s.substring(1, i));\n\n  if (b.length !== 2) {\n    throw 'Between selector must have two elements: ' + s;\n  }\n\n  s = s.slice(i + 1).trim();\n\n  if (s[0] !== GT) {\n    throw 'Expected \\'>\\' after between selector: ' + s;\n  }\n\n  b = b.map(parseSelector);\n  const stream = parseSelector(s.slice(1).trim());\n\n  if (stream.between) {\n    return {\n      between: b,\n      stream: stream\n    };\n  } else {\n    stream.between = b;\n  }\n\n  return stream;\n}\n\nfunction parseStream(s) {\n  const stream = {\n    source: DEFAULT_SOURCE\n  },\n        source = [];\n  let throttle = [0, 0],\n      markname = 0,\n      start = 0,\n      n = s.length,\n      i = 0,\n      j,\n      filter; // extract throttle from end\n\n  if (s[n - 1] === RBRACE) {\n    i = s.lastIndexOf(LBRACE);\n\n    if (i >= 0) {\n      try {\n        throttle = parseThrottle(s.substring(i + 1, n - 1));\n      } catch (e) {\n        throw 'Invalid throttle specification: ' + s;\n      }\n\n      s = s.slice(0, i).trim();\n      n = s.length;\n    } else throw 'Unmatched right brace: ' + s;\n\n    i = 0;\n  }\n\n  if (!n) throw s; // set name flag based on first char\n\n  if (s[0] === NAME) markname = ++i; // extract first part of multi-part stream selector\n\n  j = find(s, i, COLON);\n\n  if (j < n) {\n    source.push(s.substring(start, j).trim());\n    start = i = ++j;\n  } // extract remaining part of stream selector\n\n\n  i = find(s, i, LBRACK);\n\n  if (i === n) {\n    source.push(s.substring(start, n).trim());\n  } else {\n    source.push(s.substring(start, i).trim());\n    filter = [];\n    start = ++i;\n    if (start === n) throw 'Unmatched left bracket: ' + s;\n  } // extract filters\n\n\n  while (i < n) {\n    i = find(s, i, RBRACK);\n    if (i === n) throw 'Unmatched left bracket: ' + s;\n    filter.push(s.substring(start, i).trim());\n    if (i < n - 1 && s[++i] !== LBRACK) throw 'Expected left bracket: ' + s;\n    start = ++i;\n  } // marshall event stream specification\n\n\n  if (!(n = source.length) || ILLEGAL.test(source[n - 1])) {\n    throw 'Invalid event selector: ' + s;\n  }\n\n  if (n > 1) {\n    stream.type = source[1];\n\n    if (markname) {\n      stream.markname = source[0].slice(1);\n    } else if (isMarkType(source[0])) {\n      stream.marktype = source[0];\n    } else {\n      stream.source = source[0];\n    }\n  } else {\n    stream.type = source[0];\n  }\n\n  if (stream.type.slice(-1) === '!') {\n    stream.consume = true;\n    stream.type = stream.type.slice(0, -1);\n  }\n\n  if (filter != null) stream.filter = filter;\n  if (throttle[0]) stream.throttle = throttle[0];\n  if (throttle[1]) stream.debounce = throttle[1];\n  return stream;\n}\n\nfunction parseThrottle(s) {\n  const a = s.split(COMMA);\n  if (!s.length || a.length > 2) throw s;\n  return a.map(_ => {\n    const x = +_;\n    if (x !== x) throw s;\n    return x;\n  });\n}\n\nexport { eventSelector as selector };","map":{"version":3,"sources":["C:/Users/wkuo/Documents/vitessce-forked-v1.2.2/vitessce/node_modules/vega-lite/node_modules/vega-event-selector/build/vega-event-selector.module.js"],"names":["VIEW","LBRACK","RBRACK","LBRACE","RBRACE","COLON","COMMA","NAME","GT","ILLEGAL","DEFAULT_MARKS","arc","area","group","image","line","path","rect","rule","shape","symbol","text","trail","DEFAULT_SOURCE","MARKS","eventSelector","selector","source","marks","parseMerge","trim","map","parseSelector","isMarkType","type","find","s","i","endChar","pushChar","popChar","n","length","count","c","indexOf","output","start","push","substring","parseBetween","parseStream","b","slice","stream","between","throttle","markname","j","filter","lastIndexOf","parseThrottle","e","test","marktype","consume","debounce","a","split","_","x"],"mappings":"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","sourcesContent":["const VIEW = 'view',\n      LBRACK = '[',\n      RBRACK = ']',\n      LBRACE = '{',\n      RBRACE = '}',\n      COLON = ':',\n      COMMA = ',',\n      NAME = '@',\n      GT = '>',\n      ILLEGAL = /[[\\]{}]/,\n      DEFAULT_MARKS = {\n  '*': 1,\n  arc: 1,\n  area: 1,\n  group: 1,\n  image: 1,\n  line: 1,\n  path: 1,\n  rect: 1,\n  rule: 1,\n  shape: 1,\n  symbol: 1,\n  text: 1,\n  trail: 1\n};\nlet DEFAULT_SOURCE, MARKS;\n/**\n * Parse an event selector string.\n * Returns an array of event stream definitions.\n */\n\nfunction eventSelector (selector, source, marks) {\n  DEFAULT_SOURCE = source || VIEW;\n  MARKS = marks || DEFAULT_MARKS;\n  return parseMerge(selector.trim()).map(parseSelector);\n}\n\nfunction isMarkType(type) {\n  return MARKS[type];\n}\n\nfunction find(s, i, endChar, pushChar, popChar) {\n  const n = s.length;\n  let count = 0,\n      c;\n\n  for (; i < n; ++i) {\n    c = s[i];\n    if (!count && c === endChar) return i;else if (popChar && popChar.indexOf(c) >= 0) --count;else if (pushChar && pushChar.indexOf(c) >= 0) ++count;\n  }\n\n  return i;\n}\n\nfunction parseMerge(s) {\n  const output = [],\n        n = s.length;\n  let start = 0,\n      i = 0;\n\n  while (i < n) {\n    i = find(s, i, COMMA, LBRACK + LBRACE, RBRACK + RBRACE);\n    output.push(s.substring(start, i).trim());\n    start = ++i;\n  }\n\n  if (output.length === 0) {\n    throw 'Empty event selector: ' + s;\n  }\n\n  return output;\n}\n\nfunction parseSelector(s) {\n  return s[0] === '[' ? parseBetween(s) : parseStream(s);\n}\n\nfunction parseBetween(s) {\n  const n = s.length;\n  let i = 1,\n      b;\n  i = find(s, i, RBRACK, LBRACK, RBRACK);\n\n  if (i === n) {\n    throw 'Empty between selector: ' + s;\n  }\n\n  b = parseMerge(s.substring(1, i));\n\n  if (b.length !== 2) {\n    throw 'Between selector must have two elements: ' + s;\n  }\n\n  s = s.slice(i + 1).trim();\n\n  if (s[0] !== GT) {\n    throw 'Expected \\'>\\' after between selector: ' + s;\n  }\n\n  b = b.map(parseSelector);\n  const stream = parseSelector(s.slice(1).trim());\n\n  if (stream.between) {\n    return {\n      between: b,\n      stream: stream\n    };\n  } else {\n    stream.between = b;\n  }\n\n  return stream;\n}\n\nfunction parseStream(s) {\n  const stream = {\n    source: DEFAULT_SOURCE\n  },\n        source = [];\n  let throttle = [0, 0],\n      markname = 0,\n      start = 0,\n      n = s.length,\n      i = 0,\n      j,\n      filter; // extract throttle from end\n\n  if (s[n - 1] === RBRACE) {\n    i = s.lastIndexOf(LBRACE);\n\n    if (i >= 0) {\n      try {\n        throttle = parseThrottle(s.substring(i + 1, n - 1));\n      } catch (e) {\n        throw 'Invalid throttle specification: ' + s;\n      }\n\n      s = s.slice(0, i).trim();\n      n = s.length;\n    } else throw 'Unmatched right brace: ' + s;\n\n    i = 0;\n  }\n\n  if (!n) throw s; // set name flag based on first char\n\n  if (s[0] === NAME) markname = ++i; // extract first part of multi-part stream selector\n\n  j = find(s, i, COLON);\n\n  if (j < n) {\n    source.push(s.substring(start, j).trim());\n    start = i = ++j;\n  } // extract remaining part of stream selector\n\n\n  i = find(s, i, LBRACK);\n\n  if (i === n) {\n    source.push(s.substring(start, n).trim());\n  } else {\n    source.push(s.substring(start, i).trim());\n    filter = [];\n    start = ++i;\n    if (start === n) throw 'Unmatched left bracket: ' + s;\n  } // extract filters\n\n\n  while (i < n) {\n    i = find(s, i, RBRACK);\n    if (i === n) throw 'Unmatched left bracket: ' + s;\n    filter.push(s.substring(start, i).trim());\n    if (i < n - 1 && s[++i] !== LBRACK) throw 'Expected left bracket: ' + s;\n    start = ++i;\n  } // marshall event stream specification\n\n\n  if (!(n = source.length) || ILLEGAL.test(source[n - 1])) {\n    throw 'Invalid event selector: ' + s;\n  }\n\n  if (n > 1) {\n    stream.type = source[1];\n\n    if (markname) {\n      stream.markname = source[0].slice(1);\n    } else if (isMarkType(source[0])) {\n      stream.marktype = source[0];\n    } else {\n      stream.source = source[0];\n    }\n  } else {\n    stream.type = source[0];\n  }\n\n  if (stream.type.slice(-1) === '!') {\n    stream.consume = true;\n    stream.type = stream.type.slice(0, -1);\n  }\n\n  if (filter != null) stream.filter = filter;\n  if (throttle[0]) stream.throttle = throttle[0];\n  if (throttle[1]) stream.debounce = throttle[1];\n  return stream;\n}\n\nfunction parseThrottle(s) {\n  const a = s.split(COMMA);\n  if (!s.length || a.length > 2) throw s;\n  return a.map(_ => {\n    const x = +_;\n    if (x !== x) throw s;\n    return x;\n  });\n}\n\nexport { eventSelector as selector };\n"]},"metadata":{},"sourceType":"module"}