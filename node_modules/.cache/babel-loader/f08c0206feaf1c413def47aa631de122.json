{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"C:\\\\Users\\\\wkuo\\\\Documents\\\\vitessce-forked-v1.2.2\\\\vitessce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport { VERSION } from './lib/utils/version';\nimport { parseCompressedTexture } from './lib/parsers/parse-compressed-texture';\nimport parseBasis from './lib/parsers/parse-basis';\nvar DEFAULT_TEXTURE_LOADER_OPTIONS = {\n  'compressed-texture': {\n    libraryPath: 'libs/',\n    useBasis: false\n  }\n};\nexport var CompressedTextureWorkerLoader = {\n  name: 'Texture Containers',\n  id: 'compressed-texture',\n  module: 'textures',\n  version: VERSION,\n  worker: true,\n  extensions: ['ktx', 'ktx2', 'dds', 'pvr'],\n  mimeTypes: ['image/ktx2', 'image/ktx', 'image/vnd-ms.dds', 'image/x-dds', 'application/octet-stream'],\n  binary: true,\n  options: DEFAULT_TEXTURE_LOADER_OPTIONS\n};\nexport var CompressedTextureLoader = _objectSpread({}, CompressedTextureWorkerLoader, {\n  parse: function () {\n    var _parse = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(arrayBuffer, options) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!options['compressed-texture'].useBasis) {\n                _context.next = 5;\n                break;\n              }\n\n              options.basis = _objectSpread({\n                format: {\n                  alpha: 'BC3',\n                  noAlpha: 'BC1'\n                }\n              }, options.basis, {\n                containerFormat: 'ktx2',\n                module: 'encoder'\n              });\n              _context.next = 4;\n              return parseBasis(arrayBuffer, options);\n\n            case 4:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 5:\n              return _context.abrupt(\"return\", parseCompressedTexture(arrayBuffer));\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function parse(_x, _x2) {\n      return _parse.apply(this, arguments);\n    }\n\n    return parse;\n  }()\n});\nexport var _TypecheckCompressedTextureWorkerLoader = CompressedTextureWorkerLoader;\nexport var _TypecheckCompressedTextureLoader = CompressedTextureLoader;","map":{"version":3,"sources":["../../src/compressed-texture-loader.ts"],"names":["DEFAULT_TEXTURE_LOADER_OPTIONS","libraryPath","useBasis","CompressedTextureWorkerLoader","name","id","module","version","worker","extensions","mimeTypes","binary","options","CompressedTextureLoader","parse","format","alpha","noAlpha","containerFormat","parseBasis","parseCompressedTexture","_TypecheckCompressedTextureWorkerLoader","_TypecheckCompressedTextureLoader"],"mappings":";;;AACA,SAAA,OAAA,QAAA,qBAAA;AACA,SAAA,sBAAA,QAAA,wCAAA;AACA,OAAA,UAAA,MAAA,2BAAA;AASA,IAAMA,8BAA8B,GAAG;AACrC,wBAAsB;AACpBC,IAAAA,WAAW,EADS,OAAA;AAEpBC,IAAAA,QAAQ,EAAE;AAFU;AADe,CAAvC;AAUA,OAAO,IAAMC,6BAA6B,GAAG;AAC3CC,EAAAA,IAAI,EADuC,oBAAA;AAE3CC,EAAAA,EAAE,EAFyC,oBAAA;AAG3CC,EAAAA,MAAM,EAHqC,UAAA;AAI3CC,EAAAA,OAAO,EAJoC,OAAA;AAK3CC,EAAAA,MAAM,EALqC,IAAA;AAM3CC,EAAAA,UAAU,EAAE,CAAA,KAAA,EAAA,MAAA,EAAA,KAAA,EAN+B,KAM/B,CAN+B;AAY3CC,EAAAA,SAAS,EAAE,CAAA,YAAA,EAAA,WAAA,EAAA,kBAAA,EAAA,aAAA,EAZgC,0BAYhC,CAZgC;AAmB3CC,EAAAA,MAAM,EAnBqC,IAAA;AAoB3CC,EAAAA,OAAO,EAAEZ;AApBkC,CAAtC;AA0BP,OAAO,IAAMa,uBAAuB,qBAAG,6BAAH;AAElCC,EAAAA,KAAK;AAAA,0EAAE,iBAAA,WAAA,EAAA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACDF,OAAO,CAAPA,oBAAO,CAAPA,CAAJ,QADK;AAAA;AAAA;AAAA;;AAEHA,cAAAA,OAAO,CAAPA,KAAAA;AACEG,gBAAAA,MAAM,EAAE;AACNC,kBAAAA,KAAK,EADC,KAAA;AAENC,kBAAAA,OAAO,EAAE;AAFH;AADVL,iBAKKA,OAAO,CALI,KAAhBA;AAMEM,gBAAAA,eAAe,EAND,MAAhBN;AAOEN,gBAAAA,MAAM,EAAE;AAPVM;AAFG;AAAA,qBAWUO,UAAU,CAAA,WAAA,EAAvB,OAAuB,CAXpB;;AAAA;AAAA;;AAAA;AAAA,+CAaEC,sBAAsB,CAA7B,WAA6B,CAbxB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAF6B,EAA7B;AAoBP,OAAO,IAAMC,uCAA+C,GAArD,6BAAA;AACP,OAAO,IAAMC,iCAAmD,GAAzD,uBAAA","sourcesContent":["import type {Loader, LoaderWithParser} from '@loaders.gl/loader-utils';\nimport {VERSION} from './lib/utils/version';\nimport {parseCompressedTexture} from './lib/parsers/parse-compressed-texture';\nimport parseBasis from './lib/parsers/parse-basis';\n\nexport type TextureLoaderOptions = {\n  'compressed-texture'?: {\n    libraryPath?: string;\n    useBasis?: boolean;\n  };\n};\n\nconst DEFAULT_TEXTURE_LOADER_OPTIONS = {\n  'compressed-texture': {\n    libraryPath: 'libs/',\n    useBasis: false\n  }\n};\n\n/**\n * Worker Loader for KTX, DDS, and PVR texture container formats\n */\nexport const CompressedTextureWorkerLoader = {\n  name: 'Texture Containers',\n  id: 'compressed-texture',\n  module: 'textures',\n  version: VERSION,\n  worker: true,\n  extensions: [\n    'ktx',\n    'ktx2',\n    'dds', // WEBGL_compressed_texture_s3tc, WEBGL_compressed_texture_atc\n    'pvr' // WEBGL_compressed_texture_pvrtc\n  ],\n  mimeTypes: [\n    'image/ktx2',\n    'image/ktx',\n    'image/vnd-ms.dds',\n    'image/x-dds',\n    'application/octet-stream'\n  ],\n  binary: true,\n  options: DEFAULT_TEXTURE_LOADER_OPTIONS\n};\n\n/**\n * Loader for KTX, DDS, and PVR texture container formats\n */\nexport const CompressedTextureLoader = {\n  ...CompressedTextureWorkerLoader,\n  parse: async (arrayBuffer, options) => {\n    if (options['compressed-texture'].useBasis) {\n      options.basis = {\n        format: {\n          alpha: 'BC3',\n          noAlpha: 'BC1'\n        },\n        ...options.basis,\n        containerFormat: 'ktx2',\n        module: 'encoder'\n      };\n      return await parseBasis(arrayBuffer, options);\n    }\n    return parseCompressedTexture(arrayBuffer);\n  }\n};\n\n// TYPE TESTS - TODO find a better way than exporting junk\nexport const _TypecheckCompressedTextureWorkerLoader: Loader = CompressedTextureWorkerLoader;\nexport const _TypecheckCompressedTextureLoader: LoaderWithParser = CompressedTextureLoader;\n"]},"metadata":{},"sourceType":"module"}