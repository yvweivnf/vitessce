!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).createPubSub={})}(this,(function(e){"use strict";var t=function(){try{return new window.BroadcastChannel("pub-sub-es")}catch(e){return{postMessage:function(){}}}}(),n=function(e){return function(t,n,i){return void 0===i&&(i=1/0),e[t]||(e[t]=[],e.__times__[t]=[]),e[t].push(n),e.__times__[t].push(+i||1/0),{event:t,handler:n}}},i=function(e){return function(t,n){if("object"==typeof t&&(n=t.handler,t=t.event),e[t]){var i=e[t].indexOf(n);-1===i||i>=e[t].length||(e[t].splice(i,1),e.__times__[t].splice(i,1))}}},o=function(e,n){return function(o,s,u){if(e[o]){var r=i(e);if(e[o].forEach((function(t,n){t(s),e.__times__[o][n]--,e.__times__[o][n]<1&&r(o,t)})),n&&!u)try{t.postMessage({event:o,news:s})}catch(e){if(!(e instanceof DOMException))throw e;console.warn("Could not broadcast '"+o+"' globally. Payload is not clonable.")}}}},s=function(e){return function(){Object.keys(e).filter((function(e){return"_"!==e[0]})).forEach((function(t){e[t]=void 0,e.__times__[t]=void 0,delete e[t],delete e.__times__[t]}))}},u=function(e){return void 0===e&&(e={__times__:{}}),e.__times__||(e.__times__={}),{publish:o(e),subscribe:n(e),unsubscribe:i(e),clear:s(e),stack:e}},r={__times__:{}},_={publish:o(r,!0),subscribe:n(r),unsubscribe:i(r),stack:r};t.onmessage=function(e){var t=e.data,n=t.event,i=t.news;return _.publish(n,i,!0)},e.createPubSub=u,e.default=u,e.globalPubSub=_,Object.defineProperty(e,"__esModule",{value:!0})}));
