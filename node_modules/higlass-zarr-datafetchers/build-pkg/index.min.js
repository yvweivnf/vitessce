var HiGlassZarrDataFetchers=function(t,e){"use strict";function r(t,e,a){return(r=n()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var a=new(Function.bind.apply(t,n));return r&&o(a,r.prototype),a}).apply(null,arguments)}function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}function h(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=p(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function p(t,e){if(t){if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function m(t,e,r){var n=r?e[1]:e[0]*e[1],o=new Float32Array(n),a=0;if(r){var i,u=h(t);try{for(u.s();!(i=u.n()).done;){var c=i.value.data;o.set(c,a),a+=c.length}}catch(t){u.e(t)}finally{u.f()}}else for(var l=e[0],s=0;s<l;s++){var f,p=h(t);try{for(p.s();!(f=p.n()).done;){var y=f.value.data[s];o.set(y,a),a+=y.length}}catch(t){p.e(t)}finally{p.f()}}return o}var v=function t(n){if(!(this instanceof t?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var o=n.libraries.slugid,i=n.utils,c=i.absToChr,s=i.parseChromsizesRows,p=i.genomicRangeToChromosomeChunks,y=i.DenseDataExtrema1D,v=i.minNonZero,d=i.maxNonZero,b=function(){function t(r){l(this,t),this.dataConfig=r,this.trackUid=o.nice(),r.url&&(this.store=new e.HTTPStore(r.url,{supportedMethods:["GET"]})),void 0!==r.row&&(this.row=r.row)}return f(t,[{key:"tilesetInfo",value:function(t){var e=this;return this.tilesetInfoLoading=!0,this.store.getItem(".zattrs").then((function(t){var e=new TextDecoder("utf-8");return JSON.parse(e.decode(t))})).then((function(r){e.tilesetInfoLoading=!1;var n=r.multiscales.map((function(t){return[t.name,t.metadata.chromsize]})),o=r.multiscales[r.multiscales.length-1],a=o.metadata.chromoffset+o.metadata.chromsize,i=r.shape[1],c=u(u({},r),{},{shape:[r.shape[1],r.shape[0]],chromSizes:n,tile_size:i,max_width:a,min_pos:[0],max_pos:[a],max_zoom:Math.ceil(Math.log(a/i)/Math.log(2))});return t&&t(c),c})).catch((function(r){e.tilesetInfoLoading=!1,t&&t({error:"Error parsing zarr multivec: ".concat(r)})}))}},{key:"fetchTilesDebounced",value:function(t,e){var r,n={},o=[],a=[],i=h(e);try{for(i.s();!(r=i.n()).done;){var u=r.value,c=u.split("."),l=parseInt(c[0],10),s=parseInt(c[1],10);Number.isNaN(s)||Number.isNaN(l)?console.warn("Invalid tile zoom or position:",l,s):(o.push(u),a.push(this.tile(l,s,u)))}}catch(t){i.e(t)}finally{i.f()}return Promise.all(a).then((function(e){for(var r=0;r<e.length;r++){var a=o[r];n[a]=e[r],n[a].tilePositionId=a}t(n)})),n}},{key:"tile",value:function(t,r,n){var o=this,i=this.store;return this.tilesetInfo().then((function(u){var l=+u.resolutions[t],f=+u.tile_size,h=l,b=r*f*l,g=b+f*l,w=u.chromSizes,O=s(w),j=a(c(b,O),2),P=j[0],I=j[1],S=a(c(g,O),2),z=S[0],D=S[1],x=p(w,{chr:P,pos:I},{chr:z,pos:D},h,f);return Promise.all(x.map((function(t){var r=a(t,3),n=r[0],u=r[1],c=r[2];return e.openArray({store:i,path:"/chromosomes/".concat(n,"/").concat(l,"/"),mode:"r"}).then((function(t){return void 0!==o.row?t.getRaw([o.row,e.slice(u,c)]):t.get([null,e.slice(u,c)])}))}))).then((function(e){var a=m(e,[u.shape[1],u.shape[0]],void 0!==o.row);return Promise.resolve({dense:a,denseDataExtrema:new y(a),dtype:"float32",min_value:Math.min.apply(null,a),max_value:Math.max.apply(null,a),minNonZero:v(a),maxNonZero:d(a),server:null,size:1,shape:u.shape,tileId:n,tilePos:[r],tilePositionId:n,tilesetUid:null,zoomLevel:t})}))}))}}]),t}(),g=arguments.length,w=new Array(g>1?g-1:0),O=1;O<g;O++)w[O-1]=arguments[O];return r(b,w)};return v.config={type:"zarr-multivec"},t.ZarrMultivecDataFetcher=v,t}({},zarr);
//# sourceMappingURL=index.min.js.map
